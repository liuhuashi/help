<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"> 
    <meta name="csrf-token" content=""> 
    <title>Eloquent: 入门 - 开发帮助文档</title> 
    <meta name="keyword" content="eloquent"> 
    <meta name="description" content="eloquent"> 
    <meta name="author" content="Moments"> 
    <link href="/favicon.ico" rel="shortcut icon"> 
    <link href="/css/blog.css" rel="stylesheet"> 
    <script src="/js/blog.js"></script> 
</head>
<body>
<header class="sticky-top">
    <nav class="navbar navbar-expand navbar-dark bg-secondary justify-content-between text-uppercase">
        <div class="navbar-nav" style="overflow:hidden;">
            <a class="navbar-brand" href="https://help.pythonschool.com">
                <span class="d-md-none">
                    <svg class="text-warning" width="24" height="24" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#emoji-sunglasses"/>
                    </svg>
                </span>
                <span class="d-none d-md-flex">开发帮助文档</span>
            </a>
            <div class="navbar-nav-scroll" style="overflow: hidden;">
                <ul class="navbar-nav text-nowrap pb-4" style="overflow:auto;">
                                            <li class="nav-item">
                            <a class="nav-link active" href="/docs/laravel/index.html">laravel</a>
                        </li>
                                            <li class="nav-item">
                            <a class="nav-link" href="/docs/php/index.html">php</a>
                        </li>
                                    </ul>
            </div>
        </div>
        <div class="d-inline-flex">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/liuhuashi">
                        <svg class="text-light" width="24" height="24" fill="currentColor">
                            <use xlink:href="/css/bootstrap-icons.svg#github"/>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<div class="container-fluid">
    <div id="aside-hidden" class="position-fixed" style="left:0;top: 58px;cursor:pointer;z-index: 10000;">
        <svg class="align-text-bottom text-warning" width="16" height="16" fill="currentColor" stroke="currentColor" stroke-width="1">
            <use xlink:href="/css/bootstrap-icons.svg#arrow-left-square"/>
        </svg>
    </div>
    <div class="row">
        <div class="aside col-md-3 col-lg-2 border-right shadow position-sticky" style="overflow:auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
    <form class="row border-bottom p-3 bg-white sticky-top">
        <input id="search-version" class="form-control" data-version="7" type="search" placeholder="英文逗号分隔,分词搜索">
    </form>
    <ul class="nav navbar-nav nav-pills flex-column pt-2 figure-caption">
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/artisan.html" title="Artisan 命令行">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Artisan 命令行
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/authentication.html" title="用户认证">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    用户认证
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/authorization.html" title="用户授权">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    用户授权
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/blade.html" title="Blade 模板">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Blade 模板
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/broadcasting.html" title="广播系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    广播系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/cache.html" title="缓存系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    缓存系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/collections.html" title="集合">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    集合
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/configuration.html" title="Configuration">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Configuration
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/console-tests.html" title="控制台测试">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    控制台测试
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/container.html" title="服务容器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    服务容器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/contracts.html" title="契约">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    契约
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/contributions.html" title="贡献导引">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    贡献导引
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/controllers.html" title="Controllers">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Controllers
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/csrf.html" title="CSRF 保护">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    CSRF 保护
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/database-testing.html" title="数据库测试">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库测试
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/database.html" title="数据库: 入门">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库: 入门
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/deployment.html" title="部署">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    部署
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/documentation.html" title="前言">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    前言
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/dusk.html" title="Laravel Dusk">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Dusk
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-collections.html" title="Eloquent: 集合">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 集合
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-mutators.html" title="Eloquent: 修改器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 修改器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-relationships.html" title="Eloquent: 关联">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 关联
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-resources.html" title="Eloquent: API 资源">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: API 资源
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-serialization.html" title="Eloquent: 序列化">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 序列化
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent.html" title="Eloquent: 入门">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 入门
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/encryption.html" title="加密解密">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    加密解密
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/envoy.html" title="Laravel Envoy">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Envoy
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/errors.html" title="错误处理">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    错误处理
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/events.html" title="事件系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    事件系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/facades.html" title="Facades">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Facades
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/filesystem.html" title="File Storage">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    File Storage
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/frontend.html" title="JavaScript &amp; CSS 脚手架">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    JavaScript &amp; CSS 脚手架
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/hashing.html" title="哈希加密">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    哈希加密
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/helpers.html" title="辅助函数">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    辅助函数
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/homestead.html" title="Laravel Homestead">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Homestead
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/horizon.html" title="Laravel Horizon">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Horizon
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/http-client.html" title="HTTP 客户端">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP 客户端
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/http-tests.html" title="HTTP Tests">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP Tests
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/installation.html" title="安装">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    安装
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/lifecycle.html" title="请求生命周期">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    请求生命周期
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/localization.html" title="本地化">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    本地化
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/logging.html" title="日志">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    日志
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/mail.html" title="邮件发送">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    邮件发送
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/middleware.html" title="中间件">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    中间件
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/migrations.html" title="数据库：迁移">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库：迁移
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/mix.html" title="编辑资源 (Mix)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    编辑资源 (Mix)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/mocking.html" title="Mocking">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Mocking
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/notifications.html" title="消息通知">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    消息通知
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/packages.html" title="Package Development">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Package Development
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/pagination.html" title="数据库: 分页">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库: 分页
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/passport.html" title="Laravel Passport">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Passport
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/passwords.html" title="重置密码">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    重置密码
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/providers.html" title="服务提供者">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    服务提供者
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/queries.html" title="数据库：查询构造器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库：查询构造器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/queues.html" title="队列">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    队列
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/redis.html" title="Redis">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Redis
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/releases.html" title="发行说明">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    发行说明
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/requests.html" title="HTTP 请求">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP 请求
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/responses.html" title="HTTP Responses">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP Responses
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/routing.html" title="路由">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    路由
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/sail.html" title="Laravel Sail">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Sail
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/sanctum.html" title="Laravel Sanctum">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Sanctum
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/scheduling.html" title="任务调度">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    任务调度
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/scout.html" title="Laravel Scout">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Scout
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/seeding.html" title="数据库：填充">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库：填充
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/session.html" title="HTTP 会话机制">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP 会话机制
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/socialite.html" title="Laravel 社会化登录">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 社会化登录
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/structure.html" title="目录结构">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    目录结构
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/telescope.html" title="Laravel Telescope">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Telescope
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/testing.html" title="测试：入门指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    测试：入门指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/upgrade.html" title="升级指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    升级指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/urls.html" title="生成 URL">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    生成 URL
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/valet.html" title="Laravel Valet">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Valet
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/validation.html" title="表单验证">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    表单验证
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/verification.html" title="Email 认证">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Email 认证
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/views.html" title="视图">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    视图
                </a>
            </li>
            </ul>
</div>        <div class="aside-middle col-md-9 col-lg-10 row">
    <div class="col-md-9 col-xl-10" style="overflow: auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
        <div class="container main-h4-1">
            <div class="page-content">
                <h1>Eloquent: 入门</h1>
<ul>
<li><a href="#introduction">简介</a></li>
<li><a href="#defining-models">模型定义</a>
<ul>
<li><a href="#eloquent-model-conventions">模型约定</a></li>
<li><a href="#default-attribute-values">默认属性值</a></li>
</ul></li>
<li><a href="#retrieving-models">模型检索</a>
<ul>
<li><a href="#collections">集合</a></li>
<li><a href="#chunking-results">结果分块</a></li>
<li><a href="#advanced-subqueries">高级子查询</a></li>
</ul></li>
<li><a href="#retrieving-single-models">检索单个模型 / 集合</a>
<ul>
<li><a href="#retrieving-aggregates">检索集合</a></li>
</ul></li>
<li><a href="#inserting-and-updating-models">插入 &amp; 更新模型</a>
<ul>
<li><a href="#inserts">插入</a></li>
<li><a href="#updates">更新</a></li>
<li><a href="#mass-assignment">批量赋值</a></li>
<li><a href="#other-creation-methods">其他创建方法</a></li>
</ul></li>
<li><a href="#deleting-models">删除模型</a>
<ul>
<li><a href="#soft-deleting">软删除</a></li>
<li><a href="#querying-soft-deleted-models">查询软删除的模型</a></li>
</ul></li>
<li><a href="#replicating-models">模型复制</a></li>
<li><a href="#query-scopes">查询作用域</a>
<ul>
<li><a href="#global-scopes">全局作用域</a></li>
<li><a href="#local-scopes">局部作用域</a></li>
</ul></li>
<li><a href="#comparing-models">模型对比</a></li>
<li><a href="#events">事件</a>
<ul>
<li><a href="#events-using-closures">使用闭包</a></li>
<li><a href="#observers">观察器</a></li>
<li><a href="#muting-events">禁用事件</a></li>
</ul></li>
</ul>
<p><a name="introduction"></a></p>
<h2>简介</h2>
<p>Laravel 的 Eloquent ORM 提供了一个漂亮、简洁的 ActiveRecord 实现来和数据库交互。每个数据库表都有一个对应的「模型」用来与该表交互。你可以通过模型查询数据表中的数据，以及在数据表中插入新记录。</p>
<p>在开始之前，请确保在 <code>config/database.php</code> 中配置数据库连接。更多关于数据库配置的信息，请查看 <a href="/docs/laravel_8_zh/database.html#configuration">文档</a>。</p>
<p><a name="defining-models"></a></p>
<h2>模型定义</h2>
<p>首先，创建一个 Eloquent 模型。 模型通常在 <code>app\Models</code> 目录中，但你可以根据 <code>composer.json</code> 文件将他们放置在可以被自动加载的任意位置。所有的 Eloquent 模型都需要继承 <code>Illuminate\Database\Eloquent\Model</code> 类。</p>
<p>创建模型最简单的方法就是使用 <code>make:model</code> <a href="/docs/laravel_8_zh/artisan.html">Artisan 命令</a>：</p>
<pre><code>  php artisan make:model Flight</code></pre>
<p>如果要在生成模型的时候生成 <a href="/docs/laravel_8_zh/migrations.html">数据库迁移</a>，可以使用 <code>--migration</code> 或 <code>-m</code> 选项：</p>
<pre><code>php artisan make:model Flight --migration

php artisan make:model Flight -m</code></pre>
<p>生成模型时，你可能需要生成各种其他类型的类，例如模型工厂、seeders 和 控制器。另外，这些选项可以组合在一起一次创建多个类：</p>
<pre><code>php artisan make:model Flight --factory
php artisan make:model Flight -f

php artisan make:model Flight --seed
php artisan make:model Flight -s

php artisan make:model Flight --controller
php artisan make:model Flight -c

php artisan make:model Flight -mfsc</code></pre>
<p><a name="eloquent-model-conventions"></a></p>
<h3>Eloquent 模型约定</h3>
<p>现在，我们来看一个 <code>Flight</code> 模型的示例，我们将用它从 <code>flights</code> 数据库表中检索和存储数据信息：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    //
}</code></pre>
<p><a name="table-names"></a></p>
<h4>数据表名称</h4>
<p>请注意，我们并没有告诉 Eloquent 我们的 <code>Flight</code> 模型使用哪个数据表。 除非明确地指定了其它名称，否则将使用类的复数形式「蛇形命名」来作为表名。因此，在这种情况下，Eloquent 将假设 <code>Flight</code> 模型存储的是 <code>flights</code> 数据表中的数据，而 <code>AirTrafficController</code> 模型会将记录存储在 <code>air_traffic_controllers</code> 表中。</p>
<p>你可以通过在模型上定义 <code>table</code> 属性来指定自定义数据表：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * 与模型关联的表名
     *
     * @var string
     */
    protected $table = 'my_flights';
}</code></pre>
<p><a name="primary-keys"></a></p>
<h4>主键</h4>
<p>Eloquent 也会假设每个数据表都有一个名为 <code>id</code> 的主键列。你可以定义一个受保护的 <code>$primaryKey</code> 属性来重写约定。</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * 与表关联的主键
     *
     * @var string
     */
    protected $primaryKey = 'flight_id';
}</code></pre>
<p>此外，Eloquent 假设主键是一个自增的整数值，这意味着默认情况下主键会自动转换为 <code>int</code> 类型。如果您希望使用非递增或非数字的主键则需要设置公共的 <code>$incrementing</code> 属性设置为 <code>false</code>：</p>
<pre><code>&lt;?php

class Flight extends Model
{
    /**
     * 主键是否主动递增
     *
     * @var bool
     */
    public $incrementing = false;
}</code></pre>
<p>如果你的主键不是一个整数，你需要将模型上受保护的 <code>$keyType</code> 属性设置为 <code>string</code>：</p>
<pre><code>&lt;?php

class Flight extends Model
{
    /**
     * 自动递增主键的「类型」
     *
     * @var string
     */
    protected $keyType = 'string';
}</code></pre>
<p><a name="timestamps"></a></p>
<h4>时间戳</h4>
<p>默认情况下，Eloquent 预期你的数据表中存在 <code>created_at</code> 和 <code>updated_at</code> 两个字段 。如果你不想让 Eloquent 自动管理这两个列， 请将模型中的 <code>$timestamps</code> 属性设置为 <code>false</code>：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * 是否主动维护时间戳
     *
     * @var bool
     */
    public $timestamps = false;
}</code></pre>
<p>如果需要自定义时间戳的格式，在你的模型中设置 <code>$dateFormat</code> 属性。这个属性决定日期属性在数据库的存储方式，以及模型序列化为数组或者 JSON 的格式：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * 模型日期的存储格式
     *
     * @var string
     */
    protected $dateFormat = 'U';
}</code></pre>
<p>如果你需要自定义存储时间戳的字段名，可以在模型中设置 <code>CREATED_AT</code> 和 <code>UPDATED_AT</code> 常量的值来实现：</p>
<pre><code>&lt;?php

class Flight extends Model
{
    const CREATED_AT = 'creation_date';
    const UPDATED_AT = 'last_update';
}</code></pre>
<p><a name="database-connection"></a></p>
<h4>数据库连接</h4>
<p>默认情况下，Eloquent 模型将使用你的应用程序配置的默认数据库连接。如果你想为模型指定一个不同的连接，设置 <code>$connection</code> 属性即可：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * 模型的数据库连接名
     *
     * @var string
     */
    protected $connection = 'connection-name';
}</code></pre>
<p><a name="default-attribute-values"></a></p>
<h3>默认属性值</h3>
<p>如果要为模型的某些属性定义默认值，可以在模型上定义 <code>$attributes</code> 属性：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * 模型属性的默认值
     *
     * @var array
     */
    protected $attributes = [
        'delayed' =&gt; false,
    ];
}</code></pre>
<p><a name="retrieving-models"></a></p>
<h2>模型检索</h2>
<p>创建模型和 <a href="/docs/laravel_8_zh/migrations.html#writing-migrations">它关联的数据库表</a> 后，你就可以从数据库中查询数据了。将每个 Eloquent 模型想象成一个强大的 <a href="/docs/laravel_8_zh/queries.html">查询构造器</a>，你可以用它更快速的查询与其相关联的数据表。例如：</p>
<pre><code>&lt;?php

$flights = App\Models\Flight::all();

foreach ($flights as $flight) {
    echo $flight-&gt;name;
}</code></pre>
<p><a name="adding-additional-constraints"></a></p>
<h4>附加约束</h4>
<p>Eloquent 的 <code>all</code> 方法会返回模型中所有的结果。由于每个 Eloquent 模型都充当一个 <a href="/docs/laravel_8_zh/queries.html">查询构造器</a>，所以你也可以添加查询条件，然后使用 <code>get</code> 方法获取查询结果：</p>
<pre><code>$flights = App\Models\Flight::where('active', 1)
               -&gt;orderBy('name', 'desc')
               -&gt;take(10)
               -&gt;get();</code></pre>
<blockquote>
<p>技巧：因为 Eloquent 模型也是查询构造器，所以你也应当阅读 <a href="/docs/laravel_8_zh/queries.html">查询构造器</a> 可用的所有方法。你可以在 Eloquent 查询中使用这些方法。</p>
</blockquote>
<p><a name="refreshing-models"></a></p>
<h4>重新加载模型</h4>
<p>你可以使用 <code>fresh</code> 和 <code>refresh</code> 方法重新加载模型。 <code>fresh</code> 方法会重新从数据库中检索模型。现有的模型实例不受影响：</p>
<pre><code>$flight = App\Models\Flight::where('number', 'FR 900')-&gt;first();

$freshFlight = $flight-&gt;fresh();</code></pre>
<p><code>refresh</code> 方法使用数据库中的新数据重新赋值现有模型。此外，已经加载的关系会被重新加载：</p>
<pre><code>$flight = App\Models\Flight::where('number', 'FR 900')-&gt;first();

$flight-&gt;number = 'FR 456';

$flight-&gt;refresh();

$flight-&gt;number; // "FR 900"</code></pre>
<p><a name="collections"></a></p>
<h3>集合</h3>
<p>Eloquent 的 <code>all</code> 和 <code>get</code> 方法可以查询到多个结果，返回一个 <code>Illuminate\Database\Eloquent\Collection</code> 实例。<code>Collection</code> 类提供了 <a href="/docs/laravel_8_zh/eloquent-collections.html#available-methods">大量的辅助函数</a> 来处理 Eloquent 结果：</p>
<pre><code>$flights = $flights-&gt;reject(function ($flight) {
    return $flight-&gt;cancelled;
});</code></pre>
<p>你可以像数组一样遍历集合：</p>
<pre><code>foreach ($flights as $flight) {
    echo $flight-&gt;name;
}</code></pre>
<p><a name="chunking-results"></a></p>
<h3>结果分块</h3>
<p>如果你需要处理数以千计的 Eloquent 结果，使用 <code>chunk</code> 命令。 <code>chunk</code> 方法会检索 Eloquent 模型中的『分块』将他们提供给指定的 <code>Closure</code> 处理。在处理大型结果集时，使用 <code>chunk</code> 方法可以节省内存：</p>
<pre><code>Flight::chunk(200, function ($flights) {
    foreach ($flights as $flight) {
        //
    }
});</code></pre>
<p>传递到方法的第一个参数是希望每个『分块』接收的数据量。闭包作为第二个参数传递，它在每次从数据库中检索分块的时候调用。它将执行数据库查询把检索分块的结果传递给闭包方法。</p>
<p>如果要基于迭代结果时也要更新的列筛选 <code>chunk</code> 方法的结果，则应使用 <code>chunkById</code> 方法。在这种情况下使用 <code>chunk</code> 方法可能会导致意外和不一致的结果：</p>
<pre><code>Flight::where('departed', true)-&gt;chunkById(200, function ($flights) {
    $flights-&gt;each-&gt;update(['departed' =&gt; false]);
});</code></pre>
<p><a name="using-cursors"></a></p>
<h4>使用游标</h4>
<p><code>cursor</code> 方法允许你使用游标遍历数据库，它只执行一次查询。处理大量的数据时， <code>cursor</code> 方法可以大大减少内存的使用量：</p>
<pre><code>foreach (Flight::where('foo', 'bar')-&gt;cursor() as $flight) {
    //
}</code></pre>
<p><code>cursor</code> 返回 <code>Illuminate\Support\LazyCollection</code> 实例。 <a href="/docs/laravel_8_zh/collections.html#lazy-collections">Lazy collections</a> 允许你使用 Laravel 集合中大多数集合方法，而且每次只会加载单个模型到内存中：</p>
<pre><code>$users = App\Models\User::cursor()-&gt;filter(function ($user) {
    return $user-&gt;id &gt; 500;
});

foreach ($users as $user) {
    echo $user-&gt;id;
}</code></pre>
<p><a name="advanced-subqueries"></a></p>
<h3>高级子查询</h3>
<p><a name="subquery-selects"></a></p>
<h4>Selects 子查询</h4>
<p>Eloquent 提供了高级子查询支持，你可以用单条查询语句从相关表中提取信息。举个例子，假设我们有一个目的地表 <code>destinations</code> 和一个到目的地的航班表 <code>flights</code>。<code>flights</code> 表包含一个 <code>arrival_at</code> 字段，表示航班何时到达目的地。</p>
<p>使用子查询功能提供的 <code>select</code> 和 <code>addSelect</code> 方法，我们可以用单条语句查询全部目的地 <code>destinations</code>，以及抵达各目的地最后一班飞机的名称：</p>
<pre><code>use App\Models\Destination;
use App\Models\Flight;

return Destination::addSelect(['last_flight' =&gt; Flight::select('name')
    -&gt;whereColumn('destination_id', 'destinations.id')
    -&gt;orderBy('arrived_at', 'desc')
    -&gt;limit(1)
])-&gt;get();</code></pre>
<p><a name="subquery-ordering"></a></p>
<h4>根据子查询进行排序</h4>
<p>此外，查询构建器的 <code>orderBy</code> 函数也支持子查询。我们可以使用此功能根据最后一班航班到达目的地的时间对所有目的地排序。 同样，这可以只对数据库执行单个查询：</p>
<pre><code>return Destination::orderByDesc(
    Flight::select('arrived_at')
        -&gt;whereColumn('destination_id', 'destinations.id')
        -&gt;orderBy('arrived_at', 'desc')
        -&gt;limit(1)
)-&gt;get();</code></pre>
<p><a name="retrieving-single-models"></a></p>
<h2>检索单个模型 / 集合</h2>
<p>除了从指定的数据表检索所有记录外，你可以使用 <code>find</code>、 <code>first</code> 或 <code>firstWhere</code> 方法来检索单条记录。这些方法返回单个模型实例，而不是返回模型集合：</p>
<pre><code>// 通过主键查找一个模型...
$flight = App\Models\Flight::find(1);

// 查找符合查询条件的首个模型...
$flight = App\Models\Flight::where('active', 1)-&gt;first();

// 查找符合查询条件的首个模型的快速实现...
$flight = App\Models\Flight::firstWhere('active', 1);</code></pre>
<p>你也可以使用主键数组作为参数调用 <code>find</code> 方法，它将返回匹配记录的集合：</p>
<pre><code>$flights = App\Models\Flight::find([1, 2, 3]);</code></pre>
<p>有时你可能希望在查找首个结果但找不到值时执行其他动作。<code>firstOr</code> 方法将会在查找到结果时返回首个结果，如果没有结果，将会执行给定的回调。回调的返回值将会作为 <code>firstOr</code> 方法的返回值：</p>
<pre><code>$model = App\Models\Flight::where('legs', '&gt;', 100)-&gt;firstOr(function () {
        // ...
});</code></pre>
<p><code>firstOr</code> 方法同样接受数据库列的数组来查询：</p>
<pre><code>$model = App\Models\Flight::where('legs', '&gt;', 100)
            -&gt;firstOr(['id', 'legs'], function () {
                // ...
            });</code></pre>
<p><a name="not-found-exceptions"></a></p>
<h4>「未找到」异常</h4>
<p>有时你希望在未找到模型时抛出异常。这在控制器和路由中非常有用。 <code>findOrFail</code> 和 <code>firstOrFail</code> 方法会检索查询的第一个结果，如果未找到，将抛出 <code>Illuminate\Database\Eloquent\ModelNotFoundException</code> 异常：</p>
<pre><code>$model = App\Models\Flight::findOrFail(1);

$model = App\Models\Flight::where('legs', '&gt;', 100)-&gt;firstOrFail();</code></pre>
<p>如果没有捕获异常，则会自动返回 <code>404</code> 响应给用户。也就是说，使用这些方法时，没有必要再写个检查来返回 <code>404</code> 响应：</p>
<pre><code>Route::get('/api/flights/{id}', function ($id) {
    return App\Models\Flight::findOrFail($id);
});</code></pre>
<p><a name="retrieving-aggregates"></a></p>
<h3>检索集合</h3>
<p>你还可以使用 <a href="/docs/laravel_8_zh/queries">查询构造器</a>提供的 <code>count</code>、 <code>sum</code> 和 <code>max</code> 方法, 和其他的 <a href="/docs/laravel_8_zh/queries.html#aggregates">集合函数</a> 来操作集合。这些方法只会返回适当的标量值而不是一个模型实例：</p>
<pre><code>$count = App\Models\Flight::where('active', 1)-&gt;count();

$max = App\Models\Flight::where('active', 1)-&gt;max('price');</code></pre>
<p><a name="inserting-and-updating-models"></a></p>
<h2>插入及更新模型</h2>
<p><a name="inserts"></a></p>
<h3>插入</h3>
<p>要往数据库新增一条记录，先创建新模型实例，给实例设置属性，然后调用 <code>save</code> 方法：</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Models\Flight;
use Illuminate\Http\Request;

class FlightController extends Controller
{
    /**
     * 创建一个新实例
     *
     * @param  Request  $request
     * @return Response
     */
    public function store(Request $request)
    {
        // 验证请求

        $flight = new Flight;

        $flight-&gt;name = $request-&gt;name;

        $flight-&gt;save();
    }
}</code></pre>
<p>在这个示例中，我们将 HTTP 请求参数 <code>name</code> 赋值给了 <code>App\Flight</code> 模型实例的 <code>name</code> 属性。当调用 <code>save</code> 方法时，将会插入一条新记录。 <code>created_at</code> 和 <code>updated_at</code> 时间戳将会自动设置，不需要手动赋值。</p>
<p><a name="updates"></a></p>
<h3>更新</h3>
<p><code>save</code> 方法也可以用来更新数据库已经存在的模型。更新模型，你需要先检索出来，设置要更新的属性，然后调用 <code>save</code> 方法。同样，<code>updated_at</code> 时间戳会自动更新，所以也不需要手动赋值：</p>
<pre><code>$flight = App\Models\Flight::find(1);

$flight-&gt;name = 'New Flight Name';

$flight-&gt;save();</code></pre>
<p><a name="mass-updates"></a></p>
<h4>批量更新</h4>
<p>也可以更新匹配查询条件的多个模型。在这个示例中，所有的 <code>active</code> 等于 1 和 <code>destination</code> 为 <code>San Diego</code> 的航班会标记为延误：</p>
<pre><code>App\Models\Flight::where('active', 1)
          -&gt;where('destination', 'San Diego')
          -&gt;update(['delayed' =&gt; 1]);</code></pre>
<p><code>update</code> 方法需要一个键为字段名和值为对应数据的数组，该数组代表应更新的字段。</p>
<blockquote>
<p>注意：通过 Eloquent 批量更新时，更新的模型不会触发 <code>saving</code>, <code>saved</code>, <code>updating</code> 和 <code>updated</code> 模型事件。这是因为在批量更新时实际上从未检索模型。</p>
</blockquote>
<p><a name="examining-attribute-changes"></a></p>
<h4>检查属性变化</h4>
<p>Eloquent 提供了 <code>isDirty</code>, <code>isClean</code> 和 <code>wasChanged</code> 方法，以检查模型的内部状态并确定其属性从最初加载时如何变化。</p>
<p><code>isDirty</code> 方法确定自加载模型以来是否已更改任何属性。 您可以传递特定的属性名称来确定特定的属性是否变脏。<code>isClean</code> 方法与 <code>isDirty</code> 相反，它也接受可选的属性参数：</p>
<pre><code>$user = User::create([
    'first_name' =&gt; 'Taylor',
    'last_name' =&gt; 'Otwell',
    'title' =&gt; 'Developer',
]);

$user-&gt;title = 'Painter';

$user-&gt;isDirty(); // true
$user-&gt;isDirty('title'); // true
$user-&gt;isDirty('first_name'); // false

$user-&gt;isClean(); // false
$user-&gt;isClean('title'); // false
$user-&gt;isClean('first_name'); // true

$user-&gt;save();

$user-&gt;isDirty(); // false
$user-&gt;isClean(); // true</code></pre>
<p><code>wasChanged</code> 方法确定在当前请求周期内最后一次保存模型时是否更改了任何属性。 你还可以传递属性名称以查看特定属性是否已更改：</p>
<pre><code>$user = User::create([
    'first_name' =&gt; 'Taylor',
    'last_name' =&gt; 'Otwell',
    'title' =&gt; 'Developer',
]);

$user-&gt;title = 'Painter';
$user-&gt;save();

$user-&gt;wasChanged(); // true
$user-&gt;wasChanged('title'); // true
$user-&gt;wasChanged('first_name'); // false</code></pre>
<p><code>getOriginal</code> 方法返回一个包含模型原始属性的数组，忽略加载模型之后进行的任何更改。 您可以传递特定的属性名称来获取特定属性的原始值：</p>
<pre><code>$user = User::find(1);

$user-&gt;name; // John
$user-&gt;email; // john@example.com

$user-&gt;name = "Jack";
$user-&gt;name; // Jack

$user-&gt;getOriginal('name'); // John
$user-&gt;getOriginal(); // 原始属性数组</code></pre>
<p><a name="mass-assignment"></a></p>
<h3>批量赋值</h3>
<p>你也可以使用 <code>create</code> 方法来保存新模型。 此方法会返回模型实例。 不过，在使用之前，你需要在模型上指定 <code>fillable</code> 或 <code>guarded</code> 属性，因为所有的 Eloquent 模型都默认不可进行批量赋值。</p>
<p>当用户通过请求传入意外的 HTTP 参数，并且该参数更改了数据库中你不需要更改的字段时，就会发生批量赋值漏洞。 比如：恶意用户可能会通过 HTTP 请求传入 <code>is_admin</code> 参数，然后将其传给 <code>create</code> 方法，此操作能让用户将自己升级成管理员。</p>
<p>所以，在开始之前，你应该定义好模型上的哪些属性是可以被批量赋值的。你可以通过模型上的 <code>$fillable</code> 属性来实现。 例如：让 <code>Flight</code> 模型的 <code>name</code> 属性可以被批量赋值：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Flight extends Model
{
    /**
     * 可批量赋值属性
     *
     * @var array
     */
    protected $fillable = ['name'];
}</code></pre>
<p>一旦我们设置好了可以批量赋值的属性，就可以通过 <code>create</code> 方法插入新数据到数据库中了。 <code>create</code> 方法将返回保存的模型实例：</p>
<pre><code>$flight = App\Models\Flight::create(['name' =&gt; 'Flight 10']);</code></pre>
<p>如果你已经有一个模型实例，你可以传递一个数组给 <code>fill</code> 方法来赋值：</p>
<pre><code>$flight-&gt;fill(['name' =&gt; 'Flight 22']);</code></pre>
<p><a name="mass-assignment-json-columns"></a></p>
<h4>批量赋值 &amp; JSON 列</h4>
<p>赋值 JSON 列时，必须在模型的 <code>$fillable</code> 数组中指定每个列的可赋值键。为了安全起见，在使用 <code>guarded</code> 属性时，Laravel 不支持更新嵌套的 JSON 属性：</p>
<pre><code>/**
 * 可批量赋值的属性。
 *
 * @var array
 */
$fillable = [
    'options-&gt;enabled',
];</code></pre>
<p><a name="allowing-mass-assignment"></a></p>
<h4>允许批量赋值</h4>
<p>如果你想让所有属性都可以批量赋值， 你可以将 <code>$guarded</code> 定义成一个空数组：</p>
<pre><code>/**
 * 不可批量赋值的属性
 *
 * @var array
 */
protected $guarded = [];</code></pre>
<p><a name="other-creation-methods"></a></p>
<h3>其他创建方法</h3>
<p><a name="firstorcreate-firstornew"></a></p>
<h4><code>firstOrCreate</code>/ <code>firstOrNew</code></h4>
<p>这里有两个你可能用来批量赋值的方法： <code>firstOrCreate</code> 和 <code>firstOrNew</code>。 <code>firstOrCreate</code> 方法会通过给定的键 / 值对来匹配数据库中的数据。如果在数据库中找不到模型，则将插入一条记录，其中包含第一个参数的属性以及可选的第二个参数的属性。</p>
<p><code>firstOrNew</code> 方法像 <code>firstOrCreate</code> 方法一样尝试通过给定的属性查找数据库中的记录。不过，如果 <code>firstOrNew</code> 方法找不到对应的模型，会返回一个新的模型实例。注意 <code>firstOrNew</code> 返回的模型实例尚未保存到数据库中，你需要手动调用 <code>save</code> 方法来保存：</p>
<pre><code>// 通过 name 检索航班，不存在则创建...
$flight = App\Models\Flight::firstOrCreate(['name' =&gt; 'Flight 10']);

// 通过 name 检索航班，或使用 name 和 delayed 属性和 arrival_time 属性创建...
$flight = App\Models\Flight::firstOrCreate(
    ['name' =&gt; 'Flight 10'],
    ['delayed' =&gt; 1, 'arrival_time' =&gt; '11:30']
);

// 通过 name 检索航班，不存在则创建一个实例...
$flight = App\Models\Flight::firstOrNew(['name' =&gt; 'Flight 10']);

// 通过 name 检索航班，或使用 name 和 delayed 属性和 arrival_time 属性创建一个模型实例...
$flight = App\Models\Flight::firstOrNew(
    ['name' =&gt; 'Flight 10'],
    ['delayed' =&gt; 1, 'arrival_time' =&gt; '11:30']
);</code></pre>
<p><a name="updateorcreate"></a></p>
<h4><code>updateOrCreate</code></h4>
<p>你还可能遇到希望更新现有模型或在不存在的情况下则创建新的模型的情景。 Laravel 提供 <code>updateOrCreate</code> 方法来一步实现。 类似于 <code>firstOrCreate</code> 方法, <code>updateOrCreate</code> 持久化模型，因此无需调用 <code>save()</code>：</p>
<pre><code>// 如果有从奥克兰到圣地亚哥的航班，则价格定为 99 美元...
// 如果没匹配到存在的模型，则创建一个...
$flight = App\Models\Flight::updateOrCreate(
    ['departure' =&gt; 'Oakland', 'destination' =&gt; 'San Diego'],
    ['price' =&gt; 99, 'discounted' =&gt; 1]
);</code></pre>
<p>如果你想在单次查询中执行多个 <code>upsert</code>，那么应该使用 <code>upsert</code> 方法。该方法的第一个参数是由要插入或更新的值组成，而第二个参数列出相应表中惟一标识记录的列，该方法的第三个也是最后一个参数是一个列数组，即如果数据库中已经存在匹配的记录，应该被更新的列。如果模型上启用了时间戳，<code>upsert</code> 方法将自动设置 <code>created_at</code> 和 <code>updated_at</code> 时间戳:</p>
<pre><code>App\Models\Flight::upsert([
    ['departure' =&gt; 'Oakland', 'destination' =&gt; 'San Diego', 'price' =&gt; 99],
    ['departure' =&gt; 'Chicago', 'destination' =&gt; 'New York', 'price' =&gt; 150]
], ['departure', 'destination'], ['price']);</code></pre>
<blockquote>
<p>注意：除 SQL Server 之外的所有数据库都要求 <code>upsert</code> 方法的第二个参数中的列具有 &quot;primary&quot; 或 &quot;unique&quot; 索引。</p>
</blockquote>
<p><a name="deleting-models"></a></p>
<h2>删除模型</h2>
<p>可以在模型实例上调用 <code>delete</code> 方法来删除实例：</p>
<pre><code>$flight = App\Models\Flight::find(1);

$flight-&gt;delete();</code></pre>
<p><a name="deleting-an-existing-model-by-key"></a></p>
<h4>通过主键删除模型</h4>
<p>在上面的例子中，在调用 <code>delete</code> 之前需要先去数据库中查找对应的模型。事实上，如果你知道了模型的主键，你可以直接使用 <code>destroy</code> 方法来删除模型，而不用先去数据库中查找。<code>destroy</code> 方法除了接受单个主键作为参数之外，还接受多个主键，或者使用数组、<a href="/docs/laravel_8_zh/collections.html">集合</a>来保存多个主键：</p>
<pre><code>App\Models\Flight::destroy(1);

App\Models\Flight::destroy(1, 2, 3);

App\Models\Flight::destroy([1, 2, 3]);

App\Models\Flight::destroy(collect([1, 2, 3]));</code></pre>
<blockquote>
<p>注意：<code>destroy</code> 会方法分别加载每个模型，并在其上调用 <code>delete</code> 方法，以便触发 <code>deleting</code> 和 <code>deleted</code> 事件。</p>
</blockquote>
<p><a name="deleting-models-by-query"></a></p>
<h4>通过查询删除模型</h4>
<p>你也可以在模型上运行删除语句。在这个例子中，我们将删除所有标记为非活跃的航班。与批量更新一样，批量删除不会为删除的模型启动任何模型事件：</p>
<pre><code>$deletedRows = App\Models\Flight::where('active', 0)-&gt;delete();</code></pre>
<blockquote>
<p>注意：通过 <code>Eloquent</code> 执行批量删除语句时，不会触发 <code>deleting</code> 和 <code>deleted</code> 模型事件。因此，在执行删除语句时，从不检索模型示例。</p>
</blockquote>
<p><a name="soft-deleting"></a></p>
<h3>软删除</h3>
<p>除了真实删除数据库记录，<code>Eloquent</code> 也可以「软删除」模型。软删除的模型并不是真的从数据库中删除了。 事实上，是在模型上设置了 <code>deleted_at</code> 属性并将其值写入数据库。如果 <code>deleted_at</code> 值非空，代表这个模型已被软删除。如果要开启模型软删除功能，你需要在模型上使用 <code>Illuminate\Database\Eloquent\SoftDeletes</code> trait：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Flight extends Model
{
    use SoftDeletes;
}</code></pre>
<blockquote>
<p>技巧：<code>SoftDeletes</code> 会自动将 <code>deleted_at</code> 属性转换成 <code>DateTime</code> / <code>Carbon</code> 实例。</p>
</blockquote>
<p>当然，你需要把 <code>deleted_at</code> 字段添加到数据表中。<code>Laravel</code> 的 <a href="/docs/laravel_8_zh/migrations.html">数据迁移</a> 有创建这个字段的方法：</p>
<pre><code>public function up()
{
    Schema::table('flights', function (Blueprint $table) {
        $table-&gt;softDeletes();
    });
}

public function down()
{
    Schema::table('flights', function (Blueprint $table) {
        $table-&gt;dropSoftDeletes();
    });
}</code></pre>
<p>那现在，当你在模型实例上使用 <code>delete</code> 方法, 当前日期时间会写入 <code>deleted_at</code> 字段。同时，查询出来的结果也会自动排除已被软删除的记录。</p>
<p>你可以使用 <code>trashed</code> 方法来验证给定的模型实例是否已被软删除：</p>
<pre><code>if ($flight-&gt;trashed()) {
    //
}</code></pre>
<p><a name="querying-soft-deleted-models"></a></p>
<h3>查询软删除模型</h3>
<p><a name="including-soft-deleted-models"></a></p>
<h4>包括已软删除的模型</h4>
<p>前面提到，查询结果会自动剔除已被软删除的结果。当然，你可以使用 <code>withTrashed</code> 方法来获取包括软删除模型在内的模型：</p>
<pre><code>$flights = App\Models\Flight::withTrashed()
                -&gt;where('account_id', 1)
                -&gt;get();</code></pre>
<p><code>withTrashed</code> 方法也可以用在 <a href="/docs/laravel_8_zh/eloquent-relationships.html">关联</a> 查询：</p>
<pre><code>$flight-&gt;history()-&gt;withTrashed()-&gt;get();</code></pre>
<p><a name="retrieving-only-soft-deleted-models"></a></p>
<h4>只检索软删除模型</h4>
<p><code>onlyTrashed</code> 方法 <strong>只</strong> 获取已软删除的模型：</p>
<pre><code>$flights = App\Models\Flight::onlyTrashed()
                -&gt;where('airline_id', 1)
                -&gt;get();</code></pre>
<p><a name="restoring-soft-deleted-models"></a></p>
<h4>恢复软删除模型</h4>
<p>有时会对软删除模型进行「撤销」，在已软删除的数据上使用 <code>restore</code> 方法即可恢复到有效状态：</p>
<pre><code>$flight-&gt;restore();</code></pre>
<p>你也可以在查询中使用 <code>restore</code> 方法，从而快速恢复多个模型。和其他「批量」操作一样，这个操作不会触发模型的任何事件：</p>
<pre><code>App\Models\Flight::withTrashed()
        -&gt;where('airline_id', 1)
        -&gt;restore();</code></pre>
<p>类似 <code>withTrashed</code> 方法，<code>restore</code> 方法也用在 <a href="/docs/laravel_8_zh/eloquent-relationships.html">关联</a>上:</p>
<pre><code>$flight-&gt;history()-&gt;restore();</code></pre>
<p><a name="permanently-deleting-models"></a></p>
<h4>永久删除</h4>
<p>有时你可能需要从数据库中真正删除模型。要从数据库中永久删除软删除的模型，请使用 <code>forceDelete</code> 方法：</p>
<pre><code>//强制删除单个模型实例...
$flight-&gt;forceDelete();

// 强制删除所有关联模型...
$flight-&gt;history()-&gt;forceDelete();</code></pre>
<p><a name="replicating-models"></a></p>
<h2>复制模型</h2>
<p>您可以使用 <code>replicate</code> 方法复制一个新的未保存到数据库的实例， 当模型实例共享许多相同的属性时，这个方法非常好用。</p>
<pre><code>$shipping = App\Models\Address::create([
    'type' =&gt; 'shipping',
    'line_1' =&gt; '123 Example Street',
    'city' =&gt; 'Victorville',
    'state' =&gt; 'CA',
    'postcode' =&gt; '90001',
]);

$billing = $shipping-&gt;replicate()-&gt;fill([
    'type' =&gt; 'billing'
]);

$billing-&gt;save();</code></pre>
<p><a name="query-scopes"></a></p>
<h2>查询作用域</h2>
<p><a name="global-scopes"></a></p>
<h3>全局作用域</h3>
<p>全局作用域可以给模型的查询都添加上约束。Laravel 的 <a href="#soft-deleting">软删除</a> 功能就是利用此特性从数据库中获取 「未删除」的模型。你可以编写你自己的全局作用域，很简单、方便的为每个模型查询都加上约束条件：</p>
<p><a name="writing-global-scopes"></a></p>
<h4>编写全局作用域</h4>
<p>编写全局作用域很简单。定义一个实现 <code>Illuminate\Database\Eloquent\Scope</code> 接口的类，并实现 <code>apply</code> 这个方法。根据你的需求，在 <code>apply</code> 方法中加入查询的 <code>where</code> 条件：</p>
<pre><code>&lt;?php

namespace App\Scopes;

use Illuminate\Database\Eloquent\Builder;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Scope;

class AgeScope implements Scope
{
    /**
     * 把约束加到 Eloquent 查询构造中
     *
     * @param  \Illuminate\Database\Eloquent\Builder  $builder
     * @param  \Illuminate\Database\Eloquent\Model  $model
     * @return void
     */
    public function apply(Builder $builder, Model $model)
    {
        $builder-&gt;where('age', '&gt;', 200);
    }
}</code></pre>
<blockquote>
<p>技巧：如果你需要在 select 语句里添加字段，应使用 <code>addSelect</code> 方法，而不是 <code>select</code> 方法。这将有效防止无意中替换现有 select 语句的情况。</p>
</blockquote>
<p><a name="applying-global-scopes"></a></p>
<h4>应用全局作用域</h4>
<p>要将全局作用域分配给模型，需要重写模型的 <code>booted</code> 方法并使用 <code>addGlobalScope</code> 方法：</p>
<pre><code>&lt;?php

namespace App\Models;

use App\Scopes\AgeScope;
use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    /**
     * 模型的 "booted" 方法
     *
     * @return void
     */
    protected static function booted()
    {
        static::addGlobalScope(new AgeScope);
    }
}</code></pre>
<p>添加作用域后，对 <code>User::all()</code> 的查询会生成以下 SQL 查询语句：</p>
<pre><code>select * from `users` where `age` &gt; 200</code></pre>
<p><a name="anonymous-global-scopes"></a></p>
<h4>匿名全局作用域</h4>
<p>Eloquent 同样允许使用闭包定义全局作用域，这样就不需要为一个简单的作用域而编写一个单独的类：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Builder;
use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    /**
     * 模型的 "booted" 方法
     *
     * @return void
     */
    protected static function booted()
    {
        static::addGlobalScope('age', function (Builder $builder) {
            $builder-&gt;where('age', '&gt;', 200);
        });
    }
}</code></pre>
<p><a name="removing-global-scopes"></a></p>
<h4>取消全局作用域</h4>
<p>如果需要对当前查询取消全局作用域，需要使用 <code>withoutGlobalScope</code> 方法。 该方法仅接受全局作用域类名作为它唯一的参数：</p>
<pre><code>User::withoutGlobalScope(AgeScope::class)-&gt;get();</code></pre>
<p>或者，如果使用闭包定义全局作用域的话：</p>
<pre><code>User::withoutGlobalScope('age')-&gt;get();</code></pre>
<p>如果你需要取消部分或者全部的全局作用域的话，需要使用 <code>withoutGlobalScopes</code> 方法：</p>
<pre><code>// 取消所有的全局作用域...
User::withoutGlobalScopes()-&gt;get();

// 取消部分全局作用域...
User::withoutGlobalScopes([
    FirstScope::class, SecondScope::class
])-&gt;get();</code></pre>
<p><a name="local-scopes"></a></p>
<h3>局部作用域</h3>
<p>局部作用域允许定义通用的约束集合以便在应用程序中重复使用。例如，你可能经常需要获取所有「流行」的用户。要定义这样一个范围，只需要在对应的 Eloquent 模型方法前添加 <code>scope</code> 前缀。</p>
<p>作用域总是返回一个查询构造器实例：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    /**
     *只查询受欢迎的用户的作用域
     *
     * @param  \Illuminate\Database\Eloquent\Builder  $query
     * @return \Illuminate\Database\Eloquent\Builder
     */
    public function scopePopular($query)
    {
        return $query-&gt;where('votes', '&gt;', 100);
    }

    /**
     * 只查询 active 用户的作用域
     *
     * @param  \Illuminate\Database\Eloquent\Builder  $query
     * @return \Illuminate\Database\Eloquent\Builder
     */
    public function scopeActive($query)
    {
        return $query-&gt;where('active', 1);
    }
}</code></pre>
<p><a name="utilizing-a-local-scope"></a></p>
<h4>使用本地作用域</h4>
<p>一旦定义了作用域，就可以在查询该模型时调用作用域方法。不过，在调用这些方法时不必包含 <code>scope</code> 前缀。甚至可以链式调用多个作用域，例如：</p>
<pre><code>$users = App\Models\User::popular()-&gt;active()-&gt;orderBy('created_at')-&gt;get();</code></pre>
<p>借助 <code>or</code> 查询运行符整合多个 Eloquent 模型，可能需要使用闭包回调：</p>
<pre><code>$users = App\Models\User::popular()-&gt;orWhere(function (Builder $query) {
    $query-&gt;active();
})-&gt;get();</code></pre>
<p>因为这样可能会有点麻烦，Laravel 提供了「更高阶的」<code>orWhere</code> 方法，它允许你在链式调用作用域时不使用闭包：</p>
<pre><code>$users = App\Models\User::popular()-&gt;orWhere-&gt;active()-&gt;get();</code></pre>
<p><a name="utilizing-a-local-scope"></a></p>
<h4>动态作用域</h4>
<p>有时可能地希望定义一个可以接受参数的作用域。把额外参数传递给作用域就可以达到此目的。作用域参数要放在 <code>$query</code> 参数之后：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    /**
     *将查询作用域限制为仅包含给定类型的用户
     *
     * @param  \Illuminate\Database\Eloquent\Builder  $query
     * @param  mixed  $type
     * @return \Illuminate\Database\Eloquent\Builder
     */
    public function scopeOfType($query, $type)
    {
        return $query-&gt;where('type', $type);
    }
}</code></pre>
<p>这样就可以在调用作用域时传递参数了：</p>
<pre><code>$users = App\Models\User::ofType('admin')-&gt;get();</code></pre>
<p><a name="comparing-models"></a></p>
<h2>模型比较</h2>
<p>有时可能需要判断两个模型是否「相同」。<code>is</code> 方法可以用来快速校验两个模型是否拥有相同的主键、表和数据库连接：</p>
<pre><code>if ($post-&gt;is($anotherPost)) {
    //
}</code></pre>
<p>当使用 <code>belongsTo</code>、<code>hasOne</code>、<code>morphTo</code> 和 <code>morphOne</code> 关系时，<code>is</code> 方法也可用。当你想要比较一个相关的模型而不需要发出检索该模型的查询时，这个方法特别有用:</p>
<pre><code>if ($post-&gt;author()-&gt;is($user)) {
    //
}</code></pre>
<p><a name="events"></a></p>
<h2>事件</h2>
<p>Eloquent 模型触发几个事件，允许你挂接到模型生命周期的如下节点： <code>retrieved</code>、<code>creating</code>、<code>created</code>、<code>updating</code>、<code>updated</code>、<code>saving</code>、<code>saved</code>、<code>deleting</code>、<code>deleted</code>、<code>restoring</code>、<code>restored</code>、<code>replicating</code>。事件允许你每当特定模型保存或更新数据库时执行代码。每个事件通过其构造器接受模型实例。</p>
<p><code>retrieved</code> 事件在现有模型从数据库中查找数据时触发。当新模型每一次保存时，<code>creating</code> 和 <code>created</code> 事件被触发。如果数据库中已经存在模型并且调用了 <code>save</code> 方法，<code>updating</code> / <code>updated</code> 事件被触发。这些情况下，<code>saving</code> / <code>saved</code> 事件也被触发。</p>
<blockquote>
<p>注意：通过 Eloquent 进行批量更新时，被更新模型的 <code>saved</code> 和 <code>updated</code>, <code>deleting</code> 和 <code>deleted</code>  事件不会被触发。这是因为批量更新时，并没有真的获取模型。</p>
</blockquote>
<p>首先，在 Eloquent 模型上定义一个 <code>$dispatchesEvents</code> 属性，将 Eloquent 模型生命周期的几个节点映射到你自己的 <a href="/docs/laravel_8_zh/events.html">event 类</a>：</p>
<pre><code>&lt;?php

namespace App\Models;

use App\Events\UserDeleted;
use App\Events\UserSaved;
use Illuminate\Foundation\Auth\User as Authenticatable;

class User extends Authenticatable
{
    use Notifiable;

    /**
     * 模型的事件映射
     *
     * @var array
     */
    protected $dispatchesEvents = [
        'saved' =&gt; UserSaved::class,
        'deleted' =&gt; UserDeleted::class,
    ];
}</code></pre>
<p>定义并且映射了 Eloquent 事件，就可以使用 <a href="https://laravel.com/docs/laravel_8_zh/events#defining-listeners">事件监听</a>处理这些事件了。</p>
<p><a name="events-using-closures"></a></p>
<h3>使用闭包</h3>
<p>你可以注册在触发各种模型事件时执行的闭包，而不使用自定义事件类。 通常，你应该在模型的 <code>booted</code> 方法中注册这些闭包：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    /**
     * 模型的 "booted" 方法
     *
     * @return void
     */
    protected static function booted()
    {
        static::created(function ($user) {
            //
        });
    }
}</code></pre>
<p>如果需要，可以在注册模型事件时利用<a href="/docs/laravel_8_zh/events.html#queuable-anonymous-event-listeners">队列匿名事件侦听器</a> 。 这将指示 Laravel使用<a href="/docs/laravel_8_zh/queues.html">queue</a> 执行模型事件侦听器：</p>
<pre><code>use function Illuminate\Events\queueable;

static::created(queueable(function ($user) {
    //
}));</code></pre>
<p><a name="observers"></a></p>
<h3>观察者</h3>
<p><a name="defining-observers"></a></p>
<h4>定义观察者</h4>
<p>如果在一个模型上监听了多个事件，可以使用观察者来将这些监听器组织到一个单独的类中。观察者类的方法名映射到你希望监听的 Eloquent 事件。 这些方法都以模型作为其唯一参数。<code>make:observer</code> Artisan 命令可以快速建立新的观察者类：</p>
<pre><code>php artisan make:observer UserObserver --model=User</code></pre>
<p>此命令将在 <code>App/Observers</code> 文件夹放置新的观察者类。如果这个目录不存在，Artisan 将替你创建。使用如下方式开启观察者：</p>
<pre><code>&lt;?php

namespace App\Observers;

use App\Models\User;

class UserObserver
{
    /**
     * 处理 User「created」事件
     *
     * @param  \App\Models\User  $user
     * @return void
     */
    public function created(User $user)
    {
        //
    }

    /**
     * 处理 User「updated」事件
     *
     * @param  \App\Models\User  $user
     * @return void
     */
    public function updated(User $user)
    {
        //
    }

    /**
     * 处理 User「deleted」事件
     *
     * @param  \App\Models\User  $user
     * @return void
     */
    public function deleted(User $user)
    {
        //
    }

    /**
     * 处理 User「forceDeleted」事件
     *
     * @param  \App\Models\User  $user
     * @return void
     */
    public function forceDeleted(User $user)
    {
        //
    }
}</code></pre>
<p>在你希望观察的模型上使用 <code>observe</code> 方法注册观察者。也可以在服务提供者的 <code>boot</code> 方法注册观察者。下面是在 <code>AppServiceProvider</code> 中注册观察者的示例：</p>
<pre><code>&lt;?php

namespace App\Providers;

use App\Observers\UserObserver;
use App\Models\User;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * 注册服务提供者
     *
     * @return void
     */
    public function register()
    {
        //
    }

    /**
     * 引导应用程序服务
     *
     * @return void
     */
    public function boot()
    {
        User::observe(UserObserver::class);
    }
}</code></pre>
<p><a name="muting-events"></a></p>
<h3>禁用事件</h3>
<p>您可能偶尔希望暂时「禁用」模型触发的所有事件。 您可以使用<code>withoutEvents</code>方法来实现。 <code>withoutEvents</code>方法接受闭包作为唯一的参数。 在此闭包中执行的任何代码都不会触发模型事件。 例如，以下代码将获取并删除一个 <code>App\Models\User</code> 实例，而不会触发任何模型事件。 给定闭包返回的任何值都将通过 <code>withoutEvents</code> 方法返回：</p>
<pre><code>use App\Models\User;

$user = User::withoutEvents(function () use () {
    User::findOrFail(1)-&gt;delete();

    return User::find(2);
});</code></pre>
<p><a name="saving-a-single-model-without-events"></a></p>
<h4>无事件的单个模型保存</h4>
<p>有时，您可能希望「保存」给定的模型而不会触发任何事件。 您可以使用<code>saveQuietly</code> 方法完成此操作：</p>
<pre><code>$user = User::findOrFail(1);

$user-&gt;name = 'Victoria Faith';

$user-&gt;saveQuietly();</code></pre>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-xl-2" id="toc-list">
        <ul></ul>
    </div>
</div>    </div>
</div>
<span id="back-top">
<svg width="20" height="20" fill="currentColor">
    <use xlink:href="/css/bootstrap-icons.svg#chevron-up"/>
</svg>
</span>
 
<script>
    // 浏览量统计
    $(function () {
        let formdata = new FormData();
        formdata.append('_token', '');
        formdata.append('id', 329);
        $.ajax({
            url: $(".sticky-top .navbar-brand").attr('href') + "/api/doc/clicks",
            type: 'POST',
            data: formdata,
            processData: false,
            contentType: false
        });
    });
    // aside-hidden
    $(function () {
        $('#aside-hidden').on('click', function () {
            $('.aside').toggle(0, function () {
                if ($(this).is(':visible')) {
                    $('.aside-middle').removeClass('col-md-12 col-lg-12').addClass('col-md-9 col-lg-10');
                } else {
                    $('.aside-middle').removeClass('col-md-9 col-lg-10').addClass('col-md-12 col-lg-12');
                }
            });
        });
    });
</script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?1522d01c436f59ddc8389f25bfa9d53e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
</body>
</html>