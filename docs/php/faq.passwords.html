<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"> 
    <meta name="csrf-token" content=""> 
    <title>密码散列安全 - 开发帮助文档</title> 
    <meta name="keyword" content="faq.passwords"> 
    <meta name="description" content="faq.passwords"> 
    <meta name="author" content="Moments"> 
    <link href="/favicon.ico" rel="shortcut icon"> 
    <link href="/css/blog.css" rel="stylesheet"> 
    <script src="/js/blog.js"></script> 
</head>
<body>
<header class="sticky-top">
    <nav class="navbar navbar-expand navbar-dark bg-secondary justify-content-between text-uppercase">
        <div class="navbar-nav" style="overflow:hidden;">
            <a class="navbar-brand" href="https://help.pythonschool.com">
                <span class="d-md-none">
                    <svg class="text-warning" width="24" height="24" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#emoji-sunglasses"/>
                    </svg>
                </span>
                <span class="d-none d-md-flex">开发帮助文档</span>
            </a>
            <div class="navbar-nav-scroll" style="overflow: hidden;">
                <ul class="navbar-nav text-nowrap pb-4" style="overflow:auto;">
                                            <li class="nav-item">
                            <a class="nav-link" href="/docs/laravel/index.html">laravel</a>
                        </li>
                                            <li class="nav-item">
                            <a class="nav-link active" href="/docs/php/index.html">php</a>
                        </li>
                                    </ul>
            </div>
        </div>
        <div class="d-inline-flex">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/liuhuashi">
                        <svg class="text-light" width="24" height="24" fill="currentColor">
                            <use xlink:href="/css/bootstrap-icons.svg#github"/>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<div class="container-fluid">
    <div id="aside-hidden" class="position-fixed" style="left:0;top: 58px;cursor:pointer;z-index: 10000;">
        <svg class="align-text-bottom text-warning" width="16" height="16" fill="currentColor" stroke="currentColor" stroke-width="1">
            <use xlink:href="/css/bootstrap-icons.svg#arrow-left-square"/>
        </svg>
    </div>
    <div class="row">
        <div class="aside col-md-3 col-lg-2 border-right shadow position-sticky" style="overflow:auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
    <form class="row border-bottom p-3 bg-white sticky-top">
        <input id="search-version" class="form-control" data-version="28" type="search" placeholder="英文逗号分隔,分词搜索">
    </form>
    <ul class="nav navbar-nav nav-pills flex-column pt-2 figure-caption">
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.build.html" title="编译问题">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    编译问题
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.com.html" title="PHP 和 COM">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    PHP 和 COM
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.databases.html" title="数据库问题">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库问题
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.general.html" title="一般信息">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    一般信息
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.html.html" title="PHP 和 HTML">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    PHP 和 HTML
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.installation.html" title="安装常见问题">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    安装常见问题
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.mailinglist.html" title="邮件列表">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    邮件列表
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.misc.html" title="其他问题">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    其他问题
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.obtaining.html" title="获取 PHP">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    获取 PHP
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.passwords.html" title="密码散列安全">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    密码散列安全
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/faq.using.html" title="使用 PHP">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    使用 PHP
                </a>
            </li>
            </ul>
</div>        <div class="aside-middle col-md-9 col-lg-10 row">
    <div class="col-md-9 col-xl-10" style="overflow: auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
        <div class="container main-h4-1">
            <div class="page-content">
                <div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="faq.using.html">« 使用 PHP</a></li>
      <li style="float: right;"><a href="faq.html.html">PHP 和 HTML »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="documentation.html">PHP Manual</a></li>
    <li><a href="faq.html">FAQ</a></li>
    <li>密码散列安全</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="faq.passwords" class="chapter">
  <h1>密码散列安全</h1>

  
  
  <p class="para">
      本部分解释使用散列函数对密码进行安全处理背后的原因，
      以及如何有效的进行密码散列处理。
  </p>
  
  <div class="qandaset"><ol class="qandaset_questions"><li><a href="#faq.passwords.hashing">
     
         为什么需要把应用程序中用户的密码进行散列化？
     
    </a></li><li><a href="#faq.passwords.fasthash">
     
      为何诸如 md5 和
      sha1 这样的常见散列函数不适合用在密码保护场景？
     
    </a></li><li><a href="#faq.passwords.bestpractice">
     
         如果不建议使用常用散列函数保护密码，
         那么我应该如何对密码进行散列处理？
     
    </a></li><li><a href="#faq.passwords.salt">
     
      “盐”是什么？
     
    </a></li><li><a href="#faq.password.storing-salts">
     
      我应该如何保存“盐”？
     
    </a></li></ol></div>
   <dl class="qandaentry" id="faq.passwords.hashing">
    <dt><strong>
     
         为什么需要把应用程序中用户的密码进行散列化？
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
         当设计一个需要接受用户密码的应用时，
         对密码进行散列是最基本的，也是必需的安全考虑。
         如果不对密码进行散列处理，那么一旦应用的数据库受到攻击，
         那么用户的密码将被窃取。
         同时，窃取者也可以使用用户账号和密码去尝试其他的应用，
         如果用户没有为每个应用单独设置密码，那么将面临风险。
     </p>
     <p class="para">
         通过对密码进行散列处理，然后再保存到数据库中，
         这样就使得攻击者无法直接获取原始密码，
        同时还可以保证你的应用可以对原始密码进行相同的散列处理，
        然后比对散列结果。
     </p>
     <p class="para">
         需要着重提醒的是，密码散列只能保护密码
         不会被从数据库中直接窃取，
         但是无法保证注入到应用中的
         恶意代码拦截到原始密码。
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.passwords.fasthash">
    <dt><strong>
     
      为何诸如 <span class="function"><a href="function.md5.html" class="function">md5()</a></span> 和
      <span class="function"><a href="function.sha1.html" class="function">sha1()</a></span> 这样的常见散列函数不适合用在密码保护场景？
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
         MD5，SHA1 以及 SHA256 这样的散列算法是面向快速、高效
         进行散列处理而设计的。随着技术进步和计算机硬件的提升，
         破解者可以使用“暴力”方式来寻找散列码
         所对应的原始数据。
     </p>
     <p class="para">
         因为现代化计算机可以快速的“反转”上述散列算法的散列值，
         所以很多安全专家都强烈建议
         不要在密码散列中使用这些散列算法。
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.passwords.bestpractice">
    <dt><strong>
     
         如果不建议使用常用散列函数保护密码，
         那么我应该如何对密码进行散列处理？
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
         当进行密码散列处理的时候，有两个必须考虑的因素：
         计算量以及“盐”。
         散列算法的计算量越大，
         暴力破解所需的时间就越长。
     </p>
     <p class="para">
         PHP 5.5 提供了 
         <a href="book.password.html" class="link">一个原生密码散列 API</a>，
         它提供一种安全的方式来完成密码 <a href="function.password-hash.html" class="link">散列</a>和
          <a href="function.password-verify.html" class="link">验证</a>。
          PHP 5.3.7 及后续版本中都提供了一个
        <a href="https://github.com/ircmaxell/password_compat" class="link external">» 纯 PHP 的兼容库</a>。
     </p>
     <p class="para">
      PHP 5.3 及后续版本中，还可以使用 <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> 函数，
      它支持多种散列算法。
      针对每种受支持的散列算法，PHP 都提供了对应的原生实现，
      所以在使用此函数的时候，
      你需要保证所选的散列算法是你的系统所能够支持的。
     </p>
     <p class="para">
      当对密码进行散列处理的时候，建议采用 Blowfish 算法，
      这是密码散列 API 的默认算法。
      相比 MD5 或者 SHA1，这个算法提供了更高的计算量，
      同时还有具有良好的伸缩性。
     </p>
     <p class="para">
      如果使用 <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> 函数来进行密码验证，
      那么你需要选择一种耗时恒定的字符串比较算法来避免时序攻击。
      （译注：就是说，字符串比较所消耗的时间恒定，
      不随输入数据的多少变化而变化）
      PHP 中的 <a href="language.operators.comparison.html" class="link">== 和 === 操作符</a>
      和 <span class="function"><a href="function.strcmp.html" class="function">strcmp()</a></span> 函数都不是耗时恒定的字符串比较，
      但是 <span class="function"><a href="function.password-verify.html" class="function">password_verify()</a></span> 可以帮你完成这项工作。
      我们鼓励你尽可能的使用
       <a href="book.password.html" class="link">原生密码散列 API</a>。
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.passwords.salt">
    <dt><strong>
     
      “盐”是什么？
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      加解密领域中的“盐”是指在进行散列处理的过程中
      加入的一些数据，用来避免从已计算的散列值表
      （被称作“彩虹表”）中
      对比输出数据从而获取明文密码的风险。
     </p>
     <p class="para">
      简单而言，“盐”就是为了提高散列值被破解的难度
      而加入的少量数据。
      现在有很多在线服务都能够提供
      计算后的散列值以及其对应的原始输入的清单，
      并且数据量极其庞大。
      通过加“盐”就可以避免直接从清单中查找到对应明文的风险。
     </p>
     <p class="para">
      如果不提供“盐”，<span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span> 函数会随机生成“盐”。
      非常简单，行之有效。
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.password.storing-salts">
    <dt><strong>
     
      我应该如何保存“盐”？
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      当使用 <span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span> 或者 <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> 函数时，
      “盐”会被作为生成的散列值的一部分返回。
      你可以直接把完整的返回值存储到数据库中，
      因为这个返回值中已经包含了足够的信息，
      可以直接用在 <span class="function"><a href="function.password-verify.html" class="function">password_verify()</a></span> 或 <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span>
      函数来进行密码验证。
     </p>
     <p class="para">
      下图展示了 <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> 或 <span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span>
      函数返回值的结构。
      如你所见，算法的信息以及“盐”都已经包含在返回值中，
      在后续的密码验证中将会用到这些信息。
     </p>
     <p class="para">
      </p><div class="mediaobject">
       
       <div class="imageobject">
        <img src="images/0af3dc557de5198c4312d2c38c08fbf0-crypt-text-rendered.svg" alt="
        password_hash 和 crypt 函数返回值的组成部分，依次为：所选择的算法，
        算法选项，所使用的“盐”，
        以及散列后的密码。
       " width="690" height="192">
       </div>
      </div>
     
    </dd>
   </dl>
  
  
 </div>
</div></div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-xl-2" id="toc-list">
        <ul></ul>
    </div>
</div>    </div>
</div>
<span id="back-top">
<svg width="20" height="20" fill="currentColor">
    <use xlink:href="/css/bootstrap-icons.svg#chevron-up"/>
</svg>
</span>
 
<script>
    // 浏览量统计
    $(function () {
        let formdata = new FormData();
        formdata.append('_token', '');
        formdata.append('id', 2281);
        $.ajax({
            url: $(".sticky-top .navbar-brand").attr('href') + "/api/doc/clicks",
            type: 'POST',
            data: formdata,
            processData: false,
            contentType: false
        });
    });
    // aside-hidden
    $(function () {
        $('#aside-hidden').on('click', function () {
            $('.aside').toggle(0, function () {
                if ($(this).is(':visible')) {
                    $('.aside-middle').removeClass('col-md-12 col-lg-12').addClass('col-md-9 col-lg-10');
                } else {
                    $('.aside-middle').removeClass('col-md-9 col-lg-10').addClass('col-md-12 col-lg-12');
                }
            });
        });
    });
</script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?1522d01c436f59ddc8389f25bfa9d53e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
</body>
</html>