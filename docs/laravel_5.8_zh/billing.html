<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"> 
    <meta name="csrf-token" content=""> 
    <title>Laravel 的收费系统 Cashier - 开发帮助文档</title> 
    <meta name="keyword" content="billing"> 
    <meta name="description" content="billing"> 
    <meta name="author" content="Moments"> 
    <link href="/favicon.ico" rel="shortcut icon"> 
    <link href="/css/blog.css" rel="stylesheet"> 
    <script src="/js/blog.js"></script> 
</head>
<body>
<header class="sticky-top">
    <nav class="navbar navbar-expand navbar-dark bg-secondary justify-content-between text-uppercase">
        <div class="navbar-nav" style="overflow:hidden;">
            <a class="navbar-brand" href="https://help.pythonschool.com">
                <span class="d-md-none">
                    <svg class="text-warning" width="24" height="24" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#emoji-sunglasses"/>
                    </svg>
                </span>
                <span class="d-none d-md-flex">开发帮助文档</span>
            </a>
            <div class="navbar-nav-scroll" style="overflow: hidden;">
                <ul class="navbar-nav text-nowrap pb-4" style="overflow:auto;">
                                            <li class="nav-item">
                            <a class="nav-link active" href="/docs/laravel/index.html">laravel</a>
                        </li>
                                            <li class="nav-item">
                            <a class="nav-link" href="/docs/php/index.html">php</a>
                        </li>
                                    </ul>
            </div>
        </div>
        <div class="d-inline-flex">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/liuhuashi">
                        <svg class="text-light" width="24" height="24" fill="currentColor">
                            <use xlink:href="/css/bootstrap-icons.svg#github"/>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<div class="container-fluid">
    <div id="aside-hidden" class="position-fixed" style="left:0;top: 58px;cursor:pointer;z-index: 10000;">
        <svg class="align-text-bottom text-warning" width="16" height="16" fill="currentColor" stroke="currentColor" stroke-width="1">
            <use xlink:href="/css/bootstrap-icons.svg#arrow-left-square"/>
        </svg>
    </div>
    <div class="row">
        <div class="aside col-md-3 col-lg-2 border-right shadow position-sticky" style="overflow:auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
    <form class="row border-bottom p-3 bg-white sticky-top">
        <input id="search-version" class="form-control" data-version="5" type="search" placeholder="英文逗号分隔,分词搜索">
    </form>
    <ul class="nav navbar-nav nav-pills flex-column pt-2 figure-caption">
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/about.html" title="Laravel 5.8 中文文档">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 5.8 中文文档
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/api-authentication.html" title="API Authentication">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    API Authentication
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/artisan.html" title="Laravel 的 Artisan 命令行工具">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 Artisan 命令行工具
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/authentication.html" title="Laravel 的用户认证系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的用户认证系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/authorization.html" title="Laravel 的用户授权系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的用户授权系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/billing.html" title="Laravel 的收费系统 Cashier">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的收费系统 Cashier
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/blade.html" title="Laravel 的 Blade 模板引擎">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 Blade 模板引擎
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/braintree.html" title="Laravel Cashier (Braintree)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Cashier (Braintree)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/broadcasting.html" title="Laravel 的事件广播系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的事件广播系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/cache.html" title="Laravel 的缓存系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的缓存系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/collections.html" title="Laravel 的集合 Collection">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的集合 Collection
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/configuration.html" title="Laravel 的配置信息">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的配置信息
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/console-tests.html" title="Console Tests">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Console Tests
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/container.html" title="Laravel 服务容器解析">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 服务容器解析
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/contracts.html" title="Laravel 的契约 (Contracts)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的契约 (Contracts)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/contributions.html" title="Laravel 源代码贡献指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 源代码贡献指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/controllers.html" title="Laravel 的 HTTP 控制器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 HTTP 控制器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/csrf.html" title="Laravel 下的伪造跨站请求保护 CSRF">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 下的伪造跨站请求保护 CSRF
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/database-testing.html" title="Laravel 测试之 - 数据库测试">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试之 - 数据库测试
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/database.html" title="数据库：入门">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库：入门
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/deployment.html" title="Laravel 的部署">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的部署
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/documentation.html" title="主页(Index)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    主页(Index)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/dusk.html" title="Laravel 测试之 - 浏览器测试 (Laravel Dusk)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试之 - 浏览器测试 (Laravel Dusk)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-collections.html" title="Eloquent：集合">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent：集合
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-mutators.html" title="Eloquent： 修改器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent： 修改器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-relationships.html" title="Eloquent：关联">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent：关联
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-resources.html" title="Eloquent: API 资源">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: API 资源
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-serialization.html" title="Eloquent: 序列化">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 序列化
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent.html" title="Eloquent: 入门">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 入门
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/encryption.html" title="Laravel 的加密解密机制">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的加密解密机制
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/envoy.html" title="Laravel 的远程服务器任务处理器 Envoy">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的远程服务器任务处理器 Envoy
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/errors.html" title="Laravel 的错误和日志记录">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的错误和日志记录
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/events.html" title="Laravel 的事件系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的事件系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/facades.html" title="Laravel 的 Facades">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 Facades
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/filesystem.html" title="Laravel 的文件系统和云存储功能集成">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的文件系统和云存储功能集成
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/frontend.html" title="Laravel 的前端资源处理 JavaScript＆CSS 构建">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的前端资源处理 JavaScript＆CSS 构建
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/hashing.html" title="Laravel 的哈希加密">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的哈希加密
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/helpers.html" title="Laravel 的辅助函数列表">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的辅助函数列表
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/homestead.html" title="Laravel 虚拟开发环境 Homestead">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 虚拟开发环境 Homestead
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/horizon.html" title="Laravel 队列监控面板 - Horizon">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 队列监控面板 - Horizon
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/http-tests.html" title="Laravel 测试之：HTTP 测试">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试之：HTTP 测试
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/installation.html" title="Laravel 安装指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 安装指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/license.html" title="license">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    license
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/lifecycle.html" title="Laravel 的请求生命周期">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的请求生命周期
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/localization.html" title="Laravel 的本地化功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的本地化功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/logging.html" title="Logging">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Logging
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/mail.html" title="Laravel 的 邮件发送功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 邮件发送功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/middleware.html" title="Laravel 的路由中间件">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的路由中间件
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/migrations.html" title="Laravel 的数据库迁移 Migrations">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的数据库迁移 Migrations
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/mix.html" title="Laravel 的资源任务编译器 Laravel Mix">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的资源任务编译器 Laravel Mix
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/mocking.html" title="Laravel 测试之：测试模拟器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试之：测试模拟器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/notifications.html" title="Laravel 的消息通知系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的消息通知系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/packages.html" title="Laravel 的扩展插件开发指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的扩展插件开发指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/pagination.html" title="Laravel 的分页功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的分页功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/passport.html" title="Laravel 的 API 认证系统 Passport">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 API 认证系统 Passport
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/passwords.html" title="Laravel 的密码重置功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的密码重置功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/providers.html" title="Laravel 的服务提供器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的服务提供器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/queries.html" title="Laravel 数据库之：数据库请求构建器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 数据库之：数据库请求构建器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/queues.html" title="Laravel 的队列系统介绍">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的队列系统介绍
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/readme.html" title="Laravel Documentation">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Documentation
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/redirects.html" title="Laravel 的 HTTP 重定向 Redirect">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 HTTP 重定向 Redirect
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/redis.html" title="Laravel 的 Redis 使用指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 Redis 使用指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/releases.html" title="发行说明">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    发行说明
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/requests.html" title="Laravel 的 HTTP 请求">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 HTTP 请求
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/responses.html" title="Laravel 的请求响应">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的请求响应
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/routing.html" title="Laravel HTTP 路由功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel HTTP 路由功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/scheduling.html" title="Laravel 的任务调度（计划任务）功能 Task Scheduling">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的任务调度（计划任务）功能 Task Scheduling
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/scout.html" title="Laravel 的搜索系统 Scout">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的搜索系统 Scout
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/seeding.html" title="Laravel 数据库之：数据填充">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 数据库之：数据填充
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/session.html" title="Laravel 的 HTTP 会话机制">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 HTTP 会话机制
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/socialite.html" title="Laravel 的 社会化登录功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 社会化登录功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/structure.html" title="Laravel 的文件夹结构">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的文件夹结构
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/telescope.html" title="Laravel Telescope">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Telescope
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/testing.html" title="Laravel 测试: 入门指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试: 入门指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/upgrade.html" title="Laravel 升级索引">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 升级索引
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/urls.html" title="Laravel 的 URL 生成">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 URL 生成
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/valet.html" title="Laravel 的开发环境 Valet">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的开发环境 Valet
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/validation.html" title="Laravel 的表单验证机制详解">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的表单验证机制详解
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/verification.html" title="Email Verification">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Email Verification
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/views.html" title="Laravel 的视图">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的视图
                </a>
            </li>
            </ul>
</div>        <div class="aside-middle col-md-9 col-lg-10 row">
    <div class="col-md-9 col-xl-10" style="overflow: auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
        <div class="container main-h4-1">
            <div class="page-content">
                <h1>Laravel 的收费系统 Cashier</h1>
<ul>
<li><a href="#introduction">简介</a></li>
<li><a href="#configuration">配置</a>
<ul>
<li><a href="#stripe-configuration">Stripe</a></li>
<li><a href="#braintree-configuration">Braintree</a></li>
<li><a href="#currency-configuration">货币配置</a></li>
</ul></li>
<li><a href="#subscriptions">订阅</a>
<ul>
<li><a href="#creating-subscriptions">创建订阅</a></li>
<li><a href="#checking-subscription-status">检查订阅状态</a></li>
<li><a href="#changing-plans">修改订阅计划</a></li>
<li><a href="#subscription-quantity">订阅量</a></li>
<li><a href="#subscription-taxes">订阅税额</a></li>
<li><a href="#cancelling-subscriptions">取消订阅</a></li>
<li><a href="#resuming-subscriptions">恢复订阅</a></li>
<li><a href="#updating-credit-cards">更新信用卡</a></li>
</ul></li>
<li><a href="#subscription-trials">试用订阅</a>
<ul>
<li><a href="#with-credit-card-up-front">有信用卡的情况下</a></li>
<li><a href="#without-credit-card-up-front">在没有信用卡的情况下</a></li>
</ul></li>
<li><a href="#handling-stripe-webhooks">处理 Stripe Webhooks</a>
<ul>
<li><a href="#defining-webhook-event-handlers">定义 Webhook 事件处理程序</a></li>
<li><a href="#handling-failed-subscriptions">订阅失败</a></li>
</ul></li>
<li><a href="#handling-braintree-webhooks">处理 Braintree Webhooks    </a>
<ul>
<li><a href="#defining-braintree-webhook-event-handlers">定义 Webhook 事件处理程序</a></li>
<li><a href="#handling-braintree-failed-subscriptions">订阅失败</a></li>
</ul></li>
<li><a href="#single-charges">一次性收费</a></li>
<li><a href="#invoices">发票</a>
<ul>
<li><a href="#generating-invoice-pdfs">生成发票的 PDFs</a></li>
</ul></li>
</ul>
<p><a name="introduction"></a></p>
<h2>简介</h2>
<p>Laravel Cashier 提供了直观、流畅的接口来接入 <a href="https://stripe.com">Stripe's</a> and <a href="https://www.braintreepayments.com">Braintree's</a> 订阅付费服务。它可以处理几乎所有你写起来非常头疼付费订阅代码。除了提供基本的订阅管理之外，Cashier 还可以帮你处理优惠券，交换订阅、订阅“数量”、取消宽限期，甚至还可以生成pdf文档。</p>
<blockquote>
<p>{note} 如果你只是“一次性”的收费并且不提供订阅。你就不应该使用 Cashier 。可以直接使用 Stripe 和 Braintree 的 sdk。</p>
</blockquote>
<p><a name="configuration"></a></p>
<h2>配置</h2>
<p><a name="stripe-configuration"></a></p>
<h3>Stripe</h3>
<h4>Composer</h4>
<p>首先, 将 Stripe 的 Cashier 包添加到您的依赖项中：</p>
<pre><code>composer require "laravel/cashier":"~7.0"</code></pre>
<h4>服务提供者</h4>
<p>下一步, 在 <code>config/app.php</code> 配置文件中，注册 <code>Laravel\Cashier\CashierServiceProvider</code> <a href="/docs/laravel_5.8_zh/providers.html">服务提供者</a>.</p>
<h4>数据库迁移</h4>
<p>在使用 Cashier 之前，我们需要 <a href="/docs/laravel_5.8_zh/migrations.html">准备数据库</a>. 我们需要向您的 <code>users</code> 表中添加几个列，并创建一个新的 <code>subscriptions</code> 表来保存所有客户的订阅：</p>
<pre><code>Schema::table('users', function ($table) {
    $table-&gt;string('stripe_id')-&gt;nullable();
    $table-&gt;string('card_brand')-&gt;nullable();
    $table-&gt;string('card_last_four')-&gt;nullable();
    $table-&gt;timestamp('trial_ends_at')-&gt;nullable();
});

Schema::create('subscriptions', function ($table) {
    $table-&gt;increments('id');
    $table-&gt;integer('user_id');
    $table-&gt;string('name');
    $table-&gt;string('stripe_id');
    $table-&gt;string('stripe_plan');
    $table-&gt;integer('quantity');
    $table-&gt;timestamp('trial_ends_at')-&gt;nullable();
    $table-&gt;timestamp('ends_at')-&gt;nullable();
    $table-&gt;timestamps();
});</code></pre>
<p>一旦迁移文件建立好后，运行 Artisan 的 <code>migrate</code> 命令。</p>
<h4>Billable 模型</h4>
<p>下一步, 需要添加 <code>Billable</code> trait 到你的模型定义。trait 提供各种方法让您执行常见的帐单任务，例如：创建订阅、应用优惠券和更新信用卡信息：</p>
<pre><code>use Laravel\Cashier\Billable;

class User extends Authenticatable
{
    use Billable;
}</code></pre>
<h4>API Keys</h4>
<p>最后, 你需要在 <code>services.php</code> 配置文件中设置你的 Stripe key 。 你可以在 Stripe 的控制面板获取到相关的 API keys。</p>
<pre><code>'stripe' =&gt; [
    'model'  =&gt; App\User::class,
    'key' =&gt; env('STRIPE_KEY'),
    'secret' =&gt; env('STRIPE_SECRET'),
],</code></pre>
<p><a name="braintree-configuration"></a></p>
<h3>Braintree</h3>
<h4>Braintree 注意事项</h4>
<p>对于许多操作，Cashier 的 Stripe 和 Braintree 实现都是一样的。这两项服务都提供信用卡支付服务，但 Braintree 支持通过 PayPal 支付。然而，Braintree 也缺少一些由 Stripe 支持的功能。当你决定使用 Stripe 或 Braintree 时，你应该记住以下几点：</p>
<div class="content-list">
<ul>
<li>Braintree 支持 PayPal ，而 Stripe 不支持.</li>
<li>Braintree 不支持订阅的 <code>increment</code> 和 <code>decrement</code> 方法。这是 Braintree 的限制，而不是 Cashier 限制。</li>
<li>Braintree 不支持基于百分比的折扣。这是 Braintree 的限制，而不是 Cashier 限制。</li>
</ul>
</div>
<h4>Composer</h4>
<p>首先，将 Braintree 的 Cashier 包添加到您的依赖项：</p>
<pre><code>composer require "laravel/cashier-braintree":"~2.0"</code></pre>
<h4>服务提供者</h4>
<p>下一步, 在 <code>config/app.php</code> 配置文件中，注册  <code>Laravel\Cashier\CashierServiceProvider</code> <a href="/docs/laravel_5.8_zh/providers.html">服务提供者</a>：</p>
<pre><code>Laravel\Cashier\CashierServiceProvider::class</code></pre>
<h4>信用卡优惠计划</h4>
<p>在使用 Cashier 之前，你需要首先在 Braintree 控制面板定义一个 <code>plan-credit</code> 折扣。这个折扣会根据用户选择的支付选项匹配合适的折扣比例，比如选择年付还是月付。</p>
<p>在 Braintree 控制面板中配置的折扣总额可以随意填，Cashier 会在每次使用优惠券的时候根据我们自己的定制覆盖该默认值。由于 Braintree 不支持在订阅频率上来匹配折扣比例，所以这一优惠券是必需的。</p>
<h4>数据库迁移</h4>
<p>开始使用 Cashier 之前, 我们需要 <a href="/docs/laravel_5.8_zh/migrations.html">准备一下数据库</a>.我们需要在数据库的 <code>users</code> 表中新增几列，以及创建一个新的 <code>subscriptions</code> 表来存储客户的订阅信息：</p>
<pre><code>Schema::table('users', function ($table) {
    $table-&gt;string('braintree_id')-&gt;nullable();
    $table-&gt;string('paypal_email')-&gt;nullable();
    $table-&gt;string('card_brand')-&gt;nullable();
    $table-&gt;string('card_last_four')-&gt;nullable();
    $table-&gt;timestamp('trial_ends_at')-&gt;nullable();
});

Schema::create('subscriptions', function ($table) {
    $table-&gt;increments('id');
    $table-&gt;integer('user_id');
    $table-&gt;string('name');
    $table-&gt;string('braintree_id');
    $table-&gt;string('braintree_plan');
    $table-&gt;integer('quantity');
    $table-&gt;timestamp('trial_ends_at')-&gt;nullable();
    $table-&gt;timestamp('ends_at')-&gt;nullable();
    $table-&gt;timestamps();
});</code></pre>
<p>一旦迁移文件建立好后，运行 Artisan 的 <code>migrate</code> 命令。</p>
<h4>Billable 模型</h4>
<p>下一步, 添加 <code>Billable</code> trait 到你的模型定义 ：</p>
<pre><code>use Laravel\Cashier\Billable;

class User extends Authenticatable
{
    use Billable;
}</code></pre>
<h4>API Keys</h4>
<p>下一步, 你应该在 <code>services.php</code> 文件中，参考下面的配置选项:</p>
<pre><code>'braintree' =&gt; [
    'model'  =&gt; App\User::class,
    'environment' =&gt; env('BRAINTREE_ENV'),
    'merchant_id' =&gt; env('BRAINTREE_MERCHANT_ID'),
    'public_key' =&gt; env('BRAINTREE_PUBLIC_KEY'),
    'private_key' =&gt; env('BRAINTREE_PRIVATE_KEY'),
],</code></pre>
<p>然后，你应该向 <code>AppServiceProvider</code> 服务提供商的 <code>boot</code> 方法中，添加以下的 Braintree SDK 调用：</p>
<pre><code>\Braintree_Configuration::environment(config('services.braintree.environment'));
\Braintree_Configuration::merchantId(config('services.braintree.merchant_id'));
\Braintree_Configuration::publicKey(config('services.braintree.public_key'));
\Braintree_Configuration::privateKey(config('services.braintree.private_key'));</code></pre>
<p><a name="currency-configuration"></a></p>
<h3>货币配置</h3>
<p>Cashier 使用美元（USD）作为默认货币。你可以通过在服务提供者的 <code>boot</code> 方法中调用 <code>Cashier::useCurrency</code> 方法来更改默认的货币。这个 <code>useCurrency</code> 方法接受两个字符串参数：货币和货币符号：</p>
<pre><code>use Laravel\Cashier\Cashier;

Cashier::useCurrency('eur', '€');</code></pre>
<p><a name="subscriptions"></a></p>
<h2>订阅</h2>
<p><a name="creating-subscriptions"></a></p>
<h3>创建订阅</h3>
<p>创建订阅，首先需要获取到一个 billable 模型实例，这通常是 <code>App\User</code> 的一个实例。一旦您获取了模型实例，您可以使用 <code>newSubscription</code> 方法创建模型的订阅:</p>
<pre><code>$user = User::find(1);

$user-&gt;newSubscription('main', 'premium')-&gt;create($stripeToken);</code></pre>
<p><code>newSubscription</code> 方法的第一个参数应该是订阅的名称。如果您的应用程序只提供一个订阅，那么您可以将其设置为 <code>main</code> or <code>primary</code>。
第二个参数是用户订阅的 Stripe / Braintree 计划。这个值应该与 Stripe 或 Braintree 中的标识符对应。</p>
<p><code>create</code> 方法接受一个 Stripe 信用卡 / 源令牌，它将开始订阅，并使用客户 ID 和其他相关的账单信息更新数据库。</p>
<h4>用户其他的详细信息</h4>
<p>如果您想要指定用户其他的详细信息，您可以通过将它们作为第二个参数传递给 <code>create</code> 方法：</p>
<pre><code>$user-&gt;newSubscription('main', 'monthly')-&gt;create($stripeToken, [
    'email' =&gt; $email,
]);</code></pre>
<p>要了解更多关于 Stripe 或 Braintree 支持的额外字段，请查看 Stripe 的内容 <a href="https://stripe.com/docs/api#create_customer">创建客户文档</a> 或对应的 <a href="https://developers.braintreepayments.com/reference/request/customer/create/php">Braintree 文档</a>。</p>
<h4>优惠券</h4>
<p>如果您想在创建订阅时使用优惠券，您可以使用 <code>withCoupon</code> 方法：</p>
<pre><code>$user-&gt;newSubscription('main', 'monthly')
     -&gt;withCoupon('code')
     -&gt;create($stripeToken);</code></pre>
<p><a name="checking-subscription-status"></a></p>
<h3>检查订阅状态</h3>
<p>一旦用户在您的应用程序订阅了，您可以使用各种方便的方法轻松地检查他们的订阅状态。首先，如果用户有一个激活的订阅，那么 <code>subscribed</code> 的方法返回 <code>true</code> ，即使订阅当前处于试用阶段：</p>
<pre><code>if ($user-&gt;subscribed('main')) {
    //
}</code></pre>
<p>这个 <code>subscribed</code> 方法还可以在 <a href="/docs/laravel_5.8_zh/middleware.html">路由中间件</a> 使用，允许您根据用户的订阅状态对路由和控制器进行访问。</p>
<pre><code>public function handle($request, Closure $next)
{
    if ($request-&gt;user() &amp;&amp; ! $request-&gt;user()-&gt;subscribed('main')) {
        // 用户并没有完成支付...
        return redirect('billing');
    }

    return $next($request);
}</code></pre>
<p>如果您想要确定用户是否仍然处于测试阶段，您可以使用 <code>onTrial</code> 方法。这个方法对于向用户显示他们仍然处于试用期的警告是很有用的。</p>
<pre><code>if ($user-&gt;subscription('main')-&gt;onTrial()) {
    //
}</code></pre>
<p>可以使用 <code>subscribedToPlan</code> 方法可以基于给定的 Stripe / Braintree 计划 ID 来确定用户是否订阅了的该计划，在本例中，我们将确定用户的 <code>main</code> 订阅是否激活了 <code>monthly</code> 计划：</p>
<pre><code>if ($user-&gt;subscribedToPlan('monthly', 'main')) {
    //
}</code></pre>
<h4>取消订阅状态</h4>
<p>为了确定用户是否曾经订阅，但是已经取消了他们的订阅，您可以使用 <code>cancelled</code> 方法:</p>
<pre><code>if ($user-&gt;subscription('main')-&gt;cancelled()) {
    //
}</code></pre>
<p>您还可以确定用户是否已经取消了订阅，但是仍然处于订阅的「宽限期」，直到订阅完全过期为止。例如，如果用户在3月5日取消了原定于3月10日到期的订阅，那么用户将在3月10日之前进行「宽限期」。请注意，在此期间，<code>subscribed</code> 方法仍然返回 <code>true</code> ：</p>
<pre><code>if ($user-&gt;subscription('main')-&gt;onGracePeriod()) {
    //
}</code></pre>
<p><a name="changing-plans"></a></p>
<h3>修改订阅计划</h3>
<p>用户在您的应用程序中订阅了之后，他们可能会偶尔想要更改一个新的订阅计划。要将一个用户切换到一个新的订阅，需将订阅计划的标识符传递给 <code>swap</code> 方法：
$user = App\User::find(1);</p>
<pre><code>$user-&gt;subscription('main')-&gt;swap('provider-plan-id');</code></pre>
<p>如果用户在试用期，试用期的期限会被保留。另外，如果订阅的数量存在「份额」，那么该份额也将保持。
如果你想在更改用户订阅计划的时候取消用户当前订阅的试用期，可以使用 <code>skipTrial</code> 方法：</p>
<pre><code>$user-&gt;subscription('main')
        -&gt;skipTrial()
        -&gt;swap('provider-plan-id');</code></pre>
<p><a name="subscription-quantity"></a></p>
<h3>订阅量</h3>
<blockquote>
<p>{note}
订阅数量仅由 Cashier 的 Stripe 支持。Braintree 没有一个对应于 Stripe 的「数量」的特性。</p>
</blockquote>
<p>有些时候订阅是会受「数量」影响的。举个例子，你的应用程序的付费方式可能是每个账户 $10 /人/月。你可以使用 <code>incrementQuantity</code> 和 <code>decrementQuantity</code> 方法轻松的增加或者减少你的订阅数量：</p>
<pre><code>$user = User::find(1);

$user-&gt;subscription('main')-&gt;incrementQuantity();

// 对当前的订阅数量加 5 ...
$user-&gt;subscription('main')-&gt;incrementQuantity(5);

$user-&gt;subscription('main')-&gt;decrementQuantity();

// 对订阅的当前数量减去 5 ...
$user-&gt;subscription('main')-&gt;decrementQuantity(5);</code></pre>
<p>或者，您可以使用 <code>updateQuantity</code> 方法设置一个特定的数量：</p>
<pre><code>$user-&gt;subscription('main')-&gt;updateQuantity(10);</code></pre>
<p>要获得更多关于订阅量的信息，请参考 <a href="https://stripe.com/docs/subscriptions/quantities">Stripe 文档</a>.</p>
<p><a name="subscription-taxes"></a></p>
<h3>订阅税额</h3>
<p>要指定用户在订阅中支付的税率百分比，在计费模式上实现 <code>taxPercentage</code> 方法，并在0到100之间返回一个数值，不超过2个小数点。</p>
<pre><code>public function taxPercentage() {
    return 20;
}</code></pre>
<p><code>taxPercentage</code> 方法使你能够在模型的基础上应用税率，这对于一个跨越多个国家和税率的用户群来说可能是有帮助的。</p>
<blockquote>
<p>{note} <code>taxPercentage</code> 方法只适用于订阅付费模式。如果你用 charges 来做 完成一次性收费的，你需要手工指定税率。</p>
</blockquote>
<p><a name="cancelling-subscriptions"></a></p>
<h3>取消订阅</h3>
<p>要取消订阅，只需在用户的订阅上调用 <code>cancel</code> 方法：</p>
<pre><code>$user-&gt;subscription('main')-&gt;cancel();</code></pre>
<p>当一个订阅被取消时，Cashier 会自动在你的数据库中设置 <code>ends_at</code> 列。这个列用于知道 <code>subscribed</code> 的方法何时应该开始返回 <code>false</code> 。例如，如果客户在3月1日取消订阅，但是订阅计划直到3月5日才会结束，<code>subscribed</code> 方法将会返回 <code>true</code> 一直到3月5日。</p>
<p>您可以使用 <code>onGracePeriod</code> 方法确定用户是否已经取消了订阅，但是仍然在一个「宽限期」：</p>
<pre><code>if ($user-&gt;subscription('main')-&gt;onGracePeriod()) {
    //
}</code></pre>
<p>如果你想马上取消订阅，请在用户的订阅中调用 <code>cancelNow</code> 方法：</p>
<pre><code>$user-&gt;subscription('main')-&gt;cancelNow();</code></pre>
<p><a name="resuming-subscriptions"></a></p>
<h3>恢复订阅</h3>
<p>如果用户取消了他们的订阅，可以使用 <code>resume</code> 的方法来恢复他们的订阅。用户还 <strong>必须</strong> 在他们的宽限期内才能恢复订阅：</p>
<pre><code>$user-&gt;subscription('main')-&gt;resume();</code></pre>
<p>如果用户取消订阅，然后在订阅完全过期之前恢复订阅，他们将不会立即被计费。相反，他们的订阅将会被重新激活，需要按照原本的支付流程再次进行支付。</p>
<p><a name="updating-credit-cards"></a></p>
<h3>更新信用卡信息</h3>
<p><code>updateCard</code> 方法可以用来更新客户的信用卡信息。该方法接受一个 Stripe 的 token ，并将新信用卡分配为默认的支付源：</p>
<pre><code>$user-&gt;updateCard($stripeToken);</code></pre>
<p><a name="subscription-trials"></a></p>
<h2>试用订阅</h2>
<p><a name="with-credit-card-up-front"></a></p>
<h3>有信用卡的情况下</h3>
<p>如果你想要给你的客户提供试用期，同时还要收集支付方法信息，那么你应该在创建订阅时使用 <code>trialDays</code> 方法：</p>
<pre><code>$user = User::find(1);

$user-&gt;newSubscription('main', 'monthly')
            -&gt;trialDays(10)
            -&gt;create($stripeToken);</code></pre>
<p>此方法将在数据库内的订阅记录中设置试用期结束日期，并指示 Stripe / Braintree 在此日期之前不开始向客户收费。</p>
<blockquote>
<p>{note} 如果客户没有在试用期结束之前取消订阅，订阅会被自动结算，所以需要在试用期结束之前通知你的客户。</p>
</blockquote>
<p>您可以使用用户实例的 <code>onTrial</code> 方法或订阅实例的 <code>onTrial</code> 方法来确定用户是否处于试用期。下面两个例子是相同的：
if ($user-&gt;onTrial('main')) {
//
}</p>
<pre><code>if ($user-&gt;subscription('main')-&gt;onTrial()) {
    //
}</code></pre>
<p><a name="without-credit-card-up-front"></a></p>
<h3>没有信用卡的情况下</h3>
<p>如果您希望在不收集用户的支付方法信息的情况下提供试用期，您可以简单地将用户记录的 <code>trial_ends_at</code> 列设置为您想要的试用结束日期。这通常是在用户注册过程中完成的：</p>
<pre><code>$user = User::create([
    // 填充其他用户属性...
    'trial_ends_at' =&gt; Carbon::now()-&gt;addDays(10),
]);</code></pre>
<blockquote>
<p>{note}请确保在你的模型中已经为 <code>trial_ends_at</code> <a href="/docs/laravel_5.8_zh/eloquent-mutators.html#date-mutators">日期转换器</a>。</p>
</blockquote>
<p>Cashier 把这种类型的试用引用为「generic trial」, 因为它并没有关联任何已存在的订阅。如果当前的日期没有超过 <code>trial_ends_at</code> 的值，那么 <code>User</code> 实例上的  <code>onTrial</code> 方法将返回 <code>true</code> ：</p>
<pre><code>if ($user-&gt;onTrial()) {
    // 用户在试用期内...
}</code></pre>
<p>如果您希望明确地知道用户处于「generic」的试用期，并且还没有创建实际的订阅，那么您可以使用 <code>onGenericTrial</code> 方法：</p>
<pre><code>if ($user-&gt;onGenericTrial()) {
    // 用户在 「generic」 试用期内...
}</code></pre>
<p>一旦您准备好为用户创建实际的订阅，您可以像往常一样使用 <code>newSubscription</code> 方法：</p>
<pre><code>$user = User::find(1);

$user-&gt;newSubscription('main', 'monthly')-&gt;create($stripeToken);</code></pre>
<p><a name="handling-stripe-webhooks"></a></p>
<h2>处理 Stripe Webhooks</h2>
<p>Stripe 和 Braintree 都可以通过 webhooks 通知你的应用程序。要处理 Stripe Webhooks ，定义一个路由指向 Cashier 的 webhook 控制器的。该控制器将处理所有传入的 webhook 请求，并将它们发送到适当的控制器方法：</p>
<pre><code>Route::post(
    'stripe/webhook',
    '\Laravel\Cashier\Http\Controllers\WebhookController@handleWebhook'
);</code></pre>
<blockquote>
<p>{note} 一旦你注册了你的路由之后，一定要在你的 Stripe 控制面板设置中配置webhook URL。</p>
</blockquote>
<p>默认情况下，该控制器将自动处理在多次失败的支付尝试后自动取消该订阅(根据您的 Stripe 设置所定义);但是，我们很快就会发现，您可以扩展这个控制器来处理任何您喜欢的 webhook 事件。</p>
<h4>Webhooks &amp; CSRF 保护</h4>
<p>因为 Stripe webhooks 需要绕过 Laravel 的 <a href="/docs/laravel_5.8_zh/csrf.html">CSRF 保护</a>，一定要在 <code>VerifyCsrfToken</code> 中间件中列出 URI ，或者列出 <code>web</code> 中间件组之外的路由：</p>
<pre><code>protected $except = [
    'stripe/*',
];</code></pre>
<p><a name="defining-webhook-event-handlers"></a></p>
<h3>定义 Webhook 事件处理程序</h3>
<p>Cashier 对于失败的支付自动进行取消订阅的处理，但是如果你有其他的 Stripe webhook 事件，你想要处理，可以简单地扩展 Webhook 控制器。您的方法名应该与 Cashier 期望的约定相符，具体来说，方法应该是用 <code>handle</code> 前缀，和您希望处理的 Stripe webhook 的「驼峰」名称。例如，如果您希望处理 <code>invoice.payment_succeeded</code> webhook ，你应该添加一个 <code>handleInvoicePaymentSucceeded</code> 方法到控制器：</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Laravel\Cashier\Http\Controllers\WebhookController as CashierController;

class WebhookController extends CashierController
{
    /**
     * Handle a Stripe webhook.
     *
     * @param  array  $payload
     * @return Response
     */
    public function handleInvoicePaymentSucceeded($payload)
    {
        // 处理事件
    }
}</code></pre>
<p><a name="handling-failed-subscriptions"></a></p>
<h3>订阅失败</h3>
<p>如果客户的信用卡过期了怎么办?不用担心，Cashier 会有一个 Webhook 控制器，它可以很容易地取消客户的订阅。如上所述，您所需要做的就是指定一个路由到该控制器：</p>
<pre><code>Route::post(
    'stripe/webhook',
    '\Laravel\Cashier\Http\Controllers\WebhookController@handleWebhook'
);</code></pre>
<p>就是这样！失败的支付将被控制器捕获和处理。当 Stripe 判断订阅失败时，控制器将取消客户的订阅(通常是在三次失败的付款尝试之后)。</p>
<p><a name="handling-braintree-webhooks"></a></p>
<h2>处理 Braintree Webhooks</h2>
<p>Stripe 和 Braintree 都可以通过 webhooks 通知你的应用程序。要处理 Braintree webhook ，可以定义一个路由指向 Cashier 的 webhook 控制器。该控制器将处理所有传入的 webhook 请求，并将它们发送到适当的控制器方法：</p>
<pre><code>Route::post(
    'braintree/webhook',
    '\Laravel\Cashier\Http\Controllers\WebhookController@handleWebhook'
);</code></pre>
<blockquote>
<p>{note} 一旦你注册了你的路由之后，一定要在你的 Braintree 控制面板设置中配置webhook URL。</p>
</blockquote>
<p>默认情况下，该控制器将自动处理在多次失败的支付尝试后自动取消该订阅(根据您的 Braintree 设置所定义);但是，我们很快就会发现，您可以扩展这个控制器来处理任何您喜欢的 webhook 事件。</p>
<h4>Webhooks &amp; CSRF 保护</h4>
<p>因为 Braintree webhooks 需要绕过 Laravel 的 <a href="/docs/laravel_5.8_zh/csrf.html">CSRF 保护</a>，所以一定要在 <code>VerifyCsrfToken</code> 中间件中列出这个 URI ，或者列出 <code>web</code> 中间件组之外的路由:</p>
<pre><code>protected $except = [
    'braintree/*',
];</code></pre>
<p><a name="defining-braintree-webhook-event-handlers"></a></p>
<h3>定义 Webhook 事件处理程序</h3>
<p>Cashier 对于失败的支付自动进行取消订阅的处理，但是如果你想对 Braintree webhook 事件进行额外的处理，可以简单的扩展一下 Webhook 控制器。你的方法名称应该与 Cashier 的预设惯例一直，特别的是，方法名应该以 <code>handle</code> 为前缀，然后以 「驼峰」命名的方式加上你要处理的 Braintree webhook 的名称。比如，如果你希望去处理 <code>dispute_opened</code> webhook, 你应该添加一个 <code>handleDisputeOpened</code> 方法到控制器：</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Braintree\WebhookNotification;
use Laravel\Cashier\Http\Controllers\WebhookController as CashierController;

class WebhookController extends CashierController
{
    /**
     * Handle a Braintree webhook.
     *
     * @param  WebhookNotification  $webhook
     * @return Response
     */
    public function handleDisputeOpened(WebhookNotification $notification)
    {
        // Handle The Event
    }
}</code></pre>
<p><a name="handling-braintree-failed-subscriptions"></a></p>
<h3>订阅失败</h3>
<p>如果客户的信用卡过期了怎么办?不用担心，Cashier 会有一个 Webhook 控制器，它可以很容易地取消客户的订阅。如上所述，您所需要做的就是指定一个路由到该控制器：</p>
<pre><code>Route::post(
    'braintree/webhook',
    '\Laravel\Cashier\Http\Controllers\WebhookController@handleWebhook'
);</code></pre>
<p>就是这样！失败的支付将被控制器捕获和处理。当 Braintree 判断订阅失败时，控制器将取消客户的订阅(通常是在三次失败的付款尝试之后)。</p>
<p><a name="single-charges"></a></p>
<h2>一次性收费</h2>
<h3>单次付费</h3>
<blockquote>
<p>{note} 当使用 Stripe 时，<code>charge</code> 方法会接受你想要在 <strong>应用程序使用的货币的最小面值</strong> 中收取的金额。然而，当使用 Braintree 时，您应该将全部的美元金额传递给 <code>charge</code> 方法：</p>
</blockquote>
<p>如果您想要对订阅的客户的信用卡进行「一次」的收费，那么您可以在一个 billable 模型实例上使用 <code>charge</code> 方法。</p>
<pre><code>// Stripe Accepts Charges In Cents...
$user-&gt;charge(100);

// Braintree Accepts Charges In Dollars...
$user-&gt;charge(1);</code></pre>
<p><code>charge</code> 方法接受一个数组作为它的第二个参数，允许您将任何您希望的选项传递给底层的 Stripe / Braintree 费用创建。在创建收费时，请参考 Stripe 或 Braintree 文档，了解您可以选择的选项：</p>
<pre><code>$user-&gt;charge(100, [
    'custom_option' =&gt; $value,
]);</code></pre>
<p>当支付结算失败是 <code>charge</code> 方法会抛出一个异常。如果结算成功，会返回完成的 Stripe / Braintree 响应：</p>
<pre><code>try {
    $response = $user-&gt;charge(100);
} catch (Exception $e) {
    //
}</code></pre>
<h3>费用与发票</h3>
<p>有时候你只是需要完成一个一次性的支付，但也要为收费生成一张发票信息，这样你可以提供 PDF 的票据给你的客户。<code>invoiceFor</code> 方法就是做这个的。例如，让我们给客户开具一个 $5.00 的「一次性费用」发票：</p>
<pre><code>// Stripe 以美分结算...
$user-&gt;invoiceFor('One Time Fee', 500);

// Braintree 以美元结算...
$user-&gt;invoiceFor('One Time Fee', 5);</code></pre>
<p>生成发票将立即对用户的信用卡收取费用。invoiceFor 方法可以接受一个数据作为第三个参数，允许你在 Stripe / Braintree 结算时传递任何可用的参数：</p>
<pre><code>$user-&gt;invoiceFor('One Time Fee', 500, [
    'custom-option' =&gt; $value,
]);</code></pre>
<blockquote>
<p>{note} <code>invoiceFor</code>  方法在当多次尝试失败支付后也会产生一个 Stripe 发票。如果你不需要为失败重试的支付生成发票，你需要在第一次失败结算是就调用 Stripe 的 API 关闭它们。</p>
</blockquote>
<p><a name="invoices"></a></p>
<h2>发票</h2>
<p>你可以使用 <code>invoices</code> 方法轻松获取 billable 模型的所有发票信息：</p>
<pre><code>$invoices = $user-&gt;invoices();

// Include pending invoices in the results...
$invoices = $user-&gt;invoicesIncludingPending();</code></pre>
<p>当将发票信息列出来给用户时，你可能需要使用发票的辅助函数来显示相关的发票信息。例如，你可能希望将发票列表以表格的形式显示，允许用户轻松的下载它们：</p>
<pre><code>&lt;table&gt;
    @foreach ($invoices as $invoice)
        &lt;tr&gt;
            &lt;td&gt;{{ $invoice-&gt;date()-&gt;toFormattedDateString() }}&lt;/td&gt;
            &lt;td&gt;{{ $invoice-&gt;total() }}&lt;/td&gt;
            &lt;td&gt;&lt;a href="/user/invoice/{{ $invoice-&gt;id }}"&gt;Download&lt;/a&gt;&lt;/td&gt;
        &lt;/tr&gt;
    @endforeach
&lt;/table&gt;</code></pre>
<p><a name="generating-invoice-pdfs"></a></p>
<h3>生成发票的 PDFs</h3>
<p>从路由或控制器中，使用 <code>downloadInvoice</code> 方法生成发票的 PDF 下载。该方法将自动生成适当的 HTTP 响应，将下载发送到浏览器:</p>
<pre><code>use Illuminate\Http\Request;

Route::get('user/invoice/{invoice}', function (Request $request, $invoiceId) {
    return $request-&gt;user()-&gt;downloadInvoice($invoiceId, [
        'vendor'  =&gt; 'Your Company',
        'product' =&gt; 'Your Product',
    ]);
});</code></pre>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-xl-2" id="toc-list">
        <ul></ul>
    </div>
</div>    </div>
</div>
<span id="back-top">
<svg width="20" height="20" fill="currentColor">
    <use xlink:href="/css/bootstrap-icons.svg#chevron-up"/>
</svg>
</span>
 
<script>
    // 浏览量统计
    $(function () {
        let formdata = new FormData();
        formdata.append('_token', '');
        formdata.append('id', 148);
        $.ajax({
            url: $(".sticky-top .navbar-brand").attr('href') + "/api/doc/clicks",
            type: 'POST',
            data: formdata,
            processData: false,
            contentType: false
        });
    });
    // aside-hidden
    $(function () {
        $('#aside-hidden').on('click', function () {
            $('.aside').toggle(0, function () {
                if ($(this).is(':visible')) {
                    $('.aside-middle').removeClass('col-md-12 col-lg-12').addClass('col-md-9 col-lg-10');
                } else {
                    $('.aside-middle').removeClass('col-md-9 col-lg-10').addClass('col-md-12 col-lg-12');
                }
            });
        });
    });
</script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?1522d01c436f59ddc8389f25bfa9d53e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
</body>
</html>