<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"> 
    <meta name="csrf-token" content=""> 
    <title>Laravel Passport - 开发帮助文档</title> 
    <meta name="keyword" content="passport"> 
    <meta name="description" content="passport"> 
    <meta name="author" content="Moments"> 
    <link href="/favicon.ico" rel="shortcut icon"> 
    <link href="/css/blog.css" rel="stylesheet"> 
    <script src="/js/blog.js"></script> 
</head>
<body>
<header class="sticky-top">
    <nav class="navbar navbar-expand navbar-dark bg-secondary justify-content-between text-uppercase">
        <div class="navbar-nav" style="overflow:hidden;">
            <a class="navbar-brand" href="https://help.pythonschool.com">
                <span class="d-md-none">
                    <svg class="text-warning" width="24" height="24" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#emoji-sunglasses"/>
                    </svg>
                </span>
                <span class="d-none d-md-flex">开发帮助文档</span>
            </a>
            <div class="navbar-nav-scroll" style="overflow: hidden;">
                <ul class="navbar-nav text-nowrap pb-4" style="overflow:auto;">
                                            <li class="nav-item">
                            <a class="nav-link active" href="/docs/laravel/index.html">laravel</a>
                        </li>
                                            <li class="nav-item">
                            <a class="nav-link" href="/docs/php/index.html">php</a>
                        </li>
                                    </ul>
            </div>
        </div>
        <div class="d-inline-flex">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/liuhuashi">
                        <svg class="text-light" width="24" height="24" fill="currentColor">
                            <use xlink:href="/css/bootstrap-icons.svg#github"/>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<div class="container-fluid">
    <div id="aside-hidden" class="position-fixed" style="left:0;top: 58px;cursor:pointer;z-index: 10000;">
        <svg class="align-text-bottom text-warning" width="16" height="16" fill="currentColor" stroke="currentColor" stroke-width="1">
            <use xlink:href="/css/bootstrap-icons.svg#arrow-left-square"/>
        </svg>
    </div>
    <div class="row">
        <div class="aside col-md-3 col-lg-2 border-right shadow position-sticky" style="overflow:auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
    <form class="row border-bottom p-3 bg-white sticky-top">
        <input id="search-version" class="form-control" data-version="7" type="search" placeholder="英文逗号分隔,分词搜索">
    </form>
    <ul class="nav navbar-nav nav-pills flex-column pt-2 figure-caption">
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/artisan.html" title="Artisan 命令行">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Artisan 命令行
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/authentication.html" title="用户认证">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    用户认证
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/authorization.html" title="用户授权">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    用户授权
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/blade.html" title="Blade 模板">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Blade 模板
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/broadcasting.html" title="广播系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    广播系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/cache.html" title="缓存系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    缓存系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/collections.html" title="集合">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    集合
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/configuration.html" title="Configuration">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Configuration
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/console-tests.html" title="控制台测试">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    控制台测试
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/container.html" title="服务容器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    服务容器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/contracts.html" title="契约">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    契约
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/contributions.html" title="贡献导引">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    贡献导引
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/controllers.html" title="Controllers">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Controllers
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/csrf.html" title="CSRF 保护">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    CSRF 保护
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/database-testing.html" title="数据库测试">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库测试
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/database.html" title="数据库: 入门">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库: 入门
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/deployment.html" title="部署">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    部署
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/documentation.html" title="前言">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    前言
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/dusk.html" title="Laravel Dusk">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Dusk
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-collections.html" title="Eloquent: 集合">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 集合
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-mutators.html" title="Eloquent: 修改器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 修改器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-relationships.html" title="Eloquent: 关联">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 关联
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-resources.html" title="Eloquent: API 资源">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: API 资源
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent-serialization.html" title="Eloquent: 序列化">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 序列化
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/eloquent.html" title="Eloquent: 入门">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 入门
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/encryption.html" title="加密解密">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    加密解密
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/envoy.html" title="Laravel Envoy">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Envoy
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/errors.html" title="错误处理">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    错误处理
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/events.html" title="事件系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    事件系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/facades.html" title="Facades">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Facades
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/filesystem.html" title="File Storage">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    File Storage
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/frontend.html" title="JavaScript &amp; CSS 脚手架">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    JavaScript &amp; CSS 脚手架
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/hashing.html" title="哈希加密">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    哈希加密
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/helpers.html" title="辅助函数">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    辅助函数
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/homestead.html" title="Laravel Homestead">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Homestead
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/horizon.html" title="Laravel Horizon">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Horizon
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/http-client.html" title="HTTP 客户端">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP 客户端
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/http-tests.html" title="HTTP Tests">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP Tests
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/installation.html" title="安装">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    安装
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/lifecycle.html" title="请求生命周期">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    请求生命周期
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/localization.html" title="本地化">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    本地化
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/logging.html" title="日志">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    日志
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/mail.html" title="邮件发送">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    邮件发送
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/middleware.html" title="中间件">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    中间件
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/migrations.html" title="数据库：迁移">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库：迁移
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/mix.html" title="编辑资源 (Mix)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    编辑资源 (Mix)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/mocking.html" title="Mocking">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Mocking
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/notifications.html" title="消息通知">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    消息通知
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/packages.html" title="Package Development">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Package Development
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/pagination.html" title="数据库: 分页">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库: 分页
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/passport.html" title="Laravel Passport">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Passport
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/passwords.html" title="重置密码">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    重置密码
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/providers.html" title="服务提供者">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    服务提供者
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/queries.html" title="数据库：查询构造器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库：查询构造器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/queues.html" title="队列">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    队列
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/redis.html" title="Redis">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Redis
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/releases.html" title="发行说明">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    发行说明
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/requests.html" title="HTTP 请求">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP 请求
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/responses.html" title="HTTP Responses">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP Responses
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/routing.html" title="路由">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    路由
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/sail.html" title="Laravel Sail">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Sail
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/sanctum.html" title="Laravel Sanctum">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Sanctum
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/scheduling.html" title="任务调度">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    任务调度
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/scout.html" title="Laravel Scout">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Scout
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/seeding.html" title="数据库：填充">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库：填充
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/session.html" title="HTTP 会话机制">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    HTTP 会话机制
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/socialite.html" title="Laravel 社会化登录">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 社会化登录
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/structure.html" title="目录结构">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    目录结构
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/telescope.html" title="Laravel Telescope">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Telescope
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/testing.html" title="测试：入门指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    测试：入门指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/upgrade.html" title="升级指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    升级指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/urls.html" title="生成 URL">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    生成 URL
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/valet.html" title="Laravel Valet">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Valet
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/validation.html" title="表单验证">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    表单验证
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/verification.html" title="Email 认证">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Email 认证
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_8_zh/views.html" title="视图">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    视图
                </a>
            </li>
            </ul>
</div>        <div class="aside-middle col-md-9 col-lg-10 row">
    <div class="col-md-9 col-xl-10" style="overflow: auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
        <div class="container main-h4-1">
            <div class="page-content">
                <h1>Laravel Passport</h1>
<ul>
<li><a href="#introduction">简介</a></li>
<li><a href="#upgrading">升级Passport</a></li>
<li><a href="#installation">安装</a>
<ul>
<li><a href="#frontend-quickstart">快速上手</a></li>
<li><a href="#deploying-passport">部署 Passport</a></li>
<li><a href="#migration-customization">自定义迁移</a></li>
</ul></li>
<li><a href="#configuration">配置</a>
<ul>
<li><a href="#client-secret-hashing">客户端密钥哈希</a></li>
<li><a href="#token-lifetimes">令牌的使用期限</a></li>
<li><a href="#overriding-default-models">覆盖默认的模型</a></li>
</ul></li>
<li><a href="#issuing-access-tokens">发布访问令牌</a>
<ul>
<li><a href="#managing-clients">管理客户端</a></li>
<li><a href="#requesting-tokens">请求令牌</a></li>
<li><a href="#refreshing-tokens">刷新令牌</a></li>
<li><a href="#revoking-tokens">撤销令牌</a></li>
<li><a href="#purging-tokens">清除令牌</a></li>
</ul></li>
<li><a href="#code-grant-pkce">授权码授予 PKCE</a>
<ul>
<li><a href="#creating-a-auth-pkce-grant-client">创建客户端</a></li>
<li><a href="#requesting-auth-pkce-grant-tokens">请求客户端</a></li>
</ul></li>
<li><a href="#password-grant-tokens">密码授权令牌</a>
<ul>
<li><a href="#creating-a-password-grant-client">创建密码授权客户端</a></li>
<li><a href="#requesting-password-grant-tokens">请求密码授权令牌</a></li>
<li><a href="#requesting-all-scopes">请求所有作用域</a></li>
<li><a href="#customizing-the-user-provider">自定义服务提供者</a></li>
<li><a href="#customizing-the-username-field">自定义用户名字段</a></li>
<li><a href="#customizing-the-password-validation">自定义密码验证</a></li>
</ul></li>
<li><a href="#implicit-grant-tokens">隐式授权令牌</a></li>
<li><a href="#client-credentials-grant-tokens">客户端授权令牌</a></li>
<li><a href="#personal-access-tokens">个人访问令牌</a>
<ul>
<li><a href="#creating-a-personal-access-client">创建个人访问令牌客户端</a></li>
<li><a href="#managing-personal-access-tokens">管理个人访问令牌</a></li>
</ul></li>
<li><a href="#protecting-routes">路由保护</a>
<ul>
<li><a href="#via-middleware">通过中间间</a></li>
<li><a href="#passing-the-access-token">传递访问令牌</a></li>
</ul></li>
<li><a href="#token-scopes">令牌作用域</a>
<ul>
<li><a href="#defining-scopes">定义作用域</a></li>
<li><a href="#default-scope">默认作用域</a></li>
<li><a href="#assigning-scopes-to-tokens">给另配分配作用域</a></li>
<li><a href="#checking-scopes">检查作用域</a></li>
</ul></li>
<li><a href="#consuming-your-api-with-javascript">使用 JavaScript 接入 API </a></li>
<li><a href="#events">事件</a></li>
<li><a href="#testing">测试</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2>简介</h2>
<p>在 Laravel 中，实现基于传统表单的登陆和授权已经非常简单，但是如何满足 API 场景下的授权需求呢？在 API 场景里通常通过令牌来实现用户授权，而非维护请求之间的 Session 状态。在 Laravel 项目中使用 Passport 可以轻而易举地实现 API 授权认证，Passport 可以在几分钟之内为你的应用程序提供完整的 OAuth2 服务端实现。Passport 是基于由 Andy Millington 和 Simon Hamp 维护的 <a href="https://github.com/thephpleague/oauth2-server">League OAuth2 server</a> 建立的。</p>
<blockquote>
<p>注意：本文档假定你已熟悉 OAuth2。如果你并不了解 OAuth2，阅读之前请先熟悉下 OAuth2 的 <a href="https://oauth2.thephpleague.com/terminology/">常用术语</a> 和特性。</p>
</blockquote>
<p><a name="upgrading"></a></p>
<h2>升级 Passport</h2>
<p>当您想升级 Passport 到最新版本, 仔细阅读 <a href="https://github.com/laravel/passport/blob/master/UPGRADE.md">升级指南</a> 将十分重要。</p>
<p><a name="installation"></a></p>
<h2>安装</h2>
<p>在开始之前，请通过 Composer 包管理器安装 Passport：</p>
<pre><code>composer require laravel/passport</code></pre>
<p>Passport 服务提供器使用框架注册自己的数据库迁移目录，因此在注册提供器后，就应该运行 Passport 的迁移命令来自动创建存储客户端和令牌的数据表：</p>
<pre><code>php artisan migrate</code></pre>
<p>接下来，运行 <code>passport:install</code>  命令来创建生成安全访问令牌时所需的加密密钥，同时，这条命令也会创建用于生成访问令牌的「个人访问」客户端和「密码授权」客户端：</p>
<pre><code>php artisan passport:install</code></pre>
<blockquote>
<p>技巧：如果您想使用「uuid」作为 Passport「客户端」模型的主键，而不是自动递增的整数，请使用 <a href="#client-uuids">选项 <code>uuids</code></a> 来安装Passport。</p>
</blockquote>
<p>上面命令执行后，请将 <code>Laravel\Passport\HasApiTokens</code> Trait 添加到 <code>App\Models\User</code> 模型中，这个 Trait 会给你的模型提供一些辅助函数，用于检查已认证用户的令牌和使用范围：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Passport\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable;
}</code></pre>
<p>接下来，在 <code>AuthServiceProvider</code> 的<code>boot</code>  方法中调用 <code>Passport::routes</code> 函数。这个函数会注册发出访问令牌并撤销访问令牌、客户端和个人访问令牌所必需的路由：</p>
<pre><code>&lt;?php

namespace App\Providers;

use Illuminate\Foundation\Support\Providers\AuthServiceProvider as ServiceProvider;
use Illuminate\Support\Facades\Gate;
use Laravel\Passport\Passport;

class AuthServiceProvider extends ServiceProvider
{
    /**
     * The policy mappings for the application.
     *
     * @var array
     */
    protected $policies = [
        'App\Models\Model' =&gt; 'App\Policies\ModelPolicy',
    ];

    /**
     * Register any authentication / authorization services.
     *
     * @return void
     */
    public function boot()
    {
        $this-&gt;registerPolicies();

        Passport::routes();
    }
}</code></pre>
<p>最后，将配置文件 <code>config/auth.php</code> 中授权看守器 <code>guards</code>  的<code>api</code> 的<code>driver</code> 选项改为 <code>passport</code>。此调整会让你的应用程序在在验证传入的 API 的请求时使用 Passport 的 <code>TokenGuard</code> 来处理：</p>
<pre><code>'guards' =&gt; [
    'web' =&gt; [
        'driver' =&gt; 'session',
        'provider' =&gt; 'users',
    ],

    'api' =&gt; [
        'driver' =&gt; 'passport',
        'provider' =&gt; 'users',
    ],
],</code></pre>
<p><a name="client-uuids"></a></p>
<h4>UUID的客户端</h4>
<p>现在，您可以在执行 <code>passport:install</code> 时使用 <code>--uuids</code> 选项，这个选项将引导 Passport 使用 <code>UUID</code> 作为  Passport <code>Client</code>的主键，而不是使用自动递增的整数作为主键。执行 <code>php artisan passport:install --uuids</code> 后，您将得到关于禁用 Passport 默认迁移的相关指令说明：</p>
<pre><code>php artisan passport:install --uuids</code></pre>
<p><a name="frontend-quickstart"></a></p>
<h3>前端快速上手</h3>
<blockquote>
<p>注意：为了使用 Passport 的 Vue 组件，你必须使用 <a href="https://vuejs.org">Vue</a> JavaScript 框架。这些组件也使用了 Bootstrap CSS 框架。然而，如果你不打算使用这些工具，这些组件对于你自己的前端组件编写也十分有价值。</p>
</blockquote>
<p>提供了一系列 JSON API ，你可以用它们来允许你的用户创建客户端和个人访问令牌。然而，编写与这些 API 交互的前端代码可能是很占用时间的。因此，Passport 也包括了预编译的 <a href="https://vuejs.org">Vue</a>  组件，你可以直接使用或将其作为你自己的前端参考。</p>
<p>要使用 Passport 的 Vue 组件，使用 <code>vendor:publish</code> Artisan 命令：</p>
<pre><code>php artisan vendor:publish --tag=passport-components</code></pre>
<p>被发布的组件将会被放到 <code>resources/js/components</code> 目录下。当组件被发布后，你应该在你的 <code>resources/js/app.js</code> 文件中注册它们：</p>
<pre><code>Vue.component(
    'passport-clients',
    require('./components/passport/Clients.vue').default
);

Vue.component(
    'passport-authorized-clients',
    require('./components/passport/AuthorizedClients.vue').default
);

Vue.component(
    'passport-personal-access-tokens',
    require('./components/passport/PersonalAccessTokens.vue').default
);</code></pre>
<blockquote>
<p>注意：在 Laravel v5.7.19 之前，在注册组件时添加 <code>.default</code> 会导致控制台错误。有关此更改的解释，请参阅 <a href="https://github.com/JeffreyWay/laravel-mix/releases/tag/v4.0.0">Laravel Mix v4.0.0 release notes</a> 发布说明。</p>
</blockquote>
<p>注册完组件之后，需要运行<code>npm run dev</code>重新编译代码。编译好之后就可以在项目中使用组件建立客户端和个人访问令牌：</p>
<pre><code>&lt;passport-clients&gt;&lt;/passport-clients&gt;
&lt;passport-authorized-clients&gt;&lt;/passport-authorized-clients&gt;
&lt;passport-personal-access-tokens&gt;&lt;/passport-personal-access-tokens&gt;</code></pre>
<p><a name="deploying-passport"></a></p>
<h3>部署 Passport</h3>
<p>当要首次部署Passport到生产环境中，你需要运行<code>passport:keys</code>命令。
这个命令能生成访问令牌所需的密钥。生成的密钥一般情况下不应放在版本控制中：</p>
<pre><code>php artisan passport:keys</code></pre>
<p>可以使用 <code>Passport::loadKeysFrom</code> 方法来自定义 Passport 密钥的加载路径：</p>
<pre><code>/**
 * Register any authentication / authorization services.
 *
 * @return void
 */
public function boot()
{
    $this-&gt;registerPolicies();

    Passport::routes();

    Passport::loadKeysFrom('/secret-keys/oauth');
}</code></pre>
<p>另外，您也可以使用 <code>php artisan vendor:publish --tag=passport-config</code> 发布 Passport 的配置文件，然后从您的环境变量提供加载加密密钥的选项：</p>
<pre><code>PASSPORT_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----
&lt;private key here&gt;
-----END RSA PRIVATE KEY-----"

PASSPORT_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----
&lt;public key here&gt;
-----END PUBLIC KEY-----"</code></pre>
<p><a name="migration-customization"></a></p>
<h3>自定义迁移</h3>
<p>如果你不想使用Passport默认的迁移，你需要在<code>AppServiceProvider</code>中的<code>register</code> 方法使用<code>Passport::ignoreMigrations</code>。使用<code>php artisan vendor:publish --tag=passport-migrations</code>会在<code>/database/migrations</code>下生成默认的迁移文件，可以再自行进行修改。</p>
<p><a name="configuration"></a></p>
<h2>配置</h2>
<p><a name="client-secret-hashing"></a></p>
<h3>客户端密钥哈希加密（ <code>Secret Hashing</code>）</h3>
<p>如果你希望客户端的密钥哈希加密的形式保存到数据库，你可以在<code>AppServiceProvider</code>的<code>boot</code>方法中添加<code>Passport::hashClientSecrets</code>：</p>
<pre><code>Passport::hashClientSecrets();</code></pre>
<p>一旦被启用，当创建客户端时所有客户端密钥将会同时显示。如果丢失，则不可能恢复的，因为纯文本（<code>plain-text</code>）客户端密钥从不存储在数据库中。
<a name="token-lifetimes"></a></p>
<h3>令牌的有效期</h3>
<p><code>Passport</code> 发放的令牌的有效期默认为一年。如果你希望令牌有效期更长或更短, 你可以用 <code>tokensExpireIn</code>, <code>refreshTokensExpireIn</code>, 或 <code>personalAccessTokensExpireIn</code> 的方法。
这些方法都在 <code>AuthServiceProvider</code> 的 <code>boot</code> 方法调用：</p>
<pre><code> /**
 * Register any authentication / authorization services.
 *
 * @return void
 */
public function boot()
{
    $this-&gt;registerPolicies();

    Passport::routes();

    Passport::tokensExpireIn(now()-&gt;addDays(15));

    Passport::refreshTokensExpireIn(now()-&gt;addDays(30));

    Passport::personalAccessTokensExpireIn(now()-&gt;addMonths(6));
}</code></pre>
<blockquote>
<p>注意：在 <code>Passprot</code> 数据库表中，<code>expires_at</code> 字段是只读（<code>read-only</code>）的，用来展示有效期。<code>Passport</code> 发放令牌时，<code>Passport</code> 有效时间信息存储在签名和加密的令牌中。如果你希望使令牌无效，你可以撤销它。</p>
</blockquote>
<p><a name="overriding-default-models"></a></p>
<h3>覆盖默认模型</h3>
<p>可以自由扩展 Passport 使用的模型:</p>
<pre><code>use Laravel\Passport\Client as PassportClient;

class Client extends PassportClient
{
    // ...
}</code></pre>
<p>然后，你可以通过 Passport 类自定义模型覆盖默认模型：</p>
<pre><code>use App\Models\Passport\AuthCode;
use App\Models\Passport\Client;
use App\Models\Passport\PersonalAccessClient;
use App\Models\Passport\Token;

/**
 * Register any authentication / authorization services.
 *
 * @return void
 */
public function boot()
{
    $this-&gt;registerPolicies();

    Passport::routes();

    Passport::useTokenModel(Token::class);
    Passport::useClientModel(Client::class);
    Passport::useAuthCodeModel(AuthCode::class);
    Passport::usePersonalAccessClientModel(PersonalAccessClient::class);
}</code></pre>
<p><a name="issuing-access-tokens"></a></p>
<h2>发放访问令牌</h2>
<p>将 OAuth2 与授权代码一起使用是大多数开发者熟悉 OAuth2 的方式。当使用授权代码时，客户端应用程序将用户重定向到你的服务器，在那里他们将批准或拒绝向客户端发出访问令牌的请求。</p>
<p><a name="managing-clients"></a></p>
<h3>管理客户端</h3>
<p>首先，构建需要与应用程序 API 交互的应用程序，开发人员将需要通过创建一个「客户端」来注册自己的应用程序。一般来说，这包括在用户批准其授权请求后，提供其应用程序的名称和应用程序可以重定向到的 URL。</p>
<h4><code>passport:client</code> 命令</h4>
<p>创建客户端最简单的方式是使用 <code>passport:client</code> Artisan 命令，你可以使用此命令创建自己的客户端，用于测试 OAuth2 的功能。在你执行 <code>client</code> 命令时，Passport 会提示你输入有关客户端的信息，最终会给你提供客户端的 ID 和密钥：</p>
<pre><code>php artisan passport:client</code></pre>
<p><strong>Redirect URLs</strong></p>
<p>如果你想为你的客户端允许多个重定向 URL，可以在 <code>passport:client</code> 命令提示输入 URL 时，使用逗号分隔来指定一个列表：</p>
<pre><code>http://example.com/callback,http://examplefoo.com/callback</code></pre>
<blockquote>
<p>注意：任何包含逗号的 URL 都必须进行编码。</p>
</blockquote>
<h4>JSON API</h4>
<p>考虑到你的用户无法使用 <code>client</code> 命令，Passport 为此提供了可用于创建「客户端」的 JSON API 。这样你就省去了编写控制器来创建、更新和删除客户端的麻烦。</p>
<p>然而，你仍旧需要基于 Passport 的 JSON API 开发一套前端面板，以便你的用户提供管理客户端。下面我们会列出所有用于管理客户端的 API，为了方便起见，我们使用 <a href="https://github.com/axios/axios">Axios</a> 来演示对端口发出 HTTP 请求。</p>
<p>这个 JSON API 由 <code>web</code> 和 <code>auth</code> 两个中间件保护，所以只能从应用程序中调用，不能从外部调用。</p>
<blockquote>
<p>技巧：如果你不想自己实现整个客户端管理的前端界面，可以使用 <a href="#frontend-quickstart">前端快速上手</a> 在几分钟内组建一套功能齐全的前端界面。</p>
</blockquote>
<h4><code>GET /oauth/clients</code></h4>
<p>此路由会返回认证用户的所有客户端。主要用途是列出所有用户的客户端，以便他们可以编辑或删除它们：</p>
<pre><code>axios.get('/oauth/clients')
    .then(response =&gt; {
        console.log(response.data);
    });</code></pre>
<h4><code>POST /oauth/clients</code></h4>
<p>此路由用于创建新客户端。它需要两个参数：客户端的名称 <code>name</code> 和授权后回调的 URL <code>redirect</code>。在批准或拒绝授权请求后，用户会被重定向到 <code>redirect</code> 参数提供的 URL 。</p>
<p>当客户端创建后，会返回客户端的 ID 和密钥。客户端可以使用这两个值从你的授权服务请求访问令牌。客户端创建的路由会返回新的客户端实例：</p>
<pre><code>const data = {
    name: 'Client Name',
    redirect: 'http://example.com/callback'
};

axios.post('/oauth/clients', data)
    .then(response =&gt; {
        console.log(response.data);
    })
    .catch (response =&gt; {
        // 列出响应的错误...
    });</code></pre>
<h4><code>PUT /oauth/clients/{client-id}</code></h4>
<p>此路由用于更新客户端。 它需要需两个参数： 客户端名称<code>name</code>  和 重定向URL <code>redirect</code> 。 在请求被授权或被拒绝授权后，用户会重定向到<code>redirect</code> 链接 。这个路由将会返回更新后的客户端实例:</p>
<pre><code>const data = {
    name: 'New Client Name',
    redirect: 'http://example.com/callback' 
};

axios.put('/oauth/clients/' + clientId, data)
    .then(response =&gt; {
        console.log(response.data);
    })
    .catch (response =&gt; {
        // List errors on response...
    });</code></pre>
<h4><code>DELETE /oauth/clients/{client-id}</code></h4>
<p>此路由用于删除客户端（根据<code>client-id</code> ）:</p>
<pre><code>axios.delete('/oauth/clients/' + clientId)
    .then(response =&gt; {
        //
    });</code></pre>
<p><a name="requesting-tokens"></a></p>
<h3>请求授权</h3>
<h4>授权时重定向</h4>
<p>当客户端被创建后,开发者们会用它们的客户端ID(<code>client_id</code>) 和密钥（<code>secret</code>） 请求授权码，并从应用程序访问令牌。 首先，接入应用的用户向你应用程序的 <code>/oauth/authorize</code> 路由发出重定向请求，示例如下:</p>
<pre><code>Route::get('/redirect', function (Request $request) {
    $request-&gt;session()-&gt;put('state', $state = Str::random(40));

    $query = http_build_query([
        'client_id' =&gt; 'client-id',
        'redirect_uri' =&gt; 'http://example.com/callback',
        'response_type' =&gt; 'code',
        'scope' =&gt; '',
        'state' =&gt; $state,
    ]);

    return redirect('http://your-app.com/oauth/authorize?'.$query);
});</code></pre>
<blockquote>
<p>技巧：注意，路由 <code>/oauth/authorize</code> 已经在 <code>Passport::routes</code>方法中定义。你不需要手动定义此路由。</p>
</blockquote>
<h4>批准请求</h4>
<p>当接收到授权请求时，<code>Passport</code> 会自动向用户显示一个模版页面，允许用户批准或拒绝授权请求。如果用户批准请求，他们会被重定向回接入的应用程序指定的 <code>redirect_uri</code>。<code>redirect_uri</code> 必须和客户端创建时指定的 <code>redirect</code> 链接完全一致。</p>
<p>如果你想要自定义授权通过界面， 可以使用 Artisan 命令 <code>vendor:publish</code> 发布 Passport 的视图模板。发布的视图位于 <code>resources/views/vendor/passport</code>：</p>
<pre><code>php artisan vendor:publish --tag=passport-views</code></pre>
<p>有时候你可能希望跳过授权提示页面， 例如授权第一方客户端时。你可以通过在 <a href="#overriding-default-models">客户端模型</a> 上定义 <code>skipsAuthorization</code> 方法来实现此目的。 如果 <code>skipsAuthorization</code> 返回 <code>true</code>，客户端将被批准，用户将被立即重定向回 <code>redirect_uri</code> ：</p>
<pre><code>&lt;?php

namespace App\Models\Passport;

use Laravel\Passport\Client as BaseClient;

class Client extends BaseClient
{
    /**
     * 确定客户端是否应跳过授权提示
     *
     * @return bool
     */
    public function skipsAuthorization()
    {
        return $this-&gt;firstParty();
    }
}</code></pre>
<h4>将授权码转化为访问令牌</h4>
<p>如果用户通过了授权请求，会被重定向回客户端应用。客户端应用首先会验证之前传递给授权服务方的 <code>state</code> 参数。 如果该参数与之前传递的参数值匹配，则客户端会发起一个 <code>POST</code> 请求到服务端来请求一个访问令牌。该请求应包含用户通过授权请求时指定的授权码。在下面的例子中， 我们会使用 Guzzle HTTP 库来生成 <code>POST</code> 请求：</p>
<pre><code>Route::get('/callback', function (Request $request) {
    $state = $request-&gt;session()-&gt;pull('state');

    throw_unless(
        strlen($state) &gt; 0 &amp;&amp; $state === $request-&gt;state,
        InvalidArgumentException::class
    );

    $http = new GuzzleHttp\Client;

    $response = $http-&gt;post('http://your-app.com/oauth/token', [
        'form_params' =&gt; [
            'grant_type' =&gt; 'authorization_code',
            'client_id' =&gt; 'client-id',
            'client_secret' =&gt; 'client-secret',
            'redirect_uri' =&gt; 'http://example.com/callback',
            'code' =&gt; $request-&gt;code,
        ],
    ]);

    return json_decode((string) $response-&gt;getBody(), true);
});</code></pre>
<p><code>/oauth/token</code> 路由返回的 JSON 响应中应包含 <code>access_token</code>、 <code>refresh_token</code> 和 <code>expires_in</code> 属性。<code>expires_in</code> 属性包含访问令牌的过期时间（单位：秒）。</p>
<blockquote>
<p>技巧：和 <code>/oauth/authorize</code> 路由一样，<code>/oauth/token</code> 路由在 <code>Passport::routes</code> 方法中定义了，你没必要去手动定义它。默认情况下，该路由使用 <code>ThrottleRequests</code> 中间件设置对访问频率进行限制。</p>
</blockquote>
<h4>JSON API</h4>
<p>Passport 还内置了 JSON API 来管理授权访问令牌，你可以将其与自己的前端代码整合为用户提供访问令牌管理后台。为了方便起见， 我们使用 <a href="https://github.com/mzabriskie/axios">Axios</a> 来演示对 API 发起 HTTP 请求。这个 JSON API 应用了 <code>web</code> 和 <code>auth</code> 中间件； 因此，只能从自己的应用中访问。</p>
<h4><code>GET /oauth/tokens</code></h4>
<p>这个路由会返回认证用户创建的所有授权访问令牌，这在列举该用户的所有令牌以便撤销时很有用：</p>
<pre><code>axios.get('/oauth/tokens')
    .then(response =&gt; {
        console.log(response.data);
    });</code></pre>
<h4><code>DELETE /oauth/tokens/{token-id}</code></h4>
<p>这个路由可用于撤销授权访问令牌及其相关的刷新令牌：</p>
<pre><code>axios.delete('/oauth/tokens/' + tokenId);</code></pre>
<p><a name="refreshing-tokens"></a></p>
<h3>刷新令牌</h3>
<p>如果你的应用程序发放了短期的访问令牌，那么用户需要通过访问令牌颁发时提供的刷新令牌来刷新访问令牌。在下面的例子中，我们使用 Guzzle HTTP 库来刷新令牌：</p>
<pre><code>$http = new GuzzleHttp\Client;

$response = $http-&gt;post('http://your-app.com/oauth/token', [
    'form_params' =&gt; [
        'grant_type' =&gt; 'refresh_token',
        'refresh_token' =&gt; 'the-refresh-token',
        'client_id' =&gt; 'client-id',
        'client_secret' =&gt; 'client-secret',
        'scope' =&gt; '',
    ],
]);

return json_decode((string) $response-&gt;getBody(), true);</code></pre>
<p><code>/oauth/token</code> 路由会返回一个 JSON 响应，其中包含 <code>access_token</code> 、 <code>refresh_token</code> 和 <code>expires_in</code> 属性。 <code>expires_in</code> 属性包含访问令牌过期时间（单位：秒）。</p>
<p><a name="revoking-tokens"></a></p>
<h3>撤回令牌</h3>
<p>如果你想撤回令牌，那么你可以在<code>TokenRepository</code>的<code>revokeAccessToken</code>方法撤销它（让<code>token</code>失效）。也可以在 <code>RefreshTokenRepository</code>的<code>revokeRefreshTokensByAccessTokenId</code>中撤销某个<code>token</code>的刷新令牌：</p>
<pre><code>$tokenRepository = app('Laravel\Passport\TokenRepository');
$refreshTokenRepository = app('Laravel\Passport\RefreshTokenRepository');

// Revoke an access token...
$tokenRepository-&gt;revokeAccessToken($tokenId);

// Revoke all of the token's refresh tokens...
$refreshTokenRepository-&gt;revokeRefreshTokensByAccessTokenId($tokenId);</code></pre>
<p><a name="purging-tokens"></a></p>
<h3>清除令牌</h3>
<p>如果你想清除被撤销或过期的令牌，<code>Passport</code> 会提供以下的命令来清除它：</p>
<pre><code class="language-php">   # Purge revoked and expired tokens and auth codes...
    php artisan passport:purge

    # Only purge revoked tokens and auth codes...
    php artisan passport:purge --revoked

    # Only purge expired tokens and auth codes...
    php artisan passport:purge --expired</code></pre>
<p>你可以在控制台的<code>Kernel</code>类中配置任务调度（<code>scheduled_job</code>）(/docs/laravel_8_zh/scheduling)来定时自动清理令牌：</p>
<pre><code>/**
 * Define the application's command schedule.
 *
 * @param  \Illuminate\Console\Scheduling\Schedule  $schedule
 * @return void
 */
protected function schedule(Schedule $schedule)
{
    $schedule-&gt;command('passport:purge')-&gt;hourly();
}</code></pre>
<p><a name="code-grant-pkce"></a></p>
<h2>通过 <code>PKCE</code> 发放授权码</h2>
<p>通过<code>PKCE</code>(Proof Key for Code Exchange,中文译为&quot;代码交换的证明密钥&quot;)发放授权码是对单页面应用或原生应用进行认证以便访问API接口的安全方式。这种发放授权码是用于不能保证客户端密码被安全储存，或为降低攻击者拦截授权码的威胁。在这种模式下，当授权码获取令牌时，用&quot;验证码&quot;(<code>code verifier</code>)和&quot;质疑吗&quot;（<code>code challenge</code>, &quot;challenge&quot;，名词可译为'挑战；异议；质疑'等）的组合来交换客户端密钥。</p>
<p><a name="creating-a-auth-pkce-grant-client"></a></p>
<h3>创建客户端</h3>
<p>在使用 PKCE 的授权码令牌之前，您需要创建一个启用了 PKCE 的客户机。您可以使用 <code>passport:client</code> 命令和 <code>--public</code> 选项来完成此操作:</p>
<pre><code>php artisan passport:client --public</code></pre>
<p><a name="requesting-auth-pkce-grant-tokens"></a></p>
<h3>请求令牌</h3>
<h4>Code Verifier &amp; Code Challenge</h4>
<p>由于这个授权准许不提供客户端密钥，开发者需要生成 Code Verifier 和 Code Challenge 的组合以请求令牌。</p>
<p>Code Verifier 应该是一个随机字符串，长度在43到128个字符之间，包含字母、数字和 <code>-</code>、<code>.</code> 、<code>_</code> 、<code>~</code>，如[RFC 7636 规范]（<a href="https://tools.ietf.org/html/rfc7636">https://tools.ietf.org/html/rfc7636</a>) 中定义的那样。</p>
<p>Code Challenge 应该是一个Base64编码包含URL和文件名安全字符的字符串。应删除结尾的 <code>'='</code> 字符，并且不应出现换行符、空白或其他附加字符。</p>
<pre><code>$encoded = base64_encode(hash('sha256', $code_verifier, true));

$codeChallenge = strtr(rtrim($encoded, '='), '+/', '-_');</code></pre>
<h4>授权时的重定向</h4>
<p>客户端创建之后，可以使用客户端ID和生成的 code verifier 和 code challenge 来从你的应用程序请求授权码和访问令牌。首先，接入的应用程序需要向你应用程序的 <code>/oauth/authorize</code> 路由发出重定向请求：</p>
<pre><code>Route::get('/redirect', function (Request $request) {
    $request-&gt;session()-&gt;put('state', $state = Str::random(40));

    $request-&gt;session()-&gt;put('code_verifier', $code_verifier = Str::random(128));

    $codeChallenge = strtr(rtrim(
        base64_encode(hash('sha256', $code_verifier, true))
    , '='), '+/', '-_');

    $query = http_build_query([
        'client_id' =&gt; 'client-id',
        'redirect_uri' =&gt; 'http://example.com/callback',
        'response_type' =&gt; 'code',
        'scope' =&gt; '',
        'state' =&gt; $state,
        'code_challenge' =&gt; $codeChallenge,
        'code_challenge_method' =&gt; 'S256',
    ]);

    return redirect('http://your-app.com/oauth/authorize?'.$query);
});</code></pre>
<h4>将授权码转换为访问令牌</h4>
<p>如果用户批准授权请求，他们将被重定向回接入的应用程序。就像授权码许可规定的那样，接入方应首先根据重定向之前存储的值验证 <code>state</code> 参数。</p>
<p>如果 state 参数匹配，接入方应该向你的应用程序发出一个 <code>POST</code> 请求来获得访问令牌。该请求应该包含用户批准授权时从你的应用程序颁发的授权码和之前生成的 code verifier：</p>
<pre><code>Route::get('/callback', function (Request $request) {
    $state = $request-&gt;session()-&gt;pull('state');

    $codeVerifier = $request-&gt;session()-&gt;pull('code_verifier');

    throw_unless(
        strlen($state) &gt; 0 &amp;&amp; $state === $request-&gt;state,
        InvalidArgumentException::class
    );

    $response = (new GuzzleHttp\Client)-&gt;post('http://your-app.com/oauth/token', [
        'form_params' =&gt; [
            'grant_type' =&gt; 'authorization_code',
            'client_id' =&gt; 'client-id',
            'redirect_uri' =&gt; 'http://example.com/callback',
            'code_verifier' =&gt; $codeVerifier,
            'code' =&gt; $request-&gt;code,
        ],
    ]);

    return json_decode((string) $response-&gt;getBody(), true);
});</code></pre>
<p><a name="password-grant-tokens"></a></p>
<h2>密码授权令牌</h2>
<p>OAuth2 密码授权机制可以让你自己的客户端（如移动应用程序）使用邮箱地址或者用户名和密码获取访问令牌。如此一来你就可以安全地向自己的客户端发出访问令牌，而不需要遍历整个 OAuth2 授权代码重定向流程。</p>
<p><a name="creating-a-password-grant-client"></a></p>
<h3>创建密码授权客户端</h3>
<p>在应用程序通过密码授权机制来发布令牌之前，在 <code>passport:client</code> 命令后加上 <code>--password</code> 参数来创建密码授权的客户端。如果你已经运行了 <code>passport:install</code> 命令，则不需要再运行此命令：</p>
<pre><code>php artisan passport:client --password</code></pre>
<p><a name="requesting-password-grant-tokens"></a></p>
<h3>请求令牌</h3>
<p>创建密码授权的客户端后，就可以使用用户的电子邮件地址和密码向 <code>/oauth/token</code> 路由发出 <code>POST</code> 请求来获取访问令牌。而该路由已经由 <code>Passport::routes</code> 方法注册，因此不需要手动定义它。如果请求成功，会在服务端返回的 JSON 响应中收到一个 <code>access_token</code> 和 <code>refresh_token</code>：</p>
<pre><code>$http = new GuzzleHttp\Client;

$response = $http-&gt;post('http://your-app.com/oauth/token', [
    'form_params' =&gt; [
        'grant_type' =&gt; 'password',
        'client_id' =&gt; 'client-id',
        'client_secret' =&gt; 'client-secret',
        'username' =&gt; 'taylor@laravel.com',
        'password' =&gt; 'my-password',
        'scope' =&gt; '',
    ],
]);

return json_decode((string) $response-&gt;getBody(), true);</code></pre>
<blockquote>
<p>技巧：默认情况下，访问令牌是长期有效的。你可以根据需要<a href="#configuration">配置访问令牌的有效时间</a> 。</p>
</blockquote>
<p><a name="requesting-all-scopes"></a></p>
<h3>请求所有作用域</h3>
<p>使用密码授权机制时，可以通过请求 scope 参数 <code>*</code> 来授权应用程序支持的所有范围的令牌。如果你的请求中包含 scope 为 <code>*</code> 的参数，令牌实例上的 <code>can</code> 方法会始终返回 <code>true</code>。这种作用域的授权只能分配给使用 <code>password</code> 或者 <code>client_credentials</code> 授权时发出的令牌：</p>
<pre><code>$response = $http-&gt;post('http://your-app.com/oauth/token', [
    'form_params' =&gt; [
        'grant_type' =&gt; 'password',
        'client_id' =&gt; 'client-id',
        'client_secret' =&gt; 'client-secret',
        'username' =&gt; 'taylor@laravel.com',
        'password' =&gt; 'my-password',
        'scope' =&gt; '*',
    ],
]);</code></pre>
<p><a name="customizing-the-user-provider"></a></p>
<h3>自定义用户提供者</h3>
<p>如果您的应用使用多个<a href="/docs/laravel_8_zh/authentication.html#introduction">身份验证用户提供者</a>，则可以在通过 <code>artisan passport:client --password</code> 命令创建客户端授权密码时提供 <code>--provider</code> 选项来指定使用的用户提供者。 指定的服务提供者名称应与 <code>config/auth.php</code> 配置文件中定义的有效提供者匹配。 然后，您可以<a href="#via-middleware">使用中间件保护您的路由</a> 以确保仅授权来自 guard 指定提供者的用户。</p>
<p><a name="customizing-the-username-field"></a></p>
<h3>自定义用户名字段</h3>
<p>当使用密码验证时，Passport会在模型中使用<code>email</code>属性作为「username」。不过，你仍然可以通过在模型中定义<code>findForPassport</code>方法来自定义验证行为：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Passport\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, Notifiable;

    /**
     * 通过给定的username获取用户实例
     *
     * @param  string  $username
     * @return \App\Models\User
     */
    public function findForPassport($username)
    {
        return $this-&gt;where('username', $username)-&gt;first();
    }
}</code></pre>
<p><a name="customizing-the-password-validation"></a></p>
<h3>自定义密码验证</h3>
<p>当使用密码进行验证时，Passport将使用模型中<code>password</code>属性值验证给定的密码。如果你的模型没有<code>password</code>属性或者你希望自定义密码验证的逻辑，你可以在模型中定义一个<code>validateForPassportPasswordGrant</code>方法来实现：</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Illuminate\Support\Facades\Hash;
use Laravel\Passport\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, Notifiable;

    /**
     * 通过Passport的密码授权验证用户使用的密码
     *
     * @param  string  $password
     * @return bool
     */
    public function validateForPassportPasswordGrant($password)
    {
        return Hash::check($password, $this-&gt;password);
    }
}</code></pre>
<p><a name="implicit-grant-tokens"></a></p>
<h2>隐式授权令牌</h2>
<p>隐式授权类似于授权码授权；但是，令牌将在不交换授权码的情况下返回给客户端。这种授权最常用于无法安全存储客户端凭据的 javascript 或移动应用程序。通过调用 <code>AuthServiceProvider</code> 中的 <code>enableImplicitGrant</code> 方法来启用这种授权：</p>
<pre><code>/**
 * 注册任何身份验证/授权服务。
 *
 * @return void
 */
public function boot()
{
    $this-&gt;registerPolicies();

    Passport::routes();

    Passport::enableImplicitGrant();
}</code></pre>
<p>启用上述授权后，开发者们可以使用他们的客户端 ID 从你的应用程序请求访问令牌。接入的应用程序应该向你的应用程序的 <code>/oauth/authorize</code> 路由发出重定向请求，如下所示：</p>
<pre><code>Route::get('/redirect', function (Request $request) {
    $request-&gt;session()-&gt;put('state', $state = Str::random(40));

    $query = http_build_query([
        'client_id' =&gt; 'client-id',
        'redirect_uri' =&gt; 'http://example.com/callback',
        'response_type' =&gt; 'token',
        'scope' =&gt; '',
        'state' =&gt; $state,
    ]);

    return redirect('http://your-app.com/oauth/authorize?'.$query);
});</code></pre>
<blockquote>
<p>技巧： 请记住，<code>/oauth/authorize</code> 路由已经在 <code>Passport::routes</code> 方法中定义好了，所以无需再次手动定义此路由。</p>
</blockquote>
<p><a name="client-credentials-grant-tokens"></a></p>
<h2>客户端凭证授予令牌</h2>
<p>客户端凭证授予令牌适用于计算机到计算机的身份验证。例如，你可以在通过 API 执行维护任务的计划作业中使用此授权。</p>
<p>在应用程序可以通过客户端凭证授予令牌之前，需要先创建一个客户端凭证授权的客户端。你可以通过 <code>passport:client</code> 命令行的 <code>--client</code> 选项来完成此操作：</p>
<pre><code>php artisan passport:client --client</code></pre>
<p>接下来，要使用这种授权，你首先需要在 <code>app/Http/Kernel.php</code> 的<code>$routeMiddleware</code> 属性中添加 <code>CheckClientCredentials</code> 中间件：</p>
<pre><code>use Laravel\Passport\Http\Middleware\CheckClientCredentials;

protected $routeMiddleware = [
    'client' =&gt; CheckClientCredentials::class,
];</code></pre>
<p>之后，在路由上添加中间件：</p>
<pre><code>Route::get('/orders', function (Request $request) {
    ...
})-&gt;middleware('client');</code></pre>
<p>要将对路由的访问限制在特定作用域内，可以在将 <code>client</code> 中间件附加到路由并提供以逗号分隔的所需作用域列表：</p>
<pre><code>Route::get('/orders', function (Request $request) {
    ...
})-&gt;middleware('client:check-status,your-scope');</code></pre>
<h3>获取令牌</h3>
<p>要获取此授权类型的令牌，请向 <code>oauth/token</code> 发出请求：</p>
<pre><code>$guzzle = new GuzzleHttp\Client;

$response = $guzzle-&gt;post('http://your-app.com/oauth/token', [
    'form_params' =&gt; [
        'grant_type' =&gt; 'client_credentials',
        'client_id' =&gt; 'client-id',
        'client_secret' =&gt; 'client-secret',
        'scope' =&gt; 'your-scope',
    ],
]);

return json_decode((string) $response-&gt;getBody(), true)['access_token'];</code></pre>
<p><a name="personal-access-tokens"></a></p>
<h2>个人访问令牌</h2>
<p>有时候，你的用户要在不经过传统的授权码重定向流程的情况下向自己颁发访问令牌。允许用户通过应用程序用户界面对自己发出令牌，有助于用户体验你的 API，或者也可以将其作为一种更简单的发布访问令牌的方式。</p>
<p><a name="creating-a-personal-access-client"></a></p>
<h3>创建个人访问客户端</h3>
<p>在你的应用程序发布个人访问令牌之前，你需要在 <code>passport:client</code> 命令后带上 <code>--personal</code> 参数来创建对应的客户端。如果你已经运行了 <code>passport:install</code> 命令，则无需再运行此命令：</p>
<pre><code>php artisan passport:client --personal</code></pre>
<p>创建个人访问客户端后，将客户端的ID和纯文本密钥放在应用程序的 <code>.env</code> 文件中：</p>
<pre><code>PASSPORT_PERSONAL_ACCESS_CLIENT_ID=client-id-value
PASSPORT_PERSONAL_ACCESS_CLIENT_SECRET=unhashed-client-secret-value</code></pre>
<p><a name="managing-personal-access-tokens"></a></p>
<h3>管理个人访问令牌</h3>
<p>创建个人访问客户端后，你可以使用 <code>User</code> 模型实例上的 <code>createToken</code> 方法来为给定用户发布令牌。 <code>createToken</code> 方法接受令牌的名称作为其第一个参数和可选的 <a href="#token-scopes">作用域</a> 数组作为其第二个参数：</p>
<pre><code>$user = App\Models\User::find(1);

// 创建没有作用域的访问令牌...
$token = $user-&gt;createToken('Token Name')-&gt;accessToken;

// 创建有作用域的访问令牌...
$token = $user-&gt;createToken('My Token', ['place-orders'])-&gt;accessToken;</code></pre>
<h4>JSON API</h4>
<p>Passport 中也有用来管理个人访问令牌的 JSON API，你可以将其与自己的前端配对，为用户提供管理个人访问令牌的仪表板。下面我们会介绍用于管理个人访问令牌的所有 API 接口。方便起见，我们使用 <a href="https://github.com/mzabriskie/axios">Axios</a> 来演示对 API 的接口发出 HTTP 请求。</p>
<p>JSON API 由 <code>web</code> 和 <code>auth</code> 中间件保护；因此，只能从您自己的应用程序中调用它。无法从外部源调用它。</p>
<blockquote>
<p>技巧：如果你不想实现自己的个人访问令牌管理的前端界面，可以根据 <a href="#frontend-quickstart">前端快速上手</a> 在几分钟内组建功能齐全的前端界面。</p>
</blockquote>
<h4><code>GET /oauth/scopes</code></h4>
<p>此路由会返回应用程序中定义的所有 <a href="#token-scopes">作用域</a>。你可以使用此路由列出用户可能分配给个人访问令牌的范围：</p>
<pre><code>axios.get('/oauth/scopes')
    .then(response =&gt; {
        console.log(response.data);
    });</code></pre>
<h4><code>GET /oauth/personal-access-tokens</code></h4>
<p>此路由返回认证用户创建的所有个人访问令牌。这主要用于列出所有用户的令牌，以便他们可以编辑或删除它们：</p>
<pre><code>axios.get('/oauth/personal-access-tokens')
    .then(response =&gt; {
        console.log(response.data);
    });</code></pre>
<h4><code>POST /oauth/personal-access-tokens</code></h4>
<p>此路由用于创建新的个人访问令牌。它需要两个数据：令牌的 <code>name</code> 和 <code>scopes</code> 。</p>
<pre><code>const data = {
    name: 'Token Name',
    scopes: []
};

axios.post('/oauth/personal-access-tokens', data)
    .then(response =&gt; {
        console.log(response.data.accessToken);
    })
    .catch (response =&gt; {
        // List errors on response...
    });</code></pre>
<h4><code>DELETE /oauth/personal-access-tokens/{token-id}</code></h4>
<p>此路由可用于删除个人访问令牌:</p>
<pre><code>axios.delete('/oauth/personal-access-tokens/' + tokenId);</code></pre>
<p><a name="protecting-routes"></a></p>
<h2>路由保护</h2>
<p><a name="via-middleware"></a></p>
<h3>通过中间件</h3>
<p>Passport 包含一个 <a href="/docs/laravel_8_zh/authentication.html#adding-custom-guards">验证保护机制</a> 可以验证请求中传入的访问令牌。配置 <code>api</code> 的看守器使用 <code>passport</code> 驱动程序后，只需要在需要有效访问令牌的任何路由上指定 <code>auth:api</code> 中间件：</p>
<pre><code>Route::get('/user', function () {
    //
})-&gt;middleware('auth:api');</code></pre>
<h4>多个身份验证 guard</h4>
<p>如果您的应用程序可能使用完全不同的 Eloquent 模型、不同类型的用户进行身份验证，则可能需要为应用程序中的每种用户设置 guard。 这使您可以保护特定 guard 的请求。 例如，设置以下 guard <code>config/auth.php</code> 配置文件：</p>
<pre><code>'api' =&gt; [
    'driver' =&gt; 'passport',
    'provider' =&gt; 'users',
],

'api-customers' =&gt; [
    'driver' =&gt; 'passport',
    'provider' =&gt; 'customers',
],</code></pre>
<p>The following route will utilize the <code>api-customers</code> guard, which uses the <code>customers</code> user provider, to authenticate incoming requests:
以下路由将使用 <code>customers</code> 用户提供者的 <code>api-customers</code> guard 来验证传入的请求：</p>
<pre><code>Route::get('/customer', function () {
    //
})-&gt;middleware('auth:api-customers');</code></pre>
<blockquote>
<p>技巧：有关在 Passport 上使用多个用户提供者的更多信息，请查阅<a href="#customizing-the-user-provider">密码授予文档</a>.</p>
</blockquote>
<p><a name="passing-the-access-token"></a></p>
<h3>传递访问令牌</h3>
<p>当调用 Passport 保护下的路由时，接入的 API 应用需要将访问令牌作为 <code>Bearer</code> 令牌放在请求头 <code>Authorization</code> 中。例如，使用 Guzzle HTTP 库时：</p>
<pre><code>$response = $client-&gt;request('GET', '/api/user', [
    'headers' =&gt; [
        'Accept' =&gt; 'application/json',
        'Authorization' =&gt; 'Bearer '.$accessToken,
    ],
]);</code></pre>
<p><a name="token-scopes"></a></p>
<h2>令牌作用域</h2>
<p>作用域可以让 API 客户端在请求账户授权时请求特定的权限。例如，如果你正在构建电子商务应用程序，并不是所有接入的 API 应用都需要下订单的功能。你可以让接入的 API 应用只被允许授权访问订单发货状态。换句话说，作用域允许应用程序的用户限制第三方应用程序执行的操作。</p>
<p><a name="defining-scopes"></a></p>
<h3>定义作用域</h3>
<p>你可以在 <code>AuthServiceProvider</code> 的 <code>boot</code> 方法中使用 <code>Passport::tokensCan</code> 方法来定义 API 的作用域。<code>tokensCan</code> 方法接受一个包含作用域名称和描述的数组作为参数。作用域描述将会在授权确认页中直接展示给用户，你可以将其定义为任何你需要的内容：</p>
<pre><code>use Laravel\Passport\Passport;

Passport::tokensCan([
    'place-orders' =&gt; 'Place orders',
    'check-status' =&gt; 'Check order status',
]);</code></pre>
<p><a name="default-scope"></a></p>
<h3>默认作用域</h3>
<p>如果客户端没有请求任何特定的范围，你可以在 <code>AuthServiceProvider</code> 的 <code>boot</code> 方法中使用 <code>Passport::setDefaultScope</code> 方法来定义默认的作用域。</p>
<pre><code>use Laravel\Passport\Passport;

Passport::setDefaultScope([
    'check-status',
    'place-orders',
]);</code></pre>
<p><a name="assigning-scopes-to-tokens"></a></p>
<h3>给令牌分配作用域</h3>
<h4>请求授权码</h4>
<p>使用授权码请求访问令牌时，接入的应用需为 <code>scope</code> 参数指定所需作用域。 <code>scope</code> 参数包含多个作用域时，名称之间使用空格分割：</p>
<pre><code>Route::get('/redirect', function () {
    $query = http_build_query([
        'client_id' =&gt; 'client-id',
        'redirect_uri' =&gt; 'http://example.com/callback',
        'response_type' =&gt; 'code',
        'scope' =&gt; 'place-orders check-status',
    ]);

    return redirect('http://your-app.com/oauth/authorize?'.$query);
});</code></pre>
<h4>分发个人访问令牌</h4>
<p>使用 <code>User</code> 模型的 <code>createToken</code> 方法发放个人访问令牌时，可以将所需作用域的数组作为第二个参数传给此方法：</p>
<pre><code>$token = $user-&gt;createToken('My Token', ['place-orders'])-&gt;accessToken;</code></pre>
<p><a name="checking-scopes"></a></p>
<h3>检查作用域</h3>
<p>Passport 包含两个中间件，可用于验证传入的请求是否包含访问指定作用域的令牌。 使用之前，需要将下面的中间件添加到 <code>app/Http/Kernel.php</code> 文件的 <code>$routeMiddleware</code> 属性中：</p>
<pre><code>'scopes' =&gt; \Laravel\Passport\Http\Middleware\CheckScopes::class,
'scope' =&gt; \Laravel\Passport\Http\Middleware\CheckForAnyScope::class,</code></pre>
<h4>检查所有作用域</h4>
<p>路由可以使用 <code>scopes</code> 中间件来检查当前请求是否拥有指定的 <em>所有</em> 作用域：</p>
<pre><code>Route::get('/orders', function () {
    // 访问令牌具有 "check-status" 和 "place-orders" 作用域...
})-&gt;middleware(['auth:api', 'scopes:check-status,place-orders']);</code></pre>
<h4>检查任意作用域</h4>
<p>路由可以使用 scope 中间件来检查当前请求是否拥有指定的 任意 作用域：</p>
<pre><code>Route::get('/orders', function () {
    // Access token has either "check-status" or "place-orders" scope...
})-&gt;middleware(['auth:api', 'scope:check-status,place-orders']);</code></pre>
<h4>检查令牌实例上的作用域</h4>
<p>就算含有访问令牌验证的请求已经通过应用程序的验证，你仍然可以使用当前授权 <code>User</code> 实例上的 <code>tokenCan</code> 方法来验证令牌是否拥有指定的作用域：</p>
<pre><code>use Illuminate\Http\Request;

Route::get('/orders', function (Request $request) {
    if ($request-&gt;user()-&gt;tokenCan('place-orders')) {
        //
    }
});</code></pre>
<h4>其他作用域方法</h4>
<p><code>scopeIds</code> 方法将返回所有已定义 ID / 名称的数组：</p>
<pre><code>Laravel\Passport\Passport::scopeIds();</code></pre>
<p><code>scopes</code> 方法将返回一个包含所有已定义作用域数组的 <code>Laravel\Passport\Scope</code> 实例：</p>
<pre><code>Laravel\Passport\Passport::scopes();</code></pre>
<p><code>scopesFor</code> 方法将返回与给定 ID / 名称匹配的 <code>Laravel\Passport\Scope</code> 实例数组：</p>
<pre><code>Laravel\Passport\Passport::scopesFor(['place-orders', 'check-status']);</code></pre>
<p>你可以使用 <code>hasScope</code> 方法确定是否已定义给定作用域：</p>
<pre><code>Laravel\Passport\Passport::hasScope('place-orders');</code></pre>
<p><a name="consuming-your-api-with-javascript"></a></p>
<h2>使用 JavaScript 接入 API</h2>
<p>在构建 API 时， 如果能通过 JavaScript 应用接入自己的 API 将会给开发过程带来极大的便利。这种 API 开发方法允许你使用自己的应用程序的 API 和别人共享的 API 。你的 Web 应用程序、移动应用程序、第三方应用程序以及可能在各种软件包管理器上发布的任何 SDK 都可能会使用相同的 API 。</p>
<p>通常，如果要在 JavaScript 应用程序中使用 API ，需要手动向应用程序发送访问令牌，并将其传递给应用程序。但是， Passport 有一个可以处理这个问题的中间件。将 <code>CreateFreshApiToken</code> 中间件添加到 <code>app/Http/Kernel.php</code> 文件中的 <code>web</code> 中间件组就可以了：</p>
<pre><code>'web' =&gt; [
    // Other middleware...
    \Laravel\Passport\Http\Middleware\CreateFreshApiToken::class,
],</code></pre>
<blockquote>
<p>注意：你需要确保 <code>CreateFreshApiToken</code> 是你的中间件堆栈中的最后一个中间件。</p>
</blockquote>
<p>这个 Passport 中间件将在你所有的对外请求中添加一个 <code>laravel_token</code> cookie 。该 cookie 将包含一个加密后的 JWT ， Passport 将用来验证来自 JavaScript 应用程序的 API 请求。至此，您可以在不明确传递访问令牌的情况下向应用程序的 API 发出请求：</p>
<pre><code>axios.get('/api/user')
    .then(response =&gt; {
        console.log(response.data);
    });</code></pre>
<h4>自定义 Cookie 名称</h4>
<p>如果需要，你可以在 <code>AuthServiceProvider</code> 的 <code>boot</code> 方法中使用 <code>Passport::cookie</code> 方法来自定义 <code>laravel_token</code> cookie 的名称。</p>
<pre><code>/**
 * 注册认证 / 授权服务
 *
 * @return void
 */
public function boot()
{
    $this-&gt;registerPolicies();

    Passport::routes();

    Passport::cookie('custom_name');
}</code></pre>
<h4>CSRF 保护</h4>
<p>当使用这种授权方法时，您需要确认请求中包含有效的 CSRF 令牌。默认的 Laravel JavaScript 脚手架会包含一个 Axios 实例，该实例是自动使用加密的 <code>XSRF-TOKEN</code> cookie 值在同源请求上发送 <code>X-XSRF-TOKEN</code> 请求头。</p>
<blockquote>
<p>技巧：如果您选择发送 <code>X-CSRF-TOKEN</code> 请求头而不是 <code>X-XSRF-TOKEN</code> ，则需要使用 <code>csrf_token()</code> 提供的未加密令牌。</p>
</blockquote>
<p><a name="events"></a></p>
<h2>事件</h2>
<p>Passport 在发出访问令牌和刷新令牌时引发事件。 您可以使用这些事件来修改或撤消数据库中的其他访问令牌。 您可以在应用程序的 <code>EventServiceProvider</code> 中将监听器附加到这些事件：</p>
<pre><code>/**
 * 应用程序事件监听映射
 *
 * @var array
 */
protected $listen = [
    'Laravel\Passport\Events\AccessTokenCreated' =&gt; [
        'App\Listeners\RevokeOldTokens',
    ],

    'Laravel\Passport\Events\RefreshTokenCreated' =&gt; [
        'App\Listeners\PruneOldTokens',
    ],
];</code></pre>
<p><a name="testing"></a></p>
<h2>测试</h2>
<p>Passport 的 <code>actingAs</code> 方法可以指定当前已认证用户及其作用域。 <code>actingAs</code> 方法的第一个参数是用户实例，第二个参数是用户令牌作用域数组：</p>
<pre><code>use App\Models\User;
use Laravel\Passport\Passport;

public function testServerCreation()
{
    Passport::actingAs(
        User::factory()-&gt;create(),
        ['create-servers']
    );

    $response = $this-&gt;post('/api/create-server');

    $response-&gt;assertStatus(201);
}</code></pre>
<p>Passport 的 <code>actingAsClient</code> 方法可以指定当前已认证用户及其作用域。 <code>actingAsClient</code> 方法的第一个参数是用户实例，第二个参数是用户令牌作用域数组：</p>
<pre><code>use Laravel\Passport\Client;
use Laravel\Passport\Passport;

public function testGetOrders()
{
    Passport::actingAsClient(
        Client::factory()-&gt;create(),
        ['check-status']
    );

    $response = $this-&gt;get('/api/orders');

    $response-&gt;assertStatus(200);
}</code></pre>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-xl-2" id="toc-list">
        <ul></ul>
    </div>
</div>    </div>
</div>
<span id="back-top">
<svg width="20" height="20" fill="currentColor">
    <use xlink:href="/css/bootstrap-icons.svg#chevron-up"/>
</svg>
</span>
 
<script>
    // 浏览量统计
    $(function () {
        let formdata = new FormData();
        formdata.append('_token', '');
        formdata.append('id', 355);
        $.ajax({
            url: $(".sticky-top .navbar-brand").attr('href') + "/api/doc/clicks",
            type: 'POST',
            data: formdata,
            processData: false,
            contentType: false
        });
    });
    // aside-hidden
    $(function () {
        $('#aside-hidden').on('click', function () {
            $('.aside').toggle(0, function () {
                if ($(this).is(':visible')) {
                    $('.aside-middle').removeClass('col-md-12 col-lg-12').addClass('col-md-9 col-lg-10');
                } else {
                    $('.aside-middle').removeClass('col-md-9 col-lg-10').addClass('col-md-12 col-lg-12');
                }
            });
        });
    });
</script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?1522d01c436f59ddc8389f25bfa9d53e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
</body>
</html>