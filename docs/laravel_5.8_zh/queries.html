<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"> 
    <meta name="csrf-token" content=""> 
    <title>Laravel 数据库之：数据库请求构建器 - 开发帮助文档</title> 
    <meta name="keyword" content="queries"> 
    <meta name="description" content="queries"> 
    <meta name="author" content="Moments"> 
    <link href="/favicon.ico" rel="shortcut icon"> 
    <link href="/css/blog.css" rel="stylesheet"> 
    <script src="/js/blog.js"></script> 
</head>
<body>
<header class="sticky-top">
    <nav class="navbar navbar-expand navbar-dark bg-secondary justify-content-between text-uppercase">
        <div class="navbar-nav" style="overflow:hidden;">
            <a class="navbar-brand" href="https://help.pythonschool.com">
                <span class="d-md-none">
                    <svg class="text-warning" width="24" height="24" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#emoji-sunglasses"/>
                    </svg>
                </span>
                <span class="d-none d-md-flex">开发帮助文档</span>
            </a>
            <div class="navbar-nav-scroll" style="overflow: hidden;">
                <ul class="navbar-nav text-nowrap pb-4" style="overflow:auto;">
                                            <li class="nav-item">
                            <a class="nav-link active" href="/docs/laravel/index.html">laravel</a>
                        </li>
                                            <li class="nav-item">
                            <a class="nav-link" href="/docs/php/index.html">php</a>
                        </li>
                                    </ul>
            </div>
        </div>
        <div class="d-inline-flex">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/liuhuashi">
                        <svg class="text-light" width="24" height="24" fill="currentColor">
                            <use xlink:href="/css/bootstrap-icons.svg#github"/>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<div class="container-fluid">
    <div id="aside-hidden" class="position-fixed" style="left:0;top: 58px;cursor:pointer;z-index: 10000;">
        <svg class="align-text-bottom text-warning" width="16" height="16" fill="currentColor" stroke="currentColor" stroke-width="1">
            <use xlink:href="/css/bootstrap-icons.svg#arrow-left-square"/>
        </svg>
    </div>
    <div class="row">
        <div class="aside col-md-3 col-lg-2 border-right shadow position-sticky" style="overflow:auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
    <form class="row border-bottom p-3 bg-white sticky-top">
        <input id="search-version" class="form-control" data-version="5" type="search" placeholder="英文逗号分隔,分词搜索">
    </form>
    <ul class="nav navbar-nav nav-pills flex-column pt-2 figure-caption">
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/about.html" title="Laravel 5.8 中文文档">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 5.8 中文文档
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/api-authentication.html" title="API Authentication">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    API Authentication
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/artisan.html" title="Laravel 的 Artisan 命令行工具">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 Artisan 命令行工具
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/authentication.html" title="Laravel 的用户认证系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的用户认证系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/authorization.html" title="Laravel 的用户授权系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的用户授权系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/billing.html" title="Laravel 的收费系统 Cashier">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的收费系统 Cashier
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/blade.html" title="Laravel 的 Blade 模板引擎">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 Blade 模板引擎
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/braintree.html" title="Laravel Cashier (Braintree)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Cashier (Braintree)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/broadcasting.html" title="Laravel 的事件广播系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的事件广播系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/cache.html" title="Laravel 的缓存系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的缓存系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/collections.html" title="Laravel 的集合 Collection">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的集合 Collection
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/configuration.html" title="Laravel 的配置信息">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的配置信息
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/console-tests.html" title="Console Tests">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Console Tests
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/container.html" title="Laravel 服务容器解析">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 服务容器解析
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/contracts.html" title="Laravel 的契约 (Contracts)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的契约 (Contracts)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/contributions.html" title="Laravel 源代码贡献指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 源代码贡献指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/controllers.html" title="Laravel 的 HTTP 控制器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 HTTP 控制器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/csrf.html" title="Laravel 下的伪造跨站请求保护 CSRF">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 下的伪造跨站请求保护 CSRF
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/database-testing.html" title="Laravel 测试之 - 数据库测试">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试之 - 数据库测试
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/database.html" title="数据库：入门">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    数据库：入门
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/deployment.html" title="Laravel 的部署">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的部署
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/documentation.html" title="主页(Index)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    主页(Index)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/dusk.html" title="Laravel 测试之 - 浏览器测试 (Laravel Dusk)">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试之 - 浏览器测试 (Laravel Dusk)
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-collections.html" title="Eloquent：集合">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent：集合
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-mutators.html" title="Eloquent： 修改器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent： 修改器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-relationships.html" title="Eloquent：关联">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent：关联
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-resources.html" title="Eloquent: API 资源">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: API 资源
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent-serialization.html" title="Eloquent: 序列化">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 序列化
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/eloquent.html" title="Eloquent: 入门">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Eloquent: 入门
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/encryption.html" title="Laravel 的加密解密机制">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的加密解密机制
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/envoy.html" title="Laravel 的远程服务器任务处理器 Envoy">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的远程服务器任务处理器 Envoy
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/errors.html" title="Laravel 的错误和日志记录">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的错误和日志记录
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/events.html" title="Laravel 的事件系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的事件系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/facades.html" title="Laravel 的 Facades">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 Facades
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/filesystem.html" title="Laravel 的文件系统和云存储功能集成">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的文件系统和云存储功能集成
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/frontend.html" title="Laravel 的前端资源处理 JavaScript＆CSS 构建">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的前端资源处理 JavaScript＆CSS 构建
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/hashing.html" title="Laravel 的哈希加密">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的哈希加密
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/helpers.html" title="Laravel 的辅助函数列表">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的辅助函数列表
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/homestead.html" title="Laravel 虚拟开发环境 Homestead">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 虚拟开发环境 Homestead
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/horizon.html" title="Laravel 队列监控面板 - Horizon">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 队列监控面板 - Horizon
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/http-tests.html" title="Laravel 测试之：HTTP 测试">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试之：HTTP 测试
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/installation.html" title="Laravel 安装指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 安装指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/license.html" title="license">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    license
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/lifecycle.html" title="Laravel 的请求生命周期">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的请求生命周期
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/localization.html" title="Laravel 的本地化功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的本地化功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/logging.html" title="Logging">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Logging
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/mail.html" title="Laravel 的 邮件发送功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 邮件发送功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/middleware.html" title="Laravel 的路由中间件">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的路由中间件
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/migrations.html" title="Laravel 的数据库迁移 Migrations">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的数据库迁移 Migrations
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/mix.html" title="Laravel 的资源任务编译器 Laravel Mix">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的资源任务编译器 Laravel Mix
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/mocking.html" title="Laravel 测试之：测试模拟器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试之：测试模拟器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/notifications.html" title="Laravel 的消息通知系统">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的消息通知系统
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/packages.html" title="Laravel 的扩展插件开发指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的扩展插件开发指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/pagination.html" title="Laravel 的分页功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的分页功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/passport.html" title="Laravel 的 API 认证系统 Passport">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 API 认证系统 Passport
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/passwords.html" title="Laravel 的密码重置功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的密码重置功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/providers.html" title="Laravel 的服务提供器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的服务提供器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/queries.html" title="Laravel 数据库之：数据库请求构建器">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 数据库之：数据库请求构建器
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/queues.html" title="Laravel 的队列系统介绍">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的队列系统介绍
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/readme.html" title="Laravel Documentation">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Documentation
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/redirects.html" title="Laravel 的 HTTP 重定向 Redirect">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 HTTP 重定向 Redirect
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/redis.html" title="Laravel 的 Redis 使用指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 Redis 使用指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/releases.html" title="发行说明">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    发行说明
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/requests.html" title="Laravel 的 HTTP 请求">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 HTTP 请求
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/responses.html" title="Laravel 的请求响应">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的请求响应
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/routing.html" title="Laravel HTTP 路由功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel HTTP 路由功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/scheduling.html" title="Laravel 的任务调度（计划任务）功能 Task Scheduling">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的任务调度（计划任务）功能 Task Scheduling
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/scout.html" title="Laravel 的搜索系统 Scout">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的搜索系统 Scout
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/seeding.html" title="Laravel 数据库之：数据填充">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 数据库之：数据填充
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/session.html" title="Laravel 的 HTTP 会话机制">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 HTTP 会话机制
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/socialite.html" title="Laravel 的 社会化登录功能">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 社会化登录功能
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/structure.html" title="Laravel 的文件夹结构">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的文件夹结构
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/telescope.html" title="Laravel Telescope">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel Telescope
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/testing.html" title="Laravel 测试: 入门指南">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 测试: 入门指南
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/upgrade.html" title="Laravel 升级索引">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 升级索引
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/urls.html" title="Laravel 的 URL 生成">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的 URL 生成
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/valet.html" title="Laravel 的开发环境 Valet">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的开发环境 Valet
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/validation.html" title="Laravel 的表单验证机制详解">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的表单验证机制详解
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/verification.html" title="Email Verification">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Email Verification
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/laravel_5.8_zh/views.html" title="Laravel 的视图">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    Laravel 的视图
                </a>
            </li>
            </ul>
</div>        <div class="aside-middle col-md-9 col-lg-10 row">
    <div class="col-md-9 col-xl-10" style="overflow: auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
        <div class="container main-h4-1">
            <div class="page-content">
                <h1>Laravel 数据库之：数据库请求构建器</h1>
<ul>
<li><a href="#introduction">简介</a></li>
<li><a href="#retrieving-results">获取结果</a>
<ul>
<li><a href="#chunking-results">分块结果</a></li>
<li><a href="#aggregates">聚合</a></li>
</ul></li>
<li><a href="#selects">Selects</a></li>
<li><a href="#raw-expressions">原生表达式</a></li>
<li><a href="#joins">Joins</a></li>
<li><a href="#unions">Unions</a></li>
<li><a href="#where-clauses">Where 语句</a>
<ul>
<li><a href="#parameter-grouping">参数分组</a></li>
<li><a href="#where-exists-clauses">Where Exists 语法</a></li>
<li><a href="#json-where-clauses">JSON 查询语句</a></li>
</ul></li>
<li><a href="#ordering-grouping-limit-and-offset">Ordering, Grouping, Limit, &amp; Offset</a></li>
<li><a href="#conditional-clauses">条件语句</a></li>
<li><a href="#inserts">Inserts</a></li>
<li><a href="#updates">Updates</a>
<ul>
<li><a href="#updating-json-columns">更新 JSON</a></li>
<li><a href="#increment-and-decrement">自增 &amp; 自减</a></li>
</ul></li>
<li><a href="#deletes">Deletes</a></li>
<li><a href="#pessimistic-locking">悲观锁</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2>简介</h2>
<p>Laravel 的数据库查询构造器提供了一个方便的接口来创建及运行数据库查询语句。它能用来执行应用程序中的大部分数据库操作，且能在所有被支持的数据库系统中使用。</p>
<p>Laravel 的查询构造器使用 PDO 参数绑定来保护你的应用程序免受 SQL 注入的攻击。因此没有必要清理作为绑定传递的字符串。</p>
<p><a name="retrieving-results"></a></p>
<h2>获取结果</h2>
<h4>从数据表中获取所有的数据</h4>
<p>你可以在 <code>DB</code> facade 上使用 <code>table</code> 方法开始查询。这个 <code>table</code> 方法为给定的表返回一个查询构造器实例，允许你在查询上链式调用更多的约束，最后使用 <code>get</code> 方法获取最终结果：</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Illuminate\Support\Facades\DB;
use App\Http\Controllers\Controller;

class UserController extends Controller
{
    /**
     * 显示所有应用程序用户的列表
     *
     * @return Response
     */
    public function index()
    {
        $users = DB::table('users')-&gt;get();

        return view('user.index', ['users' =&gt; $users]);
    }
}</code></pre>
<p><code>get</code> 方法会返回一个包含 <code>Illuminate\Support\Collection</code> 的结果，其中每个结果都是一个 PHP <code>StdClass</code> 对象的一个实例。你可以通过访问字段作为对象的属性来访问每列的值：</p>
<pre><code>foreach ($users as $user) {
    echo $user-&gt;name;
}</code></pre>
<h4>从数据表中获取单个列或行</h4>
<p>如果你只需要从数据库表中获取一行数据，就使用 <code>first</code> 方法。这个方法将返回一个 <code>StdClass</code> 对象：</p>
<pre><code>$user = DB::table('users')-&gt;where('name', 'John')-&gt;first();

echo $user-&gt;name;</code></pre>
<p>如果你甚至不需要整行数据，就使用 <code>value</code> 方法从记录中取出单个值。该方法将直接返回字段的值：</p>
<pre><code>$email = DB::table('users')-&gt;where('name', 'John')-&gt;value('email');</code></pre>
<h4>获取一列的值</h4>
<p>如果你想要获取包含单个字段值的集合，可以使用 <code>pluck</code> 方法。在下面的例子中，我们将取出 roles 表中 title 字段的集合：</p>
<pre><code>$titles = DB::table('roles')-&gt;pluck('title');

foreach ($titles as $title) {
    echo $title;
}</code></pre>
<p>你也可以在返回的集合中指定字段的自定义键值：</p>
<pre><code>$roles = DB::table('roles')-&gt;pluck('title', 'name');

foreach ($roles as $name =&gt; $title) {
    echo $title;
}</code></pre>
<p><a name="chunking-results"></a></p>
<h3>结果分块</h3>
<p>如果你需要操作数千条数据库记录，可以考虑使用 <code>chunk</code> 方法。这个方法每次只取出一小块结果传递给 <code>闭包</code> 处理，这对于编写数千条记录的 <a href="/docs/laravel_5.8_zh/artisan.html">Artisan 命令</a> 而言是非常有用的。例如，一次处理整个 <code>users</code> 表中的 100 个记录：</p>
<pre><code>DB::table('users')-&gt;orderBy('id')-&gt;chunk(100, function ($users) {
    foreach ($users as $user) {
        //
    }
});</code></pre>
<p>你可以从 <code>闭包</code> 中返回 <code>false</code> 来阻止进一步的分块的处理：</p>
<pre><code>DB::table('users')-&gt;orderBy('id')-&gt;chunk(100, function ($users) {
    // Process the records...

    return false;
});</code></pre>
<p><a name="aggregates"></a></p>
<h3>聚合</h3>
<p>查询构造器还提供了各种聚合方法，如 <code>count</code>、 <code>max</code>、 <code>min</code>、 <code>avg</code> 和 <code>sum</code>。你可以在创建查询后调用其中的任意一个方法：</p>
<pre><code>$users = DB::table('users')-&gt;count();

$price = DB::table('orders')-&gt;max('price');</code></pre>
<p>当然，你也可以将这些方法和其它语句结合起来：</p>
<pre><code>$price = DB::table('orders')
                -&gt;where('finalized', 1)
                -&gt;avg('price');</code></pre>
<p><a name="selects"></a></p>
<h2>Selects</h2>
<h4>指定一个 Select 语句</h4>
<p>你并不会总是想从数据表中选出所有的字段，这时可使用 <code>select</code> 方法自定义一个 <code>select</code> 语句来指定查询的字段：</p>
<pre><code>$users = DB::table('users')-&gt;select('name', 'email as user_email')-&gt;get();</code></pre>
<p><code>distinct</code> 方法允许你强制让查询返回不重复的结果：</p>
<pre><code>$users = DB::table('users')-&gt;distinct()-&gt;get();</code></pre>
<p>如果你已有一个查询构造器实例，并且希望在现有的 select 语句中加入一个字段，则可以使用 <code>addSelect</code> 方法：</p>
<pre><code>$query = DB::table('users')-&gt;select('name');

$users = $query-&gt;addSelect('age')-&gt;get();</code></pre>
<p><a name="raw-expressions"></a></p>
<h2>原生表达式</h2>
<p>有时候你可能需要在查询中使用原生表达式，使用 <code>DB::raw</code> 方法可以创建原生表达式：</p>
<pre><code>$users = DB::table('users')
                     -&gt;select(DB::raw('count(*) as user_count, status'))
                     -&gt;where('status', '&lt;&gt;', 1)
                     -&gt;groupBy('status')
                     -&gt;get();</code></pre>
<blockquote>
<p>{note} 原生表达式将会被当作字符串注入到查询中，所以要小心避免创建 SQL 注入漏洞。</p>
</blockquote>
<p><a name="raw-methods"></a></p>
<h3>原生方法</h3>
<p>可以使用以下的方法代替 <code>DB::raw</code> 将原生表达式插入查询的各个部分。</p>
<h4><code>selectRaw</code></h4>
<p><code>selectRaw</code> 方法可以用来代替 <code>select(DB::raw(...))</code>。这个方法的第二个参数接受一个可选的绑定参数的数组：</p>
<pre><code>$orders = DB::table('orders')
                -&gt;selectRaw('price * ? as price_with_tax', [1.0825])
                -&gt;get();</code></pre>
<h4><code>whereRaw / orWhereRaw</code></h4>
<p>可以使用 <code>whereRaw</code> 和 <code>orWhereRaw</code> 方法将原生的 <code>where</code> 语句注入到查询中。这些方法接受一个可选的绑定数组作为他们的第二个参数：</p>
<pre><code>$orders = DB::table('orders')
                -&gt;whereRaw('price &gt; IF(state = "TX", ?, 100)', [200])
                -&gt;get();</code></pre>
<h4><code>havingRaw / orHavingRaw</code></h4>
<p><code>havingRaw</code> 和 <code>orHavingRaw</code> 方法可用于将原生字符串设置为 <code>having</code> 语句的值：</p>
<pre><code>$orders = DB::table('orders')
                -&gt;select('department', DB::raw('SUM(price) as total_sales'))
                -&gt;groupBy('department')
                -&gt;havingRaw('SUM(price) &gt; 2500')
                -&gt;get();</code></pre>
<h4><code>orderByRaw</code></h4>
<p><code>orderByRaw</code> 方法可用于将原生字符串设置为 <code>order by</code> 语句的值：</p>
<pre><code>$orders = DB::table('orders')
                -&gt;orderByRaw('updated_at - created_at DESC')
                -&gt;get();</code></pre>
<p><a name="joins"></a></p>
<h2>Joins</h2>
<h4>Inner Join 语句</h4>
<p>查询构造器也可以编写 join 语句。若要执行基本的「内连接」，你可以在查询构造器实例上使用 <code>join</code> 方法。传递给 <code>join</code> 方法的第一个参数是你要需要连接的表的名称，而其它参数则用来指定连接的字段约束。你还可以在单个查询中连接多个数据表：</p>
<pre><code>$users = DB::table('users')
            -&gt;join('contacts', 'users.id', '=', 'contacts.user_id')
            -&gt;join('orders', 'users.id', '=', 'orders.user_id')
            -&gt;select('users.*', 'contacts.phone', 'orders.price')
            -&gt;get();</code></pre>
<h4>Left Join 语句</h4>
<p>如果你想用「左连接」来代替「内连接」，请使用 <code>leftJoin</code> 方法。<code>leftJoin</code> 方法的用法和 <code>join</code> 方法一样：</p>
<pre><code>$users = DB::table('users')
            -&gt;leftJoin('posts', 'users.id', '=', 'posts.user_id')
            -&gt;get();</code></pre>
<h4>Cross Join 语句</h4>
<p>使用 <code>crossJoin</code> 方法和你想要交叉连接的表名来做「交叉连接」。交叉连接在第一个表和连接之间生成笛卡尔积：</p>
<pre><code>$users = DB::table('sizes')
            -&gt;crossJoin('colours')
            -&gt;get();</code></pre>
<h4>高级 Join 语句</h4>
<p>你也可以指定更高级的 join 语句。比如传递一个 <code>闭包</code> 作为 <code>join</code> 方法的第二个参数。此 <code>闭包</code> 接收一个 <code>JoinClause</code> 对象，从而在其中指定 <code>join</code> 语句中指定约束：</p>
<pre><code>DB::table('users')
        -&gt;join('contacts', function ($join) {
            $join-&gt;on('users.id', '=', 'contacts.user_id')-&gt;orOn(...);
        })
        -&gt;get();</code></pre>
<p>如果你想要在连接上使用「where」风格的语句，可以在连接上使用 <code>where</code> 和 <code>orWhere</code> 方法。这些方法可以用来比较值和对应的字段：</p>
<pre><code>DB::table('users')
        -&gt;join('contacts', function ($join) {
            $join-&gt;on('users.id', '=', 'contacts.user_id')
                 -&gt;where('contacts.user_id', '&gt;', 5);
        })
        -&gt;get();</code></pre>
<p><a name="unions"></a></p>
<h2>Unions</h2>
<p>查询构造器还提供了将两个查询「合并」起来的快捷方式。例如，你可以先创建一个初始查询，并使用 <code>union</code> 方法将它与第二个查询进行合并：</p>
<pre><code>$first = DB::table('users')
            -&gt;whereNull('first_name');

$users = DB::table('users')
            -&gt;whereNull('last_name')
            -&gt;union($first)
            -&gt;get();</code></pre>
<blockquote>
<p>{tip} 也可使用 <code>unionAll</code> 方法，它和 <code>union</code> 方法有着相同的用法。</p>
</blockquote>
<p><a name="where-clauses"></a></p>
<h2>Where 语句</h2>
<h4>简单的 Where 语句</h4>
<p>你可以在查询构造器实例中使用 <code>where</code> 方法从而把 <code>where</code> 语句添加到查询中。基本的 <code>where</code> 方法需要三个参数。第一个参数是字段的名称，第二个参数是运算符，它可以是数据库所支持的任何运算符。最后，第三个参数是要对字段进行评估的值。</p>
<p>例如，下面是一个要验证「votes」字段的值等于 100 的查询：</p>
<pre><code>$users = DB::table('users')-&gt;where('votes', '=', 100)-&gt;get();</code></pre>
<p>如果你只是想简单的校验某个字段等于指定的值，你可以直接将这个值作为第二个参数传递给 <code>where</code> 方法：</p>
<pre><code>$users = DB::table('users')-&gt;where('votes', 100)-&gt;get();</code></pre>
<p>当然，在编写 <code>where</code> 语句时，也可以使用其它各种数据库支持的运算符：</p>
<pre><code>$users = DB::table('users')
                -&gt;where('votes', '&gt;=', 100)
                -&gt;get();

$users = DB::table('users')
                -&gt;where('votes', '&lt;&gt;', 100)
                -&gt;get();

$users = DB::table('users')
                -&gt;where('name', 'like', 'T%')
                -&gt;get();</code></pre>
<p>你也可以传递条件数组给 <code>where</code> 函数：</p>
<pre><code>$users = DB::table('users')-&gt;where([
    ['status', '=', '1'],
    ['subscribed', '&lt;&gt;', '1'],
])-&gt;get();</code></pre>
<h4>Or 语句</h4>
<p>你可以一起链式调用 where，也可以在查询添加中 <code>or</code> 语句。<code>orWhere</code> 方法接受与 <code>where</code> 方法相同的参数：</p>
<pre><code>$users = DB::table('users')
                    -&gt;where('votes', '&gt;', 100)
                    -&gt;orWhere('name', 'John')
                    -&gt;get();</code></pre>
<h4>其它 Where 语句</h4>
<p><strong>whereBetween</strong></p>
<p><code>whereBetween</code> 方法用来验证字段的值介于两个值之间：</p>
<pre><code>$users = DB::table('users')
                    -&gt;whereBetween('votes', [1, 100])-&gt;get();</code></pre>
<p><strong>whereNotBetween</strong></p>
<p><code>whereNotBetween</code> 方法验证字段的值不在两个值之间：</p>
<pre><code>$users = DB::table('users')
                    -&gt;whereNotBetween('votes', [1, 100])
                    -&gt;get();</code></pre>
<p><strong>whereIn / whereNotIn</strong></p>
<p><code>whereIn</code> 方法验证字段的值在指定的数组内：</p>
<pre><code>$users = DB::table('users')
                    -&gt;whereIn('id', [1, 2, 3])
                    -&gt;get();</code></pre>
<p><code>whereNotIn</code> 方法验证字段的值不在指定的数组内：</p>
<pre><code>$users = DB::table('users')
                    -&gt;whereNotIn('id', [1, 2, 3])
                    -&gt;get();</code></pre>
<p><strong>whereNull / whereNotNull</strong></p>
<p><code>whereNull</code> 方法验证字段的值为 <code>NULL</code>：</p>
<pre><code>$users = DB::table('users')
                    -&gt;whereNull('updated_at')
                    -&gt;get();</code></pre>
<p><code>whereNotNull</code> 方法验证字段的值不为 <code>NULL</code>：</p>
<pre><code>$users = DB::table('users')
                    -&gt;whereNotNull('updated_at')
                    -&gt;get();</code></pre>
<p><strong>whereDate / whereMonth / whereDay / whereYear / whereTime</strong></p>
<p><code>whereDate</code> 方法用于比较字段的值和日期：</p>
<pre><code>$users = DB::table('users')
                -&gt;whereDate('created_at', '2016-12-31')
                -&gt;get();</code></pre>
<p><code>whereMonth</code> 方法用于比较字段的值与一年的特定月份：</p>
<pre><code>$users = DB::table('users')
                -&gt;whereMonth('created_at', '12')
                -&gt;get();</code></pre>
<p><code>whereDay</code> 方法用于比较字段的值与特定的一个月的某一天：</p>
<pre><code>$users = DB::table('users')
                -&gt;whereDay('created_at', '31')
                -&gt;get();</code></pre>
<p><code>whereYear</code> 方法用于比较字段的值与特定年份：</p>
<pre><code>$users = DB::table('users')
                -&gt;whereYear('created_at', '2016')
                -&gt;get();</code></pre>
<p><code>whereTime</code> 方法用于比较字段的值与特定的时间：</p>
<pre><code>$users = DB::table('users')
                -&gt;whereTime('created_at', '=', '11:20')
                -&gt;get();</code></pre>
<p><strong>whereColumn</strong></p>
<p><code>whereColumn</code> 方法用于验证两个字段是否相等：</p>
<pre><code>$users = DB::table('users')
                -&gt;whereColumn('first_name', 'last_name')
                -&gt;get();</code></pre>
<p>还可以将比较运算符传递给该方法：</p>
<pre><code>$users = DB::table('users')
                -&gt;whereColumn('updated_at', '&gt;', 'created_at')
                -&gt;get();</code></pre>
<p><code>whereColumn</code> 方法也可以传递一个包含多个条件的数组。这些条件将使用 <code>and</code> 运算符进行连接：</p>
<pre><code>$users = DB::table('users')
                -&gt;whereColumn([
                    ['first_name', '=', 'last_name'],
                    ['updated_at', '&gt;', 'created_at']
                ])-&gt;get();</code></pre>
<p><a name="parameter-grouping"></a></p>
<h3>参数分组</h3>
<p>有时你可能需要创建更高级的 where 语句，例如「where exists」或者嵌套的参数分组。Laravel 的查询构造器也能够处理这些。下面有一个括号内的分组约束的示例：</p>
<pre><code>DB::table('users')
            -&gt;where('name', '=', 'John')
            -&gt;orWhere(function ($query) {
                $query-&gt;where('votes', '&gt;', 100)
                      -&gt;where('title', '&lt;&gt;', 'Admin');
            })
            -&gt;get();</code></pre>
<p>在上面例子中将 <code>闭包</code> 传递到 <code>orWhere</code> 方法中，指示查询构造器开始一个约束分组。此 <code>闭包</code> 接收一个查询构造器实例，你可以用它来设置应包含在括号组中的约束。上面的例子会产生下面的 SQL：</p>
<pre><code>select * from users where name = 'John' or (votes &gt; 100 and title &lt;&gt; 'Admin')</code></pre>
<p><a name="where-exists-clauses"></a></p>
<h3>Where Exists 语句</h3>
<p><code>whereExists</code> 方法允许你编写 <code>where exists</code> SQL 语句。此方法接受一个 <code>闭包</code> 参数，此闭包要接收一个查询构造器实例，让你可以定义放在「exists」语句中的查询：</p>
<pre><code>DB::table('users')
            -&gt;whereExists(function ($query) {
                $query-&gt;select(DB::raw(1))
                      -&gt;from('orders')
                      -&gt;whereRaw('orders.user_id = users.id');
            })
            -&gt;get();</code></pre>
<p>上述的查询将生成以下 SQL：</p>
<pre><code>select * from users
where exists (
    select 1 from orders where orders.user_id = users.id
)</code></pre>
<p><a name="json-where-clauses"></a></p>
<h3>JSON where 语句</h3>
<p>Laravel 也支持查询 JSON 类型的字段（仅在对 JSON 类型支持的数据库上）。目前，本特性仅支持 MySQL 5.7+ 和 Postgres数据库。可以使用 <code>-&gt;</code> 运算符来查询 JSON 列数据：</p>
<pre><code>$users = DB::table('users')
                -&gt;where('options-&gt;language', 'en')
                -&gt;get();

$users = DB::table('users')
                -&gt;where('preferences-&gt;dining-&gt;meal', 'salad')
                -&gt;get();</code></pre>
<p><a name="ordering-grouping-limit-and-offset"></a></p>
<h2>Ordering, Grouping, Limit, &amp; Offset</h2>
<h4>orderBy</h4>
<p><code>orderBy</code> 方法允许你根据指定字段对查询结果进行排序。<code>orderBy</code> 方法的第一个参数是你想要用来排序的字段，而第二个参数控制排序的方向，可以是 <code>asc</code> 或 <code>desc</code>：</p>
<pre><code>$users = DB::table('users')
                -&gt;orderBy('name', 'desc')
                -&gt;get();</code></pre>
<h4>latest / oldest</h4>
<p><code>latest</code> 和 <code>oldest</code> 方法允许你轻松地按日期对查询结果排序。默认情况下是对 <code>created_at</code> 字段进行排序。或者，你可以传递你想要排序的字段名称：</p>
<pre><code>$user = DB::table('users')
                -&gt;latest()
                -&gt;first();</code></pre>
<h4>inRandomOrder</h4>
<p><code>inRandomOrder</code> 方法可以将查询结果随机排序。例如，你可以使用这个方法获取一个随机用户：</p>
<pre><code>$randomUser = DB::table('users')
                -&gt;inRandomOrder()
                -&gt;first();</code></pre>
<h4>groupBy / having</h4>
<p><code>groupBy</code> 和 <code>having</code> 方法可用来对查询结果进行分组。<code>having</code> 方法的用法和 <code>where</code> 方法类似：</p>
<pre><code>$users = DB::table('users')
                -&gt;groupBy('account_id')
                -&gt;having('account_id', '&gt;', 100)
                -&gt;get();</code></pre>
<p>可以将多个参数传递给 <code>groupBy</code> 方法，按多个字段进行分组：</p>
<pre><code>$users = DB::table('users')
                -&gt;groupBy('first_name', 'status')
                -&gt;having('account_id', '&gt;', 100)
                -&gt;get();</code></pre>
<p>对于更高级的语句，请参阅 <a href="https://laravel.com/docs/5.5/queries#raw-methods"><code>havingRaw</code></a> 方法。</p>
<h4>skip / take</h4>
<p>可以使用 <code>skip</code> 和 <code>take</code> 方法来限制从查询返回的结果数量或跳过查询中给定数量的结果：</p>
<pre><code>$users = DB::table('users')-&gt;skip(10)-&gt;take(5)-&gt;get();</code></pre>
<p>或者，你也可以使用 <code>limit</code> 和 <code>offset</code> 方法：</p>
<pre><code>$users = DB::table('users')
                -&gt;offset(10)
                -&gt;limit(5)
                -&gt;get();</code></pre>
<p><a name="conditional-clauses"></a></p>
<h2>条件语句</h2>
<p>有时你可能想要子句只适用于某个情况为真时才执行查询。例如，如果给定的输入值出现在传入请求中时，你可能想要判断它能达成某个 <code>where</code> 语句，你可以使用 <code>when</code> 方法来完成此操作：</p>
<pre><code>$role = $request-&gt;input('role');

$users = DB::table('users')
                -&gt;when($role, function ($query) use ($role) {
                    return $query-&gt;where('role_id', $role);
                })
                -&gt;get();</code></pre>
<p>只有当 <code>when</code> 方法的第一个参数为 <code>true</code> 时，闭包里的 <code>where</code> 语句才会执行。如果第一个参数是 <code>false</code>，这个闭包将不会被执行。</p>
<p>你可以将另一个闭包当作第三个参数传递给 <code>when</code> 方法。如果第一个参数的值为 <code>false</code> 时，这个闭包将执行。为了说明如何使用此功能，我们将使用它配置查询的默认排序：</p>
<pre><code>$sortBy = null;

$users = DB::table('users')
                -&gt;when($sortBy, function ($query) use ($sortBy) {
                    return $query-&gt;orderBy($sortBy);
                }, function ($query) {
                    return $query-&gt;orderBy('name');
                })
                -&gt;get();</code></pre>
<p><a name="inserts"></a></p>
<h2>Inserts</h2>
<p>查询构造器也提供了将记录插入数据库表的 <code>insert</code> 方法。<code>insert</code> 方法接受一个字段名和值的数组作为参数：</p>
<pre><code>DB::table('users')-&gt;insert(
    ['email' =&gt; 'john@example.com', 'votes' =&gt; 0]
);</code></pre>
<p>你还可以在 <code>insert</code> 中传入一个嵌套数组向表中插入多条记录。每个数组代表要插入表中的行：</p>
<pre><code>DB::table('users')-&gt;insert([
    ['email' =&gt; 'taylor@example.com', 'votes' =&gt; 0],
    ['email' =&gt; 'dayle@example.com', 'votes' =&gt; 0]
]);</code></pre>
<h4>自增 ID</h4>
<p>若数据表存在自增的 ID，则可以使用 <code>insertGetId</code> 方法来插入记录然后获取其 ID：</p>
<pre><code>$id = DB::table('users')-&gt;insertGetId(
    ['email' =&gt; 'john@example.com', 'votes' =&gt; 0]
);</code></pre>
<blockquote>
<p>{note} 当使用 PostgreSQL 时，insertGetId 方法将默认把 <code>id</code> 作为自动递增字段的名称。若你要从不同「顺序」来获取 ID，则可以将字段名称作为第二个参数传递给 <code>insertGetId</code> 方法。</p>
</blockquote>
<p><a name="updates"></a></p>
<h2>Updates</h2>
<p>当然，除了在数据库中插入记录外，你也可以使用 <code>update</code> 来更新已存在的记录。<code>update</code> 方法和 <code>insert</code> 方法一样，接受包含要更新的字段及值的数组。你可以使用 <code>where</code> 语句来约束 <code>update</code> 的查询：</p>
<pre><code>DB::table('users')
            -&gt;where('id', 1)
            -&gt;update(['votes' =&gt; 1]);</code></pre>
<p><a name="updating-json-columns"></a></p>
<h3>更新 JSON 字段</h3>
<p>更新 JSON 字段时，应该使用 <code>-&gt;</code> 语法来访问 JSON 对象中的相应键。此操作只能在支持 JSON 字段的数据库上操作：</p>
<pre><code>DB::table('users')
            -&gt;where('id', 1)
            -&gt;update(['options-&gt;enabled' =&gt; true]);</code></pre>
<p><a name="increment-and-decrement"></a></p>
<h3>自增 &amp; 自减</h3>
<p>查询构造器还为给定字段的递增或递减提供了方便的方法 。此方法提供了一个比手动编写 <code>update</code> 语句更具表达力且更精练的接口。</p>
<p>这两个方法都必须接收至少一个参数——要修改的字段。可以选择传递第二个参数来控制字段递增或递减的量：</p>
<pre><code>DB::table('users')-&gt;increment('votes');

DB::table('users')-&gt;increment('votes', 5);

DB::table('users')-&gt;decrement('votes');

DB::table('users')-&gt;decrement('votes', 5);</code></pre>
<p>你也可以在操作过程中指定要更新的字段：</p>
<pre><code>DB::table('users')-&gt;increment('votes', 1, ['name' =&gt; 'John']);</code></pre>
<p><a name="deletes"></a></p>
<h2>Deletes</h2>
<p>查询构造器也可使用 <code>delete</code> 方法从数据表中删除记录。在调用 <code>delete</code> 方法前，还可以通过添加 <code>where</code> 语句来约束 <code>delete</code> 语句：</p>
<pre><code>DB::table('users')-&gt;delete();

DB::table('users')-&gt;where('votes', '&gt;', 100)-&gt;delete();</code></pre>
<p>如果你需要清空表，你可以使用 <code>truncate</code> 方法，这将删除所有行，并重置自动递增 ID 为零：</p>
<pre><code>DB::table('users')-&gt;truncate();</code></pre>
<p><a name="pessimistic-locking"></a></p>
<h2>悲观锁</h2>
<p>查询构造器也包含一些可以帮助你在 <code>select</code> 语句上实现「悲观锁定」的函数 。若要在查询中使用「共享锁」，可以使用 <code>sharedLock</code> 方法。共享锁可以防止选中的行被篡改，直到事务被提交为止：</p>
<pre><code>DB::table('users')-&gt;where('votes', '&gt;', 100)-&gt;sharedLock()-&gt;get();</code></pre>
<p>或者，你也可以使用 <code>lockForUpdate</code> 方法。使用「更新」锁可避免行被其它共享锁修改或选取：</p>
<pre><code>DB::table('users')-&gt;where('votes', '&gt;', 100)-&gt;lockForUpdate()-&gt;get();</code></pre>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-xl-2" id="toc-list">
        <ul></ul>
    </div>
</div>    </div>
</div>
<span id="back-top">
<svg width="20" height="20" fill="currentColor">
    <use xlink:href="/css/bootstrap-icons.svg#chevron-up"/>
</svg>
</span>
 
<script>
    // 浏览量统计
    $(function () {
        let formdata = new FormData();
        formdata.append('_token', '');
        formdata.append('id', 200);
        $.ajax({
            url: $(".sticky-top .navbar-brand").attr('href') + "/api/doc/clicks",
            type: 'POST',
            data: formdata,
            processData: false,
            contentType: false
        });
    });
    // aside-hidden
    $(function () {
        $('#aside-hidden').on('click', function () {
            $('.aside').toggle(0, function () {
                if ($(this).is(':visible')) {
                    $('.aside-middle').removeClass('col-md-12 col-lg-12').addClass('col-md-9 col-lg-10');
                } else {
                    $('.aside-middle').removeClass('col-md-9 col-lg-10').addClass('col-md-12 col-lg-12');
                }
            });
        });
    });
</script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?1522d01c436f59ddc8389f25bfa9d53e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
</body>
</html>