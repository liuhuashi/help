<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"> 
    <meta name="csrf-token" content=""> 
    <title>mysqlnd_ms_get_last_used_connection - 开发帮助文档</title> 
    <meta name="keyword" content="function.mysqlnd-ms-get-last-used-connection"> 
    <meta name="description" content="function.mysqlnd-ms-get-last-used-connection"> 
    <meta name="author" content="Moments"> 
    <link href="/favicon.ico" rel="shortcut icon"> 
    <link href="/css/blog.css" rel="stylesheet"> 
    <script src="/js/blog.js"></script> 
</head>
<body>
<header class="sticky-top">
    <nav class="navbar navbar-expand navbar-dark bg-secondary justify-content-between text-uppercase">
        <div class="navbar-nav" style="overflow:hidden;">
            <a class="navbar-brand" href="https://help.pythonschool.com">
                <span class="d-md-none">
                    <svg class="text-warning" width="24" height="24" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#emoji-sunglasses"/>
                    </svg>
                </span>
                <span class="d-none d-md-flex">开发帮助文档</span>
            </a>
            <div class="navbar-nav-scroll" style="overflow: hidden;">
                <ul class="navbar-nav text-nowrap pb-4" style="overflow:auto;">
                                            <li class="nav-item">
                            <a class="nav-link" href="/docs/laravel/index.html">laravel</a>
                        </li>
                                            <li class="nav-item">
                            <a class="nav-link active" href="/docs/php/index.html">php</a>
                        </li>
                                    </ul>
            </div>
        </div>
        <div class="d-inline-flex">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/liuhuashi">
                        <svg class="text-light" width="24" height="24" fill="currentColor">
                            <use xlink:href="/css/bootstrap-icons.svg#github"/>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</header>
<div class="container-fluid">
    <div id="aside-hidden" class="position-fixed" style="left:0;top: 58px;cursor:pointer;z-index: 10000;">
        <svg class="align-text-bottom text-warning" width="16" height="16" fill="currentColor" stroke="currentColor" stroke-width="1">
            <use xlink:href="/css/bootstrap-icons.svg#arrow-left-square"/>
        </svg>
    </div>
    <div class="row">
        <div class="aside col-md-3 col-lg-2 border-right shadow position-sticky" style="overflow:auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
    <form class="row border-bottom p-3 bg-white sticky-top">
        <input id="search-version" class="form-control" data-version="843" type="search" placeholder="英文逗号分隔,分词搜索">
    </form>
    <ul class="nav navbar-nav nav-pills flex-column pt-2 figure-caption">
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-dump-servers.html" title="mysqlnd_ms_dump_servers">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_dump_servers
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-fabric-select-global.html" title="mysqlnd_ms_fabric_select_global">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_fabric_select_global
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-fabric-select-shard.html" title="mysqlnd_ms_fabric_select_shard">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_fabric_select_shard
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-get-last-gtid.html" title="mysqlnd_ms_get_last_gtid">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_get_last_gtid
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-get-last-used-connection.html" title="mysqlnd_ms_get_last_used_connection">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_get_last_used_connection
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-get-stats.html" title="mysqlnd_ms_get_stats">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_get_stats
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-match-wild.html" title="mysqlnd_ms_match_wild">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_match_wild
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-query-is-select.html" title="mysqlnd_ms_query_is_select">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_query_is_select
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-set-qos.html" title="mysqlnd_ms_set_qos">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_set_qos
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-set-user-pick-server.html" title="mysqlnd_ms_set_user_pick_server">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_set_user_pick_server
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-xa-begin.html" title="mysqlnd_ms_xa_begin">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_xa_begin
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-xa-commit.html" title="mysqlnd_ms_xa_commit">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_xa_commit
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-xa-gc.html" title="mysqlnd_ms_xa_gc">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_xa_gc
                </a>
            </li>
                    <li class="nav-item">
                <a class="nav-link" href="/docs/php/function.mysqlnd-ms-xa-rollback.html" title="mysqlnd_ms_xa_rollback">
                    <svg class="align-text-bottom text-dark" width="16" height="16" fill="currentColor">
                        <use xlink:href="/css/bootstrap-icons.svg#eyeglasses"/>
                    </svg>
                    mysqlnd_ms_xa_rollback
                </a>
            </li>
            </ul>
</div>        <div class="aside-middle col-md-9 col-lg-10 row">
    <div class="col-md-9 col-xl-10" style="overflow: auto;height: calc(100vh - 58px);padding-bottom: calc(100vh/3);">
        <div class="container main-h4-1">
            <div class="page-content">
                <div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mysqlnd-ms-get-last-gtid.html">« mysqlnd_ms_get_last_gtid</a></li>
      <li style="float: right;"><a href="function.mysqlnd-ms-get-stats.html">mysqlnd_ms_get_stats »</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="documentation.html">PHP Manual</a></li>
    <li><a href="ref.mysqlnd-ms.html">Mysqlnd_ms 函数</a></li>
    <li>Returns an array which describes the last used connection</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mysqlnd-ms-get-last-used-connection" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqlnd_ms_get_last_used_connection</h1>
  <p class="verinfo">(PECL mysqlnd_ms &gt;= 1.1.0)</p><p class="refpurpose"><span class="refname">mysqlnd_ms_get_last_used_connection</span> — <span class="dc-title">Returns an array which describes the last used connection</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mysqlnd-ms-get-last-used-connection-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   
   <span class="methodname"><strong>mysqlnd_ms_get_last_used_connection</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$connection</code></span>
   ) : <span class="type">array</span></div>

  <p class="para rdfs-comment">
   Returns an array which describes the last used connection from the plugins
   connection pool currently pointed to by the user connection handle. If using the
   plugin, a user connection handle represents a pool of database connections.
   It is not possible to tell from the user connection handles properties to which
   database server from the pool the user connection handle points.
  </p>
  <p class="para">
   The function can be used to debug or monitor PECL mysqlnd_ms.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysqlnd-ms-get-last-used-connection-parameters">
  <h3 class="title">参数</h3>
  <dl>

   
    <dt>
<code class="parameter">connection</code></dt>

    <dd>

     <p class="para">
      A MySQL connection handle obtained from any of the
      connect functions of the <a href="ref.mysqli.html" class="link">mysqli</a>,
      <a href="ref.mysql.html" class="link">mysql</a> or
      <a href="ref.pdo-mysql.html" class="link">PDO_MYSQL</a> extensions.
     </p>
    </dd>

   
  </dl>

 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysqlnd-ms-get-last-used-connection-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   <strong><code>false</code></strong> on error. Otherwise, an
   array which describes the connection used to
   execute the last statement on.
  </p>
  <p class="para">
   Array which describes the connection.
  </p>
  <table class="doctable informaltable">
   
    <col width="1*">
    <col width="7*">
    <col width="2*">
    <thead>
     <tr>
      <th>Property</th>
      <th>Description</th>
      <th>Version</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
      <td>
       <code class="literal">scheme</code>
      </td>
      <td>
       Connection scheme. Either <code class="literal">tcp://host:port</code>
       or <code class="literal">unix://host:socket</code>. If you want to
       distinguish connections from each other use a combination
       of <code class="literal">scheme</code> and <code class="literal">thread_id</code> as a unique
       key. Neither <code class="literal">scheme</code> nor <code class="literal">thread_id</code>
       alone are sufficient to distinguish two connections from each other.
       Two servers may assign the same <code class="literal">thread_id</code> to two
       different connections. Thus, connections in the pool may have the same
       <code class="literal">thread_id</code>. Also, do not rely on uniqueness of
       <code class="literal">scheme</code> in a pool. Your QA engineers may use the
       same MySQL server instance for two distinct logical roles and add it
       multiple times to the pool. This hack is used, for example,
       in the test suite.
      </td>
      <td>Since 1.1.0.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">host</code>
      </td>
      <td>
       Database server host used with the connection.
       The host is only set with TCP/IP connections.
       It is empty with Unix domain or Windows named pipe connections,
      </td>
      <td>Since 1.1.0.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">host_info</code>
      </td>
      <td>
        A character string representing the server hostname and the connection type.
      </td>
      <td>Since 1.1.2.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">port</code>
      </td>
      <td>
       Database server port used with the connection.
      </td>
      <td>Since 1.1.0.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">socket_or_pipe</code>
      </td>
      <td>
       Unix domain socket or Windows named pipe used with the connection.
       The value is empty for TCP/IP connections.
      </td>
      <td>Since 1.1.2.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">thread_id</code>
      </td>
      <td>
       Connection thread id.
      </td>
      <td>Since 1.1.0.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">last_message</code>
      </td>
      <td>
       Info message obtained from the
       MySQL C API function mysql_info(). Please, see
       <span class="function"><a href="mysqli.info.html" class="function">mysqli_info()</a></span> for
       a description.
      </td>
      <td>Since 1.1.0.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">errno</code>
      </td>
      <td>
       Error code.
      </td>
      <td>Since 1.1.0.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">error</code>
      </td>
      <td>
       Error message.
      </td>
      <td>Since 1.1.0.</td>
     </tr>

     <tr>
      <td>
       <code class="literal">sqlstate</code>
      </td>
      <td>
       Error SQLstate code.
      </td>
      <td>Since 1.1.0.</td>
     </tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 unknown-returnvaluet" id="refsect1-function.mysqlnd-ms-get-last-used-connection-unknown-returnvaluet">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   </p><p class="para">
    <span class="function"><strong>mysqlnd_ms_get_last_used_connection()</strong></span> requires
    PHP &gt;= 5.4.0 and PECL mysqlnd_ms &gt;&gt; 1.1.0. Internally, it is using
    a <code class="literal">mysqlnd</code> library C call not available with PHP 5.3.
   </p>
  </blockquote>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mysqlnd-ms-get-last-used-connection-examples">
  <h3 class="title">范例</h3>
  <p class="para">
  The example assumes that <code class="literal">myapp</code> refers to a
  plugin configuration file section and represents a connection pool.
  </p>
  <p class="para">
   </p><div class="example" id="example-1834">
    <p><strong>示例 #1 <span class="function"><strong>mysqlnd_ms_get_last_used_connection()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$link </span><span style="color: #007700">= new </span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">"myapp"</span><span style="color: #007700">, </span><span style="color: #DD0000">"user"</span><span style="color: #007700">, </span><span style="color: #DD0000">"password"</span><span style="color: #007700">, </span><span style="color: #DD0000">"database"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$res </span><span style="color: #007700">= </span><span style="color: #0000BB">$link</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT 1 FROM DUAL"</span><span style="color: #007700">);<br></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">mysqlnd_ms_get_last_used_connection</span><span style="color: #007700">(</span><span style="color: #0000BB">$link</span><span style="color: #007700">));<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(10) {
  ["scheme"]=&gt;
  string(22) "unix:///tmp/mysql.sock"
  ["host_info"]=&gt;
  string(25) "Localhost via UNIX socket"
  ["host"]=&gt;
  string(0) ""
  ["port"]=&gt;
  int(3306)
  ["socket_or_pipe"]=&gt;
  string(15) "/tmp/mysql.sock"
  ["thread_id"]=&gt;
  int(46253)
  ["last_message"]=&gt;
  string(0) ""
  ["errno"]=&gt;
  int(0)
  ["error"]=&gt;
  string(0) ""
  ["sqlstate"]=&gt;
  string(5) "00000"
}
</pre></div>
    </div>
   </div>
  
 </div>


</div></div></div>
            </div>
        </div>
    </div>
    <div class="col-md-3 col-xl-2" id="toc-list">
        <ul></ul>
    </div>
</div>    </div>
</div>
<span id="back-top">
<svg width="20" height="20" fill="currentColor">
    <use xlink:href="/css/bootstrap-icons.svg#chevron-up"/>
</svg>
</span>
 
<script>
    // 浏览量统计
    $(function () {
        let formdata = new FormData();
        formdata.append('_token', '');
        formdata.append('id', 4236);
        $.ajax({
            url: $(".sticky-top .navbar-brand").attr('href') + "/api/doc/clicks",
            type: 'POST',
            data: formdata,
            processData: false,
            contentType: false
        });
    });
    // aside-hidden
    $(function () {
        $('#aside-hidden').on('click', function () {
            $('.aside').toggle(0, function () {
                if ($(this).is(':visible')) {
                    $('.aside-middle').removeClass('col-md-12 col-lg-12').addClass('col-md-9 col-lg-10');
                } else {
                    $('.aside-middle').removeClass('col-md-9 col-lg-10').addClass('col-md-12 col-lg-12');
                }
            });
        });
    });
</script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?1522d01c436f59ddc8389f25bfa9d53e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
</body>
</html>